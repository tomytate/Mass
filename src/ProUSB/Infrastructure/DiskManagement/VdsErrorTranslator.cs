using System;
using System.Collections.Generic;

namespace ProUSB.Infrastructure.DiskManagement;

public static class VdsErrorTranslator {
    private static readonly Dictionary<uint, string> _errorMap = new() {
        { 0x80042400, "The operation is not supported by the object." },
        { 0x80042401, "VDS or the provider failed to initialize." },
        { 0x80042402, "VDS did not call the hardware provider's initialization method." },
        { 0x80042403, "The provider is already registered." },
        { 0x80042404, "A concurrent second call is made on an object before the first call is completed." },
        { 0x80042405, "The specified object was not found." },
        { 0x80042406, "The specified space is neither free nor valid." },
        { 0x80042407, "No more partitions can be created on the specified disk." },
        { 0x80042408, "The extended partition is not empty." },
        { 0x80042409, "The operation is still in progress." },
        { 0x8004240A, "The operation is not permitted on the specified disk, partition, or volume." },
        { 0x8004240B, "The object no longer exists." },
        { 0x8004240C, "The operation can no longer be canceled." },
        { 0x8004240D, "The operation has already been canceled." },
        { 0x8004240E, "The file system does not support extending this volume." },
        { 0x8004240F, "There is not enough space to complete the operation." },
        { 0x80042410, "There are not enough free disk drives in the subsystem to complete the operation." },
        { 0x80042411, "The cookie was not found." },
        { 0x80042412, "There is no removable media in the drive." },
        { 0x80042413, "The device is currently in use." },
        { 0x80042414, "The disk contains partitions or volumes." },
        { 0x80042415, "The specified operation is not valid." },
        { 0x80042416, "The specified path was not found." },
        { 0x80042417, "The specified disk has not been initialized." },
        { 0x80042418, "The specified disk is not an unallocated disk." },
        { 0x80042419, "An unrecoverable error occurred. The service MUST shut down." },
        { 0x0004241A, "The clean operation was not a full clean or was canceled before it could be completed." },
        { 0x8004241B, "The provider failed to connect to the LDMA service." },
        { 0x8004241C, "The provider failed to initialize." },
        { 0x8004241D, "The object already exists." },
        { 0x8004241E, "No disks were found on the target machine." },
        { 0x8004241F, "The cache for a provider is corrupt." },
        { 0x80042420, "A method call to the LDMA service failed." },
        { 0x00042421, "The provider encountered errors while loading the cache." },
        { 0x80042422, "The device form of the volume pathname could not be retrieved." },
        { 0x80042423, "Failed to open the volume device" },
        { 0x80042424, "A corrupt notification was sent from the LDMA service." },
        { 0x80042425, "The file system is incompatible with the specified operation." },
        { 0x80042426, "The media is incompatible with the specified operation." },
        { 0x80042427, "Access is denied. A VDS operation MUST run elevated." },
        { 0x80042428, "The media is write-protected." },
        { 0x80042429, "The volume label is not valid." },
        { 0x8004242A, "The volume cannot be quick-formatted." },
        { 0x8004242B, "An I/O error occurred during the operation." },
        { 0x8004242C, "The volume size is too small." },
        { 0x8004242D, "The volume size is too large." },
        { 0x8004242E, "The cluster size is too small." },
        { 0x8004242F, "The cluster size is too large." },
        { 0x80042430, "The number of clusters is too large to be represented as a 32-bit integer." },
        { 0x80042431, "The component that the object represents has failed." },
        { 0x80042432, "The volume is incomplete." },
        { 0x80042433, "The specified extent size is too small." },
        { 0x00042434, "The operation was successful, but VDS failed to update the boot options." },
        { 0x00042436, "The boot partition's partition number will change as a result of the operation." },
        { 0x80042436, "The boot partition's partition number will change as a result of the operation." },
        { 0x80042437, "The specified disk does not have enough free space to complete the operation." },
        { 0x80042438, "An active partition was detected on the selected disk." },
        { 0x80042439, "The partition information cannot be read." },
        { 0x8004243A, "A partition with an unknown type was detected on the specified disk." },
        { 0x8004243C, "A volume on the specified disk could not be opened." },
        { 0x8004243D, "The volume is not online." },
        { 0x8004243E, "The volume is failing or has failed." },
        { 0x8004243F, "The volume spans multiple disks." },
        { 0x80042440, "The volume does not consist of a single disk extent." },
        { 0x80042441, "A provider returned bad data." },
        { 0x80042442, "A provider failed to complete an operation." },
        { 0x00042443, "The file system was formatted successfully but could not be compressed." },
        { 0x80042444, "The pack is offline." },
        { 0x80042445, "The volume is not a mirror." },
        { 0x80042446, "No extents were found for the volume." },
        { 0x80042447, "The migrated disk failed to load to the cache." },
        { 0x80042448, "VDS encountered an internal error." },
        { 0x8004244A, "The method call is not supported for the specified provider type." },
        { 0x8004244B, "One or more of the specified disks are not online." },
        { 0x8004244C, "One or more extents of the disk are already being used by the volume." },
        { 0x0004244D, "The asynchronous operation is in progress." },
        { 0x8004244E, "Failure initializing the asynchronous object." },
        { 0x8004244F, "The volume is not mounted." },
        { 0x80042450, "The pack was not found." },
        { 0x80042453, "The reference to the object might be stale." },
        { 0x80042454, "The specified disk could not be found." },
        { 0x80042455, "The provider's list of PnP registered disks has become corrupted." },
        { 0x80042457, "The provider does not support the VDS_VF_NO DRIVELETTER volume flag." },
        { 0x80042459, "Some volume flags are already set." },
        { 0x0004245B, "Unable to retrieve the GPT attributes for this volume." },
        { 0x8004245C, "The volume is already dismounted temporarily." },
        { 0x8004245D, "The volume is already permanently dismounted." },
        { 0x8004245E, "The volume cannot be dismounted permanently because it still has an access path." },
        { 0x8004245F, "The operation timed out." },
        { 0x80042461, "The operation timed out in the LDMA service. Retry the operation." },
        { 0x80042462, "The flags to be cleared do not match the flags that were set previously." },
        { 0x80042463, "The operation failed. Retry the operation." },
        { 0x80042464, "The operation failed, because an online pack object already exists." },
        { 0x80042468, "Only the first 2TB are usable on large MBR disks." },
        { 0x80042500, "There are no software providers loaded." },
        { 0x80042501, "The disk is not missing." },
        { 0x80042502, "The volume's layout could not be retrieved." },
        { 0x80042503, "The volume's driver information is corrupted." },
        { 0x80042504, "The enumerator is corrupted" },
        { 0x80042505, "An internal error occurred in the volume management driver." },
        { 0x80042507, "The volume name is not valid." },
        { 0x00042508, "The disk is missing and not all information could be returned." },
        { 0x80042509, "The disk's partition information is corrupted." },
        { 0x0004250A, "The disk's partition information does not conform to what is expected on a dynamic disk." },
        { 0x8004250B, "The disk's extent information is corrupted." },
        { 0x0004250E, "Warning: There was a failure while checking for the system partition." },
        { 0x8004250F, "The PNP service sent a corrupted notification to the provider." },
        { 0x80042510, "No disk/volume arrival notification was received." },
        { 0x80042511, "No disk/volume arrival notification was received." },
        { 0x80042512, "No disk/volume removal notification was received." },
        { 0x80042513, "No disk/volume removal notification was received." },
        { 0x80042514, "The provider is exiting." },
        { 0x00042517, "No volume arrival notification was received." },
        { 0x80042519, "The specified disk is not valid." },
        { 0x8004251A, "The specified disk pack is not valid." },
        { 0x8004251B, "This operation is not allowed on disks with volumes." },
        { 0x8004251C, "The driver returned an invalid parameter error." },
        { 0x8004253D, "The object was not found in the driver cache." },
        { 0x8004253E, "The disk layout contains partitions which are not cylinder aligned." },
        { 0x8004253F, "The disk layout contains partitions which are less than the minimum required size." },
        { 0x80042540, "The I/O to the disk is failing." },
        { 0x80042543, "Invalid GPT attributes were specified." },
        { 0x8004254D, "An unexpected layout change occurred external to the volume manager." },
        { 0x8004254E, "The volume length is invalid." },
        { 0x8004254F, "The volume length is not a multiple of the sector size." },
        { 0x80042550, "The volume does not have a retained partition association." },
        { 0x80042551, "The volume already has a retained partition association." },
        { 0x80042553, "The specified alignment is beyond the first cylinder." },
        { 0x80042554, "The specified alignment is not a multiple of the sector size." },
        { 0x80042555, "The specified partition type cannot be created with a non-zero alignment." },
        { 0x80042556, "The service's cache has become corrupt." },
        { 0x80042557, "The specified volume flag cannot be cleared." },
        { 0x80042558, "The operation is not allowed on a disk that is in the process of being cleaned." },
        { 0x8004255A, "The operation is not supported on removable media." },
        { 0x8004255B, "The operation is not supported on a non-empty removable disk." },
        { 0x8004255C, "The specified drive letter is not free to be assigned." },
        { 0x8004255E, "The specified drive letter is not valid." },
        { 0x8004255F, "The specified number of drive letters to retrieve is not valid." },
        { 0x80042560, "The specified file system flag is not valid." },
        { 0x80042561, "The specified file system is not valid." },
        { 0x80042562, "The specified object type is not valid." },
        { 0x80042563, "The specified partition layout is invalid." },
        { 0x80042564, "VDS only supports MBR or GPT partition style disks." },
        { 0x80042565, "The specified partition type is not valid for this operation." },
        { 0x80042566, "A NULL GUID was passed to the provider." },
        { 0x80042567, "A NULL GUID was passed to the provider." },
        { 0x8004256A, "A NULL GUID was passed to the provider." },
        { 0x80042568, "The specified provider name is invalid." },
        { 0x80042569, "The specified provider type is invalid." },
        { 0x8004256B, "The specified provider version string is invalid." },
        { 0x8004256C, "The specified query provider flag is invalid." },
        { 0x8004256D, "The specified service flag is invalid." },
        { 0x8004256E, "The specified volume flag is invalid." },
        { 0x8004256F, "The operation is only supported on an OEM, ESP, or unknown partition." },
        { 0x80042570, "Cannot delete a protected partition without the force protected parameter set." },
        { 0x80042571, "The specified partition style is not the same as the disk's partition style." },
        { 0x80042572, "An internal error has occurred in the provider." },
        { 0x80042575, "An unrecoverable error occurred in the provider." },
        { 0x80042576, "Cannot assign a mount point to a hidden volume." },
        { 0x00042577, "Failed to dismount/remount the volume after setting the volume flags." },
        { 0x00042578, "Failed to dismount/remount the volume after setting the volume flags." },
        { 0x80042579, "Cannot set the specified flag as revert-on-close because it is already set." },
        { 0x8004257B, "The input volume id cannot be the id of the volume that is the target of the operation." },
        { 0x00042583, "Failed to obtain a file system lock." },
        { 0x80042584, "The volume is read only." },
        { 0x80042585, "The volume type is invalid for this operation." },
        { 0x80042588, "This operation is not supported on a mirrored volume." },
        { 0x80042589, "The operation is only supported on simple or spanned volumes." },
        { 0x8004258C, "The operation is not supported on this type of partitions." },
        { 0x8004258D, "The operation is not supported on this type of partitions." },
        { 0x0004258E, "The boot entries cannot be updated automatically on WinPE." },
        { 0x8004258F, "The alignment is not a power of two." },
        { 0x80042590, "The alignment is zero." },
        { 0x80042593, "The default file system could not be determined." },
        { 0x80042595, "This disk is already online." },
        { 0x80042596, "The online operation failed." },
        { 0x80042597, "The offline operation failed." },
        { 0x80042598, "The operation could not be completed because the specified revision number is not supported." },
        { 0x80042599, "The shrink operation was cancelled by the user." },
        { 0x8004259a, "The volume you have selected to shrink may be corrupted. Use Chkdsk to fix the corruption problem, and then try again." },
        { 0x00042700, "The name was set successfully but had to be truncated." },
        { 0x80042701, "The specified name is not unique." },
        { 0x8004270F, "The disk's path could not be retrieved. Some operations on the disk might fail." },
        { 0x80042711, "The path could not be retrieved for one or more volumes." },
        { 0x80042712, "The provider's cache is not in sync with the driver cache." },
        { 0x80042713, "No import target was set for the subsystem." },
        { 0x00042714, "The object already exists." },
        { 0x00042715, "Some, but not all, of the properties were successfully retrieved." },
        { 0x80042803, "Volume disk extent information could not be retrieved for the boot volume." },
        { 0x80042807, "Disk attributes cannot be changed on the boot disk." },
        { 0x00042808, "One or more of the volumes on the disk could not be mounted/dismounted." },
        { 0x00042809, "One or more of the volumes on the disk could not be mounted/dismounted." },
        { 0x8004280A, "The operation cannot be performed on a disk that is offline or read-only." },
        { 0x8004280B, "The operation cannot be performed on a disk that is offline or read-only." },
        { 0x8004280C, "The operation cannot be performed on a disk that contains a pagefile, hibernation or crashdump volume." },
        { 0x8004280D, "The operation cannot be performed on a disk that contains a pagefile, hibernation or crashdump volume." },
        { 0x8004280E, "The operation cannot be performed on a disk that contains a pagefile, hibernation or crashdump volume." },
        { 0x8004280F, "A system error occurred while retrieving the system disk information." },
        { 0x80042810, "Multiple disk extents reported for the system volume - system error." },
        { 0x80042811, "Disk attributes cannot be changed on the current system disk or BIOS disk 0." },
        { 0x80042823, "The sector size MUST be non-zero, a power of 2, and less than the maximum sector size." },
        { 0x80042907, "The provider returned a NULL subsystem identification string." },
        { 0x8004290C, "A reboot is required before any further operations are initiated." },
        { 0x8004290D, "Volume GUID pathnames are not valid input to this method." },
        { 0x8004290E, "Assigning or removing drive letters on the current boot or pagefile volume is not allowed." },
        { 0x8004290F, "Delete is not allowed on a critical volume." },
        { 0x80042910, "The FORCE parameter MUST be set to TRUE in order to clean a disk that contains a data or OEM volume." },
        { 0x80042911, "The FORCE parameter MUST be set to TRUE in order to clean a disk that contains a data or OEM volume." },
        { 0x80042912, "Clean is not allowed on a critical disk." },
        { 0x80042913, "Format is not allowed on a critical volume." },
        { 0x80042914, "The requested file system format is not supported on this volume." },
        { 0x80042915, "The requested file system format is not supported on this volume." },
        { 0x80042916, "The requested file system format is not supported on this volume." },
        { 0x80042917, "The volume is not formattable." },
        { 0x80042918, "The specified file system does not support compression." }
    };

    public static string GetErrorString(uint errorCode) {
        if (_errorMap.TryGetValue(errorCode, out var message)) {
            return $"[0x{errorCode:X8}] {message}";
        }
        return $"[0x{errorCode:X8}] Unknown VDS Error";
    }
}

