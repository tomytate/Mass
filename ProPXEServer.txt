==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\appsettings.Development.json
==============================================================================
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  }
}




==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\appsettings.json
==============================================================================
{
  "ConnectionStrings": {
    "DefaultConnection": "Data Source=massbootserver.db"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",
  "MassBootServer": {
    "AdvertisedIP": "192.168.1.100",
    "BootFilesDirectory": "BootFiles",
    "DhcpListenPort": 67,
    "ProxyDhcpListenPort": 4011,
    "TftpListenPort": 69
  },
  "TftpSettings": {
    "RootPath": "wwwroot/pxe",
    "Port": 69,
    "BlockSize": 512,
    "MaxRetries": 5
  },
  "Stripe": {
    "SecretKey": "sk_test_YOUR_KEY_HERE",
    "WebhookSecret": "whsec_YOUR_SECRET_HERE",
    "MonthlyPriceId": "price_YOUR_PRICE_ID_HERE",
    "MonthlyAmount": 2000,
    "SuccessUrl": "http://localhost:5173/subscription/success",
    "CancelUrl": "http://localhost:5173/subscription/cancel"
  },
  "JwtSettings": {
    "SecretKey": "your-256-bit-secret-key-change-this-in-production",
    "Issuer": "MassBootServer",
    "Audience": "MassBootClient",
    "ExpiryMinutes": 60
  },
  "Security": {
    "IpWhitelist": [],
    "IpBlacklist": [],
    "EnableRateLimiting": true,
    "MaxRequestsPerMinute": 100
  }
}



==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Program.cs
==============================================================================
using Microsoft.EntityFrameworkCore;
using Microsoft.AspNetCore.Authentication.JwtBearer;
using Microsoft.AspNetCore.Identity;
using Microsoft.IdentityModel.Tokens;
using System.Text;
using ProPXEServer.API.Data;
using ProPXEServer.API.Services;
using ProPXEServer.API.Security;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddDbContext<ApplicationDbContext>(options =>
    options.UseSqlite(builder.Configuration.GetConnectionString("DefaultConnection") 
        ?? "Data Source=ProPXEServer.db"));

builder.Services.AddIdentityCore<ApplicationUser>()
    .AddRoles<IdentityRole>()
    .AddEntityFrameworkStores<ApplicationDbContext>()
    .AddSignInManager()
    .AddDefaultTokenProviders();

var jwtSettings = builder.Configuration.GetSection("JwtSettings");
builder.Services.AddAuthentication(options => {
    options.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;
    options.DefaultChallengeScheme = JwtBearerDefaults.AuthenticationScheme;
})
.AddJwtBearer(options => {
    options.TokenValidationParameters = new TokenValidationParameters {
        ValidateIssuer = true,
        ValidateAudience = true,
        ValidateLifetime = true,
        ValidateIssuerSigningKey = true,
        ValidIssuer = jwtSettings["Issuer"],
        ValidAudience = jwtSettings["Audience"],
        IssuerSigningKey = new SymmetricSecurityKey(
            Encoding.UTF8.GetBytes(jwtSettings["SecretKey"] ?? throw new InvalidOperationException("JWT secret not configured")))
    };
});

builder.Services.AddAuthorization();
builder.Services.AddControllers();
builder.Services.AddOpenApi();
builder.Services.AddCors();

builder.Services.AddSingleton<HttpBootService>();
builder.Services.AddHostedService<DhcpService>();
builder.Services.AddHostedService<TftpServerService>();
builder.Services.AddPxeSecurityPolicies(builder.Configuration);

var app = builder.Build();

using (var scope = app.Services.CreateScope()) {
    var db = scope.ServiceProvider.GetRequiredService<ApplicationDbContext>();
    if (app.Environment.IsDevelopment()) {
        await db.Database.MigrateAsync();
    }
}

if (app.Environment.IsDevelopment()) {
    app.MapOpenApi();
}

app.UseCors(policy => policy
    .AllowAnyOrigin()
    .AllowAnyMethod()
    .AllowAnyHeader());

app.UseRateLimiter();

app.UseHttpsRedirection();
app.UseStaticFiles();
app.UseAuthentication();
app.UseAuthorization();

app.MapControllers();

app.MapGet("/boot/{**fileName}", async (string fileName, HttpBootService bootService, HttpContext context) => {
    return await bootService.ServeBootFile(fileName, context);
});

app.MapGet("/api/pxe/events", async (ApplicationDbContext db) => {
    return await db.PxeEvents
        .OrderByDescending(e => e.Timestamp)
        .Take(100)
        .ToListAsync();
}).RequireAuthorization();

app.Run();






==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\ProPXEServer.API.csproj
==============================================================================
<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
    <TargetFramework>net10.0</TargetFramework>
    <LangVersion>14</LangVersion>
    <Nullable>enable</Nullable>
    <ImplicitUsings>enable</ImplicitUsings>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.AspNetCore.Authentication.JwtBearer" Version="10.0.0" />
    <PackageReference Include="Microsoft.AspNetCore.Identity.EntityFrameworkCore" Version="10.0.0" />
    <PackageReference Include="Microsoft.AspNetCore.OpenApi" Version="10.0.0" />
    <PackageReference Include="Microsoft.EntityFrameworkCore.Design" Version="10.0.0">
      <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
      <PrivateAssets>all</PrivateAssets>
    </PackageReference>
    <PackageReference Include="Microsoft.EntityFrameworkCore.Sqlite" Version="10.0.0" />
    <PackageReference Include="Stripe.net" Version="47.0.0" />
  </ItemGroup>

</Project>




==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\ProPXEServer.API.http
==============================================================================
@ProPXEServer.API_HostAddress = http://localhost:5054

GET {{ProPXEServer.API_HostAddress}}/weatherforecast/
Accept: application/json

###




==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Controllers\AuthController.cs
==============================================================================
using System.IdentityModel.Tokens.Jwt;
using System.Security.Claims;
using System.Text;
using Microsoft.AspNetCore.Identity;
using Microsoft.AspNetCore.Mvc;
using Microsoft.IdentityModel.Tokens;
using ProPXEServer.API.Data;

namespace ProPXEServer.API.Controllers;

[ApiController]
[Route("api/[controller]")]
public class AuthController(
    UserManager<ApplicationUser> userManager,
    SignInManager<ApplicationUser> signInManager,
    IConfiguration configuration,
    ILogger<AuthController> logger) : ControllerBase {

    [HttpPost("register")]
    public async Task<IActionResult> Register([FromBody] RegisterRequest request) {
        try {
            var existingUser = await userManager.FindByEmailAsync(request.Email);
            if (existingUser != null) {
                return BadRequest(new { message = "Email already registered" });
            }

            var user = new ApplicationUser {
                UserName = request.Email,
                Email = request.Email,
                CreatedAt = DateTime.UtcNow,
                IsSubscribed = false
            };

            var result = await userManager.CreateAsync(user, request.Password);

            if (!result.Succeeded) {
                return BadRequest(new { 
                    message = "Registration failed", 
                    errors = result.Errors.Select(e => e.Description) 
                });
            }

            logger.LogInformation("New user registered: {Email}", request.Email);

            var token = GenerateJwtToken(user);
            return Ok(new {
                token,
                user = new {
                    user.Id,
                    user.Email,
                    user.IsSubscribed
                }
            });
        }
        catch (Exception ex) {
            logger.LogError(ex, "Registration error for {Email}", request.Email);
            return StatusCode(500, new { message = "Registration failed" });
        }
    }

    [HttpPost("login")]
    public async Task<IActionResult> Login([FromBody] LoginRequest request) {
        try {
            var user = await userManager.FindByEmailAsync(request.Email);
            if (user == null) {
                return Unauthorized(new { message = "Invalid credentials" });
            }

            var result = await signInManager.CheckPasswordSignInAsync(user, request.Password, false);
            if (!result.Succeeded) {
                return Unauthorized(new { message = "Invalid credentials" });
            }

            logger.LogInformation("User logged in: {Email}", request.Email);

            var token = GenerateJwtToken(user);
            return Ok(new {
                token,
                user = new {
                    user.Id,
                    user.Email,
                    user.IsSubscribed,
                    user.SubscriptionStatus,
                    user.SubscriptionExpiry
                }
            });
        }
        catch (Exception ex) {
            logger.LogError(ex, "Login error for {Email}", request.Email);
            return StatusCode(500, new { message = "Login failed" });
        }
    }

    [HttpGet("me")]
    public async Task<IActionResult> GetCurrentUser() {
        try {
            var userId = User.FindFirstValue(ClaimTypes.NameIdentifier);
            if (userId == null) {
                return Unauthorized();
            }

            var user = await userManager.FindByIdAsync(userId);
            if (user == null) {
                return NotFound();
            }

            return Ok(new {
                user.Id,
                user.Email,
                user.IsSubscribed,
                user.SubscriptionStatus,
                user.SubscriptionExpiry,
                user.CreatedAt
            });
        }
        catch (Exception ex) {
            logger.LogError(ex, "Error getting current user");
            return StatusCode(500, new { message = "Error fetching user data" });
        }
    }

    private string GenerateJwtToken(ApplicationUser user) {
        var jwtSettings = configuration.GetSection("JwtSettings");
        var secretKey = jwtSettings["SecretKey"];
        
        if (string.IsNullOrEmpty(secretKey)) {
            logger.LogCritical("SECURITY: JWT secret key not configured");
            throw new InvalidOperationException("Authentication disabled - JWT secret missing");
        }
        
        if (secretKey.Length < 32) {
            throw new InvalidOperationException("JWT secret must be at least 32 characters");
        }
        var key = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(secretKey));
        var credentials = new SigningCredentials(key, SecurityAlgorithms.HmacSha256);

        var claims = new[] {
            new Claim(ClaimTypes.NameIdentifier, user.Id),
            new Claim(ClaimTypes.Email, user.Email!),
            new Claim("IsSubscribed", user.IsSubscribed.ToString())
        };

        var token = new JwtSecurityToken(
            issuer: jwtSettings["Issuer"],
            audience: jwtSettings["Audience"],
            claims: claims,
            expires: DateTime.UtcNow.AddMinutes(int.Parse(jwtSettings["ExpiryMinutes"] ?? "60")),
            signingCredentials: credentials
        );

        return new JwtSecurityTokenHandler().WriteToken(token);
    }
}

public record RegisterRequest(string Email, string Password);
public record LoginRequest(string Email, string Password);






==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Controllers\BootFilesController.cs
==============================================================================
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using ProPXEServer.API.Data;

namespace ProPXEServer.API.Controllers;

[Authorize]
[ApiController]
[Route("api/[controller]")]
public class BootFilesController : ControllerBase {
    private readonly ApplicationDbContext _db;
    private readonly ILogger<BootFilesController> _logger;
    private readonly string _pxeRoot;

    public BootFilesController(ApplicationDbContext db, ILogger<BootFilesController> logger, IConfiguration config) {
        _db = db;
        _logger = logger;
        _pxeRoot = Path.Combine(Directory.GetCurrentDirectory(), "wwwroot", "pxe");
    }

    [HttpGet]
    public async Task<IActionResult> GetBootFiles() {
        try {
            var files = new List<object>();
            
            if (Directory.Exists(_pxeRoot)) {
                var allFiles = Directory.GetFiles(_pxeRoot, "*.*", SearchOption.AllDirectories);
                
                foreach (var file in allFiles) {
                    var fileInfo = new FileInfo(file);
                    var relativePath = Path.GetRelativePath(_pxeRoot, file);
                    
                    files.Add(new {
                        id = files.Count + 1,
                        fileName = Path.GetFileName(file),
                        filePath = relativePath.Replace('\\', '/'),
                        fileSizeBytes = fileInfo.Length,
                        uploadedAt = fileInfo.CreationTimeUtc,
                        architecture = GetArchitecture(file)
                    });
                }
            }

            return Ok(files);
        }
        catch (Exception ex) {
            _logger.LogError(ex, "Error listing boot files");
            return StatusCode(500, "Error listing boot files");
        }
    }

    [HttpPost("upload")]
    public async Task<IActionResult> UploadBootFile(IFormFile file) {
        if (file == null || file.Length == 0) {
            return BadRequest("No file provided");
        }

        try {
            var fileName = Path.GetFileName(file.FileName);
            var architecture = GetArchitectureFromFileName(fileName);
            var targetDir = Path.Combine(_pxeRoot, architecture.ToLower());
            
            Directory.CreateDirectory(targetDir);
            
            var filePath = Path.Combine(targetDir, fileName);

            using (var stream = new FileStream(filePath, FileMode.Create)) {
                await file.CopyToAsync(stream);
            }

            _logger.LogInformation("Uploaded boot file: {FileName} to {Architecture}", fileName, architecture);

            return Ok(new { 
                message = "File uploaded successfully",
                fileName,
                architecture,
                size = file.Length
            });
        }
        catch (Exception ex) {
            _logger.LogError(ex, "Error uploading boot file");
            return StatusCode(500, "Error uploading boot file");
        }
    }

    [HttpGet("{id}/download")]
    public IActionResult DownloadBootFile(int id, [FromQuery] string? path) {
        try {
            if (string.IsNullOrEmpty(path)) {
                return BadRequest("File path required");
            }

            // Sanitize: allow only alphanumeric, dash, underscore, dot, forward slash
            if (!System.Text.RegularExpressions.Regex.IsMatch(path, @"^[a-zA-Z0-9_\-\.\/]+$")) {
                _logger.LogWarning("Blocked suspicious path: {Path}", path);
                return BadRequest("Invalid path characters");
            }

            var fullPath = Path.GetFullPath(Path.Combine(_pxeRoot, path));
            
            // Prevent directory traversal
            if (!fullPath.StartsWith(_pxeRoot, StringComparison.OrdinalIgnoreCase)) {
                _logger.LogWarning("Directory traversal attempt: {Path}", path);
                return Forbid();
            }
            
            if (!System.IO.File.Exists(fullPath)) {
                return NotFound("File not found");
            }

            var fileBytes = System.IO.File.ReadAllBytes(fullPath);
            var fileName = Path.GetFileName(fullPath);
            
            return File(fileBytes, "application/octet-stream", fileName);
        }
        catch (Exception ex) {
            _logger.LogError(ex, "Error downloading boot file");
            return StatusCode(500, "Error downloading boot file");
        }
    }

    [HttpDelete("{id}")]
    public async Task<IActionResult> DeleteBootFile(int id, [FromQuery] string? path) {
        try {
            if (string.IsNullOrEmpty(path)) {
                return BadRequest("File path required");
            }

            var filePath = Path.Combine(_pxeRoot, path);
            
            if (!System.IO.File.Exists(filePath)) {
                return NotFound("File not found");
            }

            System.IO.File.Delete(filePath);
            _logger.LogInformation("Deleted boot file: {Path}", path);

            return Ok(new { message = "File deleted successfully" });
        }
        catch (Exception ex) {
            _logger.LogError(ex, "Error deleting boot file");
            return StatusCode(500, "Error deleting boot file");
        }
    }

    private string GetArchitecture(string filePath) {
        var fileName = Path.GetFileName(filePath).ToLowerInvariant();
        var directory = Path.GetDirectoryName(filePath)?.Split(Path.DirectorySeparatorChar).LastOrDefault()?.ToLowerInvariant();

        if (directory == "arm64" || fileName.Contains("arm64")) return "ARM64";
        if (directory == "uefi" || fileName.EndsWith(".efi")) return "UEFI";
        if (directory == "bios" || fileName.EndsWith(".kpxe") || fileName.EndsWith(".pxe")) return "BIOS";
        
        return "Unknown";
    }

    private string GetArchitectureFromFileName(string fileName) {
        var lower = fileName.ToLowerInvariant();
        if (lower.Contains("arm64")) return "ARM64";
        if (lower.EndsWith(".efi")) return "UEFI";
        if (lower.EndsWith(".kpxe") || lower.EndsWith(".pxe")) return "BIOS";
        return "BIOS";
    }
}






==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Controllers\ImagesController.cs
==============================================================================
using Microsoft.AspNetCore.Mvc;

namespace ProPXEServer.API.Controllers;

[ApiController]
[Route("api/[controller]")]
public class ImagesController : ControllerBase
{
    private readonly ILogger<ImagesController> _logger;
    private readonly IWebHostEnvironment _environment;
    private readonly string _imagesRoot;

    public ImagesController(ILogger<ImagesController> logger, IWebHostEnvironment environment)
    {
        _logger = logger;
        _environment = environment;
        _imagesRoot = Path.Combine(_environment.WebRootPath, "images");
    }

    [HttpGet]
    public IActionResult ListImages()
    {
        try
        {
            var images = new List<object>();

            if (!Directory.Exists(_imagesRoot))
            {
                return Ok(images);
            }

            var categories = new[] { "usb", "iso", "disk" };

            foreach (var category in categories)
            {
                var categoryPath = Path.Combine(_imagesRoot, category);
                if (!Directory.Exists(categoryPath)) continue;

                var files = Directory.GetFiles(categoryPath);
                foreach (var file in files)
                {
                    var fileInfo = new FileInfo(file);
                    images.Add(new
                    {
                        id = images.Count + 1,
                        fileName = fileInfo.Name,
                        category = category.ToUpper(),
                        fileSizeBytes = fileInfo.Length,
                        fileSizeMB = Math.Round(fileInfo.Length / 1024.0 / 1024.0, 2),
                        downloadUrl = $"/api/images/{category}/{fileInfo.Name}",
                        createdAt = fileInfo.CreationTimeUtc
                    });
                }
            }

            return Ok(images);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error listing distribution images");
            return StatusCode(500, "Error listing images");
        }
    }

    [HttpGet("usb/{filename}")]
    public IActionResult GetUsbImage(string filename)
    {
        return ServeImageFile("usb", filename);
    }

    [HttpGet("iso/{filename}")]
    public IActionResult GetIsoImage(string filename)
    {
        return ServeImageFile("iso", filename);
    }

    [HttpGet("disk/{filename}")]
    public IActionResult GetDiskImage(string filename)
    {
        return ServeImageFile("disk", filename);
    }

    private IActionResult ServeImageFile(string category, string filename)
    {
        try
        {
            var sanitizedFilename = Path.GetFileName(filename);
            var filePath = Path.Combine(_imagesRoot, category, sanitizedFilename);

            if (!System.IO.File.Exists(filePath))
            {
                _logger.LogWarning("Image file not found: {Category}/{Filename}", category, sanitizedFilename);
                return NotFound($"Image file '{sanitizedFilename}' not found in {category} category");
            }

            var fileInfo = new FileInfo(filePath);
            _logger.LogInformation("Serving {Category} image: {Filename} ({Size} MB)", 
                category, sanitizedFilename, Math.Round(fileInfo.Length / 1024.0 / 1024.0, 2));

            var contentType = category switch
            {
                "iso" => "application/x-iso9660-image",
                "usb" or "disk" => "application/octet-stream",
                _ => "application/octet-stream"
            };

            return PhysicalFile(filePath, contentType, sanitizedFilename);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error serving {Category} image: {Filename}", category, filename);
            return StatusCode(500, "Error serving image file");
        }
    }
}





==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Controllers\SubscriptionController.cs
==============================================================================
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Identity;
using Microsoft.AspNetCore.Mvc;
using Stripe;
using Stripe.Checkout;
using ProPXEServer.API.Data;

namespace ProPXEServer.API.Controllers;

[ApiController]
[Route("api/[controller]")]
[Authorize]
public class SubscriptionController(
    UserManager<ApplicationUser> userManager,
    IConfiguration configuration,
    ILogger<SubscriptionController> logger) : ControllerBase {

    private readonly string _stripeSecretKey = configuration["Stripe:SecretKey"] 
        ?? throw new InvalidOperationException("Stripe secret key not configured");
    private readonly string _monthlyPriceId = configuration["Stripe:MonthlyPriceId"] 
        ?? throw new InvalidOperationException("Stripe price ID not configured");

    [HttpGet("status")]
    public async Task<IActionResult> GetSubscriptionStatus() {
        try {
            var user = await userManager.GetUserAsync(User);
            if (user == null) {
                return Unauthorized();
            }

            return Ok(new {
                user.IsSubscribed,
                user.SubscriptionStatus,
                user.SubscriptionExpiry,
                user.StripeCustomerId
            });
        }
        catch (Exception ex) {
            logger.LogError(ex, "Error getting subscription status");
            return StatusCode(500, new { message = "Error fetching subscription status" });
        }
    }

    [HttpPost("create-checkout")]
    public async Task<IActionResult> CreateCheckoutSession() {
        try {
            var user = await userManager.GetUserAsync(User);
            if (user == null) {
                return Unauthorized();
            }

            StripeConfiguration.ApiKey = _stripeSecretKey;

            string? customerId = user.StripeCustomerId;
            
            if (string.IsNullOrEmpty(customerId)) {
                var customerService = new CustomerService();
                var customer = await customerService.CreateAsync(new CustomerCreateOptions {
                    Email = user.Email,
                    Metadata = new Dictionary<string, string> {
                        { "UserId", user.Id }
                    }
                });
                customerId = customer.Id;
                
                user.StripeCustomerId = customerId;
                await userManager.UpdateAsync(user);
            }

            var options = new SessionCreateOptions {
                Customer = customerId,
                PaymentMethodTypes = ["card"],
                LineItems = [
                    new SessionLineItemOptions {
                        Price = _monthlyPriceId,
                        Quantity = 1
                    }
                ],
                Mode = "subscription",
                SuccessUrl = configuration["Stripe:SuccessUrl"] ?? "http://localhost:7001/subscription/success",
                CancelUrl = configuration["Stripe:CancelUrl"] ?? "http://localhost:7001/subscription/cancel",
                Metadata = new Dictionary<string, string> {
                    { "UserId", user.Id }
                }
            };

            var service = new SessionService();
            var session = await service.CreateAsync(options);

            logger.LogInformation("Created checkout session for user {UserId}: {SessionId}", 
                user.Id, session.Id);

            return Ok(new { 
                sessionId = session.Id,
                url = session.Url
            });
        }
        catch (Exception ex) {
            logger.LogError(ex, "Error creating checkout session");
            return StatusCode(500, new { message = "Error creating checkout session" });
        }
    }

    [HttpPost("portal")]
    public async Task<IActionResult> CreatePortalSession() {
        try {
            var user = await userManager.GetUserAsync(User);
            if (user == null || string.IsNullOrEmpty(user.StripeCustomerId)) {
                return BadRequest(new { message = "No active subscription" });
            }

            StripeConfiguration.ApiKey = _stripeSecretKey;

            var options = new Stripe.BillingPortal.SessionCreateOptions {
                Customer = user.StripeCustomerId,
                ReturnUrl = configuration["Stripe:SuccessUrl"] ?? "http://localhost:7001/subscription/success"
            };

            var service = new Stripe.BillingPortal.SessionService();
            var session = await service.CreateAsync(options);

            return Ok(new { url = session.Url });
        }
        catch (Exception ex) {
            logger.LogError(ex, "Error creating portal session");
            return StatusCode(500, new { message = "Error creating portal session" });
        }
    }

    [HttpPost("webhook")]
    [AllowAnonymous]
    public async Task<IActionResult> HandleWebhook() {
        try {
            var json = await new StreamReader(HttpContext.Request.Body).ReadToEndAsync();
            var webhookSecret = configuration["Stripe:WebhookSecret"];

            Event stripeEvent;
            try {
                stripeEvent = EventUtility.ConstructEvent(
                    json,
                    Request.Headers["Stripe-Signature"],
                    webhookSecret,
                    throwOnApiVersionMismatch: true
                );
            }
            catch (StripeException ex) {
                logger.LogWarning(ex, "Invalid Stripe webhook signature from {IP}", HttpContext.Connection.RemoteIpAddress);
                return Unauthorized("Invalid signature");
            }
            catch (Exception ex) {
                logger.LogError(ex, "Webhook signature verification failed");
                return BadRequest();
            }

            logger.LogInformation("Processing Stripe webhook: {EventType}", stripeEvent.Type);

            switch (stripeEvent.Type) {
                case "checkout.session.completed":
                    await HandleCheckoutCompleted(stripeEvent);
                    break;
                
                case "customer.subscription.updated":
                case "customer.subscription.created":
                    await HandleSubscriptionUpdated(stripeEvent);
                    break;
                
                case "customer.subscription.deleted":
                    await HandleSubscriptionDeleted(stripeEvent);
                    break;
                
                case "invoice.payment_succeeded":
                    await HandlePaymentSucceeded(stripeEvent);
                    break;
                
                case "invoice.payment_failed":
                    await HandlePaymentFailed(stripeEvent);
                    break;
            }

            return Ok();
        }
        catch (Exception ex) {
            logger.LogError(ex, "Error handling webhook");
            return StatusCode(500);
        }
    }

    private async Task HandleCheckoutCompleted(Event stripeEvent) {
        var session = stripeEvent.Data.Object as Session;
        if (session == null) return;

        var userId = session.Metadata["UserId"];
        var user = await userManager.FindByIdAsync(userId);
        if (user == null) return;

        user.IsSubscribed = true;
        user.SubscriptionStatus = "active";
        await userManager.UpdateAsync(user);

        logger.LogInformation("Checkout completed for user {UserId}", userId);
    }

    private async Task HandleSubscriptionUpdated(Event stripeEvent) {
        var subscription = stripeEvent.Data.Object as Subscription;
        if (subscription == null) return;

        StripeConfiguration.ApiKey = _stripeSecretKey;
        var customerService = new CustomerService();
        var customer = await customerService.GetAsync(subscription.CustomerId);

        if (!customer.Metadata.TryGetValue("UserId", out var userId)) return;

        var user = await userManager.FindByIdAsync(userId);
        if (user == null) return;

        user.IsSubscribed = subscription.Status == "active";
        user.SubscriptionStatus = subscription.Status;
        user.SubscriptionExpiry = subscription.CurrentPeriodEnd;
        await userManager.UpdateAsync(user);

        logger.LogInformation("Subscription updated for user {UserId}: {Status}", 
            userId, subscription.Status);
    }

    private async Task HandleSubscriptionDeleted(Event stripeEvent) {
        var subscription = stripeEvent.Data.Object as Subscription;
        if (subscription == null) return;

        StripeConfiguration.ApiKey = _stripeSecretKey;
        var customerService = new CustomerService();
        var customer = await customerService.GetAsync(subscription.CustomerId);

        if (!customer.Metadata.TryGetValue("UserId", out var userId)) return;

        var user = await userManager.FindByIdAsync(userId);
        if (user == null) return;

        user.IsSubscribed = false;
        user.SubscriptionStatus = "canceled";
        await userManager.UpdateAsync(user);

        logger.LogInformation("Subscription deleted for user {UserId}", userId);
    }

    private async Task HandlePaymentSucceeded(Event stripeEvent) {
        var invoice = stripeEvent.Data.Object as Invoice;
        if (invoice == null) return;

        logger.LogInformation("Payment succeeded for customer {CustomerId}", 
            invoice.CustomerId);
    }

    private async Task HandlePaymentFailed(Event stripeEvent) {
        var invoice = stripeEvent.Data.Object as Invoice;
        if (invoice == null) return;

        logger.LogWarning("Payment failed for customer {CustomerId}", 
            invoice.CustomerId);
    }
}







==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Data\ApplicationDbContext.cs
==============================================================================
using Microsoft.AspNetCore.Identity.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore;

namespace ProPXEServer.API.Data;

public class ApplicationDbContext : IdentityDbContext<ApplicationUser> {
    
    public ApplicationDbContext(DbContextOptions<ApplicationDbContext> options) 
        : base(options) {
    }
    
    public DbSet<BootFile> BootFiles => Set<BootFile>();
    public DbSet<PxeEvent> PxeEvents => Set<PxeEvent>();
    public DbSet<BootConfiguration> BootConfigurations => Set<BootConfiguration>();
    
    protected override void OnModelCreating(ModelBuilder builder) {
        base.OnModelCreating(builder);
        
        builder.Entity<BootFile>()
            .HasIndex(b => b.UserId);
        
        builder.Entity<PxeEvent>()
            .HasIndex(p => p.Timestamp);
        
        builder.Entity<PxeEvent>()
            .HasIndex(p => p.MacAddress);
        
        builder.Entity<BootConfiguration>()
            .HasIndex(bc => bc.MacAddress)
            .IsUnique();
    }
}






==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Data\ApplicationUser.cs
==============================================================================
using Microsoft.AspNetCore.Identity;

namespace ProPXEServer.API.Data;

public class ApplicationUser : IdentityUser {
    public string? StripeCustomerId { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public bool IsSubscribed { get; set; }
    public DateTime? SubscriptionExpiry { get; set; }
    public string? SubscriptionStatus { get; set; }
}






==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Data\BootConfiguration.cs
==============================================================================
using System.ComponentModel.DataAnnotations;

namespace ProPXEServer.API.Data;

public class BootConfiguration {
    [Key]
    public int Id { get; set; }

    [Required]
    [MaxLength(17)]
    public string MacAddress { get; set; } = string.Empty;

    [MaxLength(255)]
    public string? CustomBootFile { get; set; }

    [MaxLength(50)]
    public string Architecture { get; set; } = "BIOS";

    public bool Enabled { get; set; } = true;

    public string? Notes { get; set; }

    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;

    public DateTime? LastBootedAt { get; set; }

    public int BootCount { get; set; } = 0;
}






==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Data\BootFile.cs
==============================================================================
namespace ProPXEServer.API.Data;

public class BootFile {
    public int Id { get; set; }
    public required string FileName { get; set; }
    public required string FilePath { get; set; }
    public long FileSizeBytes { get; set; }
    public string? Description { get; set; }
    public DateTime UploadedAt { get; set; } = DateTime.UtcNow;
    public required string UserId { get; set; }
    public ApplicationUser User { get; set; } = null!;
}






==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Data\endpoints.yml
==============================================================================
endpoints:
  kali-xfce-squash:
    path: /debian-squash/releases/download/2025.3-8e024a88/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: kali
    version: '2025.3'
    flavor: xfce
    kernel: kali-xfce-squash
  kde-neon-user:
    path: /ubuntu-squash/releases/download/20251030-0745-9b372e2a/
    files:
    - vmlinuz
    - filesystem.squashfs
    - initrd.lz
    os: neon
    version: 20251030-0745
    flavor: user
    kernel: kde-neon-user
  regolith-current:
    path: /ubuntu-squash/releases/download/1.2-e7db33e3/
    files:
    - initrd
    - vmlinuz
    - filesystem.squashfs
    os: regolith
    version: current
    flavor: ubuntu
    kernel: regolith-current
  breakin:
    path: /asset-mirror/releases/download/4.26.1-f22abf78/
    files:
    - vmlinuz
    - initrd
    os: breakin
    version: 4.26.1
  dban:
    path: /asset-mirror/releases/download/2.3.0-a5b9d879/
    files:
    - DBAN.BZI
    os: dban
    version: 2.3.0
  sparky-stable-mingui:
    path: /debian-squash/releases/download/8.0.1-6c87e83c/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: sparky
    version: stable
    flavor: xfce-min
    kernel: sparky-stable-mingui
  sparky-stable-gui:
    path: /debian-squash/releases/download/8.0.1-d38c17d0/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: sparky
    version: stable
    flavor: xfce
    kernel: sparky-stable-gui
  sparky-stable-lxqt:
    path: /debian-squash/releases/download/8.0.1-f9c9e1f1/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: sparky
    version: stable
    flavor: lxqt
    kernel: sparky-stable-lxqt
  sparky-rolling-mingui:
    path: /debian-squash/releases/download/2025.09-db19bb55/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: sparky
    version: rolling
    flavor: xfce-min
    kernel: sparky-rolling-mingui
  sparky-rolling-gui:
    path: /debian-squash/releases/download/2025.09-66a56f08/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: sparky
    version: rolling
    flavor: xfce
    kernel: sparky-rolling-gui
  sparky-rolling-lxqt:
    path: /debian-squash/releases/download/2025.09-2b965fd7/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: sparky
    version: rolling
    flavor: lxqt
    kernel: sparky-rolling-lxqt
  oracle-8:
    path: /asset-mirror/releases/download/6-1525fd25/
    files:
    - vmlinuz
    - initrd
    - squashfs.img
    os: oracle
    version: '8'
    arch: x86_64
  kodachi-6:
    path: /ubuntu-squash/releases/download/6.2-2a23039c/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: kodachi
    version: '6'
  devuan-ascii:
    path: /debian-squash/releases/download/2.1-c1f637a9/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: devuan
    version: '2'
    flavor: ascii
  gparted-stable:
    path: /debian-squash/releases/download/1.7.0-8-bca5f701/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: gparted
    version: stable
  rescatux:
    path: /debian-squash/releases/download/0.72-beta8-55ca0efd/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: rescatux
    version: current
  caine:
    path: /ubuntu-squash/releases/download/13.0-68785ee5/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: caine
    version: '13.0'
  dts:
    path: /dts/v2.7.1
    files:
    - initrd
    - vmlinuz
    os: dts
    version: 2.7.1
  bootrepair:
    path: /ubuntu-squash/releases/download/current-e035b00c/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: bootrepair
    version: current
  blackarch-installer:
    path: /asset-mirror/releases/download/2023.04.01-d7a6ad88/
    files:
    - initrd
    - vmlinuz
    - airootfs.sfs
    os: blackarch
    version: current
  bluestar:
    path: /asset-mirror/releases/download/6.7.8-2024.03.04-d4e083fc/
    files:
    - initrd
    - vmlinuz
    - airootfs.sfs
    os: bluestar
    version: current
  zeninstall:
    path: /asset-mirror/releases/download/2020.05.27-a5eae279/
    files:
    - initrd
    - vmlinuz
    - airootfs.sfs
    os: zeninstall
    version: current
  lxle:
    path: /ubuntu-squash/releases/download/18.04.3-83291c4b/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: lxle
    version: current
  kaspersky-rescue:
    path: /asset-mirror/releases/download/18-7f6056db/
    files:
    - initrd.xz
    - initrd
    - vmlinuz
    - kernel.dat
    - 000-core.srm
    - 001-xorg.srm
    - 002-xfce.srm
    - 003-kl.srm
    - 004-krt.srm
    - 005-bases.srm
    - 008-firefox.srm
    os: kaspersky
    version: '18'
  septor:
    path: /debian-squash/releases/download/2022-4bfba007/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: septor
    version: current
  manjaro-xfce-current:
    path: /manjaro-squash/releases/download/24.2.1-241216-linux612-58470e08/
    files:
    - livefs.sfs
    - rootfs.sfs
    - mhwdfs.sfs
    - desktopfs.sfs
    - initrd
    - vmlinuz
    os: manjaro
    version: current
    flavor: xfce
    kernel: manjaro-xfce-current
  manjaro-gnome-current:
    path: /manjaro-squash/releases/download/24.2.1-241216-linux612-e001c928/
    files:
    - livefs.sfs
    - rootfs.sfs
    - mhwdfs.sfs
    - desktopfs.sfs
    - initrd
    - vmlinuz
    os: manjaro
    version: current
    flavor: gnome
    kernel: manjaro-gnome-current
  manjaro-kde-current:
    path: /manjaro-squash/releases/download/24.2.1-241216-linux612-41601e40/
    files:
    - livefs.sfs
    - rootfs.sfs
    - mhwdfs.sfs
    - desktopfs.sfs
    - initrd
    - vmlinuz
    os: manjaro
    version: current
    flavor: kde
    kernel: manjaro-kde-current
  fatdog:
    path: /asset-mirror/releases/download/903-ddcb82ff/
    files:
    - vmlinuz
    - initrd
    os: fatdog
    version: current
  raizo:
    path: /debian-squash/releases/download/v16.25.04.12i-cdb1c06f/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: raizo
    version: current
  4mlinux:
    path: /asset-mirror/releases/download/49.0-c292230f/
    files:
    - initrd
    - vmlinuz
    os: 4mlinux
    version: current
    flavor: full
  4mlinux-thesss:
    path: /asset-mirror/releases/download/50.0-4aab1393/
    files:
    - initrd
    - vmlinuz
    os: 4mlinux
    version: current
    flavor: TheSSS
  4mlinux-bakandimg:
    path: /asset-mirror/releases/download/48.0-d0598ee4/
    files:
    - initrd
    - vmlinuz
    os: 4mlinux
    version: current
    flavor: BakAndImg
  4mlinux-antivirus:
    path: /asset-mirror/releases/download/50.0-1.4.3-43b0f75b/
    files:
    - initrd
    - vmlinuz
    os: 4mlinux
    version: current
    flavor: AntivirusLiveCD
  ubuntu-20.04-default-squash:
    path: /ubuntu-squash/releases/download/20.04.6-c92baa25/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: ubuntu
    version: '20.04'
    flavor: GNOME
    kernel: ubuntu-20.04-default-squash
  ubuntu-20.04-KDE-squash:
    path: /ubuntu-squash/releases/download/20.04.6-c08faa24/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: ubuntu
    version: '20.04'
    flavor: KDE
    kernel: ubuntu-20.04-KDE-squash
  ubuntu-20.04-XFCE-squash:
    path: /ubuntu-squash/releases/download/20.04.6-ad603665/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: ubuntu
    version: '20.04'
    flavor: XFCE
    kernel: ubuntu-20.04-XFCE-squash
  ubuntu-20.04-Budgie-squash:
    path: /ubuntu-squash/releases/download/20.04.6-a64212f3/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: ubuntu
    version: '20.04'
    flavor: Budgie
    kernel: ubuntu-20.04-Budgie-squash
  ubuntu-20.04-MATE-squash:
    path: /ubuntu-squash/releases/download/20.04.6-8e277cc9/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: ubuntu
    version: '20.04'
    flavor: MATE
    kernel: ubuntu-20.04-MATE-squash
  ubuntu-20.04-kylin-squash:
    path: /ubuntu-squash/releases/download/20.04.6-08c13e9b/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: ubuntu
    version: '20.04'
    flavor: kylin
    kernel: ubuntu-20.04-kylin-squash
  voyager-focal-squash:
    path: /ubuntu-squash/releases/download/focal-594b12a7/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: Voyager
    version: focal
    flavor: focal
    kernel: voyager-focal-squash
  pop-20.04-default-squash:
    path: /ubuntu-squash/releases/download/5-66b7e861/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: pop
    version: '20.04'
    flavor: intel-amd
    kernel: pop-20.04-default-squash
  pop-20.04-nvidia-squash:
    path: /ubuntu-squash/releases/download/5-6efd1d75/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: pop
    version: '20.04'
    flavor: nvidia
    kernel: pop-20.04-nvidia-squash
  nixos-20.03:
    path: /asset-mirror/releases/download/124244129-bd20f138/
    files:
    - bzImage
    - initrd
    - netboot.ipxe
    os: nixos
    version: '20.03'
  kodachi-7:
    path: /ubuntu-squash/releases/download/7.6-5b1ead62/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: kodachi
    version: '7'
  linux-lite-5-squash:
    path: /ubuntu-squash/releases/download/5.8-75cb937c/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: lite
    version: 5.8
    kernel: linux-lite-5-squash
  vyos-rolling:
    path: /debian-squash/releases/download/2025.11.04-0019-rolling-0d0f700e/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: vyos
    version: rolling
    flavor: rolling
    kernel: vyos-rolling
  pureos-gnome:
    path: /ubuntu-squash/releases/download/2020-08-06-83257efc/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: pureos
    version: current
    flavor: gnome
    kernel: pureos-gnome
  rescuezilla:
    path: /asset-mirror/releases/download/2.6.1-2ace42ce/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: rescuezilla
    version: 2.6.1
  nitrux-release:
    path: /ubuntu-squash/releases/download/2022.02.28-e364d0a5/
    files:
    - initrd
    - vmlinuz
    - filesystem.squashfs
    os: nitrux
    version: 2022.02.28
  endeavouros:
    path: /asset-mirror/releases/download/Neo-2025.03.19-aaf870af/
    files:
    - airootfs.sfs
    - initrd
    - vmlinuz
    os: endeavouros
    version: Neo-2025.03.19
  kodachi-8:
    path: /ubuntu-squash/releases/download/8.2-625e11fa/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: kodachi
    version: '8'
  redorescue:
    path: /asset-mirror/releases/download/4.0.0-838b6fef/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: redorescue
    version: 4.0.0
  elementaryos-6-default-squash:
    path: /ubuntu-squash/releases/download/6-3e90a5ea/
    files:
    - initrd
    - vmlinuz
    - filesystem.squashfs
    os: elementary-os
    version: '6'
    kernel: elementaryos-6-default-squash
  voyager-bullseye-squash:
    path: /debian-squash/releases/download/bullseye-f449bf64/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: Voyager
    version: bullseye
    flavor: bullseye
    kernel: voyager-bullseye-squash
  memtest86:
    path: /asset-mirror/releases/download/11.5-2ae1d21b/
    files:
    - memtest86-usb.img
    os: memtest86-free
    version: '11.5'
  gentoo-x86:
    path: /asset-mirror/releases/download/20241209T170323Z-5b773f72/
    files:
    - image.squashfs
    - initrd
    - vmlinuz
    os: gentoo
    version: 20241209T170323Z
    arch: x86
  gentoo-arm64:
    path: /asset-mirror/releases/download/20251019T224842Z-d5972d15/
    files:
    - image.squashfs
    - initrd
    - vmlinuz
    os: gentoo
    version: 20251019T224842Z
    arch: arm64
  gentoo-amd64:
    path: /asset-mirror/releases/download/20250608T165347Z-63d6ec39/
    files:
    - image.squashfs
    - initrd
    - vmlinuz
    os: gentoo
    version: 20250608T165347Z
    arch: amd64
  tails:
    path: /asset-mirror/releases/download/7.1-00388326/
    files:
    - vmlinuz
    - initrd.img
    - 9990-misc-helpers.sh
    - tails-amd64.iso
    os: tails
    version: '7.1'
    arch: amd64
  hrmpf:
    path: /asset-mirror/releases/download/20231124-1008bb6d/
    files:
    - vmlinuz
    - initrd
    - squashfs.img
    os: hrmpf
    version: '20231124'
  ubuntu-netboot-20.04-arm64:
    path: /ubuntu-squash/releases/download/20.04.5-3362c70d/
    files:
    - initrd
    - vmlinuz
    os: ubuntu
    version: 20.04.5
    codename: focal
    flavor: netboot
    kernel: ubuntu-netboot-20.04-arm64
    arch: arm64
  ubuntu-netboot-20.04-amd64:
    path: /ubuntu-squash/releases/download/20.04.6-6cac7910/
    files:
    - initrd
    - vmlinuz
    os: ubuntu
    version: 20.04.6
    codename: focal
    flavor: netboot
    kernel: ubuntu-netboot-20.04-amd64
    arch: amd64
  systemrescue-i686:
    path: /asset-mirror/releases/download/9.03-0f19cc5c/
    files:
    - airootfs.sfs
    - initrd
    - vmlinuz
    os: systemrescue
    version: 9.03
    arch: i686
  systemrescue-amd64:
    path: /asset-mirror/releases/download/12.02-046a7ade/
    files:
    - airootfs.sfs
    - initrd
    - vmlinuz
    - archiso_pxe_http
    os: systemrescue
    version: 12.02
    arch: amd64
  shredos-i686:
    path: /asset-mirror/releases/download/0.34_32-bit_20221231-3adcc4d0/
    files:
    - shredos
    os: shredos
    version: 0.34_32-bit_20221231
    arch: i686
  shredos-x86_64:
    path: /asset-mirror/releases/download/2024.11_27_x86-64_0.38-fa89876c/
    files:
    - shredos
    os: shredos
    version: 2024.11_27_x86-64_0.38
    arch: x86_64
  archlinux-32:
    path: /asset-mirror/releases/download/2024.07.10-1d684723/
    files:
    - airootfs.sfs
    - initramfs-linux.img
    - vmlinuz-linux
    os: archlinux
    version: 2024.07.10
    arch: i686
  clonezilla-debian-stable-amd64:
    path: /debian-squash/releases/download/3.3.0-33-9c8061ac/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: clonezilla
    version: 3.3.0-33
    flavor: stable
    kernel: clonezilla-debian-stable-amd64
    arch: amd64
  clonezilla-ubuntu-stable-amd64:
    path: /ubuntu-squash/releases/download/20251017-questing-c0f6109b/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: clonezilla
    version: 20251017-questing
    flavor: stable
    kernel: clonezilla-ubuntu-stable-amd64
    arch: amd64
  clonezilla-debian-testing-amd64:
    path: /debian-squash/releases/download/3.3.0-37-47a038f9/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: clonezilla
    version: 3.3.0-37
    flavor: testing
    kernel: clonezilla-debian-testing-amd64
    arch: amd64
  clonezilla-ubuntu-testing-amd64:
    path: /ubuntu-squash/releases/download/20251101-resolute-0d4c667b/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: clonezilla
    version: 20251101-resolute
    flavor: testing
    kernel: clonezilla-ubuntu-testing-amd64
    arch: amd64
  garuda-dr460nized-gaming:
    path: /asset-mirror/releases/download/250801-a96201bb/
    files:
    - amd_ucode.img
    - desktopfs.sfs
    - intel_ucode.img
    - livefs.sfs
    - initramfs.img
    - mhwdfs.sfs
    - rootfs.sfs
    - vmlinuz
    os: garuda
    flavor: dr460nized-gaming
    version: 250801
  garuda-dr460nized:
    path: /asset-mirror/releases/download/250801-f610be58/
    files:
    - amd_ucode.img
    - desktopfs.sfs
    - intel_ucode.img
    - livefs.sfs
    - initramfs.img
    - mhwdfs.sfs
    - rootfs.sfs
    - vmlinuz
    os: garuda
    flavor: dr460nized
    version: 250801
  garuda-xfce:
    path: /asset-mirror/releases/download/250801-c866e6bf/
    files:
    - amd_ucode.img
    - desktopfs.sfs
    - intel_ucode.img
    - livefs.sfs
    - initramfs.img
    - mhwdfs.sfs
    - rootfs.sfs
    - vmlinuz
    os: garuda
    flavor: xfce
    version: 250801
  garuda-gnome:
    path: /asset-mirror/releases/download/250801-c80a21be/
    files:
    - amd_ucode.img
    - desktopfs.sfs
    - intel_ucode.img
    - livefs.sfs
    - initramfs.img
    - mhwdfs.sfs
    - rootfs.sfs
    - vmlinuz
    os: garuda
    flavor: gnome
    version: 250801
  garuda-lxqt-kwin:
    path: /asset-mirror/releases/download/230501-f13b4b24/
    files:
    - amd_ucode.img
    - desktopfs.sfs
    - intel_ucode.img
    - livefs.sfs
    - initramfs.img
    - mhwdfs.sfs
    - rootfs.sfs
    - vmlinuz
    os: garuda
    flavor: lxqt-kwin
    version: 230501
  garuda-wayfire:
    path: /asset-mirror/releases/download/230501-61b681d1/
    files:
    - amd_ucode.img
    - desktopfs.sfs
    - intel_ucode.img
    - livefs.sfs
    - initramfs.img
    - mhwdfs.sfs
    - rootfs.sfs
    - vmlinuz
    os: garuda
    flavor: wayfire
    version: 230501
  garuda-qtile:
    path: /asset-mirror/releases/download/231029-9dfb930b/
    files:
    - amd_ucode.img
    - desktopfs.sfs
    - intel_ucode.img
    - livefs.sfs
    - initramfs.img
    - mhwdfs.sfs
    - rootfs.sfs
    - vmlinuz
    os: garuda
    flavor: qtile
    version: 231029
  garuda-i3wm:
    path: /asset-mirror/releases/download/250801-d48b8f05/
    files:
    - amd_ucode.img
    - desktopfs.sfs
    - intel_ucode.img
    - livefs.sfs
    - initramfs.img
    - mhwdfs.sfs
    - rootfs.sfs
    - vmlinuz
    os: garuda
    flavor: i3wm
    version: 250801
  garuda-sway:
    path: /asset-mirror/releases/download/250801-8d451890/
    files:
    - amd_ucode.img
    - desktopfs.sfs
    - intel_ucode.img
    - livefs.sfs
    - initramfs.img
    - mhwdfs.sfs
    - rootfs.sfs
    - vmlinuz
    os: garuda
    flavor: sway
    version: 250801
  garuda-mate:
    path: /asset-mirror/releases/download/230501-3af08aa6/
    files:
    - amd_ucode.img
    - desktopfs.sfs
    - intel_ucode.img
    - livefs.sfs
    - initramfs.img
    - mhwdfs.sfs
    - rootfs.sfs
    - vmlinuz
    os: garuda
    flavor: mate
    version: 230501
  garuda-kde-barebones:
    path: /asset-mirror/releases/download/220329-198784ed/
    files:
    - amd_ucode.img
    - desktopfs.sfs
    - intel_ucode.img
    - livefs.sfs
    - initramfs.img
    - mhwdfs.sfs
    - rootfs.sfs
    - vmlinuz
    os: garuda
    flavor: kde-barebones
    version: 220329
  proxmox-backup-server:
    path: /asset-mirror/releases/download/4.0-1-f308cf4b/
    files:
    - initrd
    - vmlinuz
    - proxmox.iso
    os: proxmox-backup-server
    version: 4.0-1
  proxmox-ve:
    path: /asset-mirror/releases/download/9.0-1-613c19ff/
    files:
    - initrd
    - proxmox.iso
    - vmlinuz
    os: proxmox-ve
    version: 9.0-1
  proxmox-mailgateway:
    path: /asset-mirror/releases/download/9.0-1-8374c64d/
    files:
    - initrd
    - vmlinuz
    - proxmox.iso
    os: proxmox-mailgateway
    version: 9.0-1
  ubuntu-netboot-22.04-amd64:
    path: /ubuntu-squash/releases/download/22.04.5-295657f3/
    files:
    - initrd
    - vmlinuz
    os: ubuntu
    version: 22.04.5
    codename: jammy
    flavor: netboot
    kernel: ubuntu-netboot-22.04-amd64
    arch: amd64
  ubuntu-netboot-22.04-arm64:
    path: /ubuntu-squash/releases/download/22.04.5-32a0e326/
    files:
    - initrd
    - vmlinuz
    os: ubuntu
    version: 22.04.5
    codename: jammy
    flavor: netboot
    kernel: ubuntu-netboot-22.04-arm64
    arch: arm64
  ubuntu-22.04-default-squash:
    path: /ubuntu-squash/releases/download/22.04.5-b0159fca/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: ubuntu
    version: '22.04'
    flavor: GNOME
    kernel: ubuntu-22.04-default-squash
  ubuntu-22.04-XFCE-squash:
    path: /ubuntu-squash/releases/download/22.04.5-1a95043e/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: ubuntu
    version: '22.04'
    flavor: XFCE
    kernel: ubuntu-22.04-XFCE-squash
  ubuntu-22.04-MATE-squash:
    path: /ubuntu-squash/releases/download/22.04.5-e4bfedfe/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: ubuntu
    version: '22.04'
    flavor: MATE
    kernel: ubuntu-22.04-MATE-squash
  ubuntu-22.04-Budgie-squash:
    path: /ubuntu-squash/releases/download/22.04.5-7f1ad0e4/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: ubuntu
    version: '22.04'
    flavor: Budgie
    kernel: ubuntu-22.04-Budgie-squash
  ubuntu-22.04-KDE-squash:
    path: /ubuntu-squash/releases/download/22.04.5-36909c4f/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: ubuntu
    version: '22.04'
    flavor: KDE
    kernel: ubuntu-22.04-KDE-squash
  ubuntu-22.04-kylin-squash:
    path: /ubuntu-squash/releases/download/22.04.5-14797330/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: ubuntu
    version: '22.04'
    flavor: kylin
    kernel: ubuntu-22.04-kylin-squash
  voyager-jammy-squash:
    path: /ubuntu-squash/releases/download/jammy-d0714f36/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: Voyager
    version: jammy
    flavor: jammy
    kernel: voyager-jammy-squash
  pop-22.04-default-squash:
    path: /ubuntu-squash/releases/download/21-3c299ef8/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: pop
    version: '22.04'
    flavor: intel-amd
    kernel: pop-22.04-default-squash
  vmware-photon-x86_64:
    path: /asset-mirror/releases/download/4.0-453a4a7b/
    files:
    - initrd.img
    - vmlinuz
    os: vmware-photon
    version: '4.0'
    arch: x86_64
  vmware-photon-aarch64:
    path: /asset-mirror/releases/download/4.0-4e0c6bec/
    files:
    - initrd.img
    - vmlinuz
    os: vmware-photon
    version: '4.0'
    arch: aarch64
  harvester:
    path: /asset-mirror/releases/download/v1.6.1-c82c6d22/
    files:
    - harvester-vmlinuz-amd64
    - harvester-initrd-amd64
    - harvester-rootfs-amd64.squashfs
    - harvester-amd64.sha512
    - version.yaml
    os: harvester
    version: v1.6.1
  linux-lite-6-squash:
    path: /ubuntu-squash/releases/download/6.4-2550834c/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: lite
    version: 6.4
    kernel: linux-lite-6-squash
  mint-21-cinnamon-squash:
    path: /ubuntu-squash/releases/download/21-1ff19e78/
    files:
    - initrd
    - vmlinuz
    - filesystem.squashfs
    os: mint
    version: '21'
    flavor: Cinnamon
    kernel: mint-21-cinnamon-squash
  mint-21-mate-squash:
    path: /ubuntu-squash/releases/download/21-b57bf769/
    files:
    - initrd
    - vmlinuz
    - filesystem.squashfs
    os: mint
    version: '21'
    flavor: mate
    kernel: mint-21-mate-squash
  mint-21-xfce-squash:
    path: /ubuntu-squash/releases/download/21-41ed8540/
    files:
    - initrd
    - vmlinuz
    - filesystem.squashfs
    os: mint
    version: '21'
    flavor: xfce
    kernel: mint-21-xfce-squash
  oracle-9-x86_64:
    path: /asset-mirror/releases/download/U0-5d86c3df/
    files:
    - vmlinuz
    - initrd
    - squashfs.img
    os: oracle
    version: '9'
    arch: x86_64
  oracle-9-aarch64:
    path: /asset-mirror/releases/download/U0-f2411221/
    files:
    - vmlinuz
    - initrd
    - squashfs.img
    os: oracle
    version: '9'
    arch: aarch64
  parrot-home:
    path: /debian-squash/releases/download/6.3.2-37ae0f27/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: parrot
    version: 6.3.2
    flavor: home
  parrot-security:
    path: /debian-squash/releases/download/6.3.2-999ed7ad/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: parrot
    version: 6.3.2
    flavor: security
  xcp-ng:
    path: /asset-mirror/releases/download/8.3-55521b28/
    files:
    - xen.gz
    - vmlinuz
    - install.img
    os: xcp-ng
    version: '8.2'
  garuda-cinnamon:
    path: /asset-mirror/releases/download/250801-0b360492/
    files:
    - amd_ucode.img
    - desktopfs.sfs
    - intel_ucode.img
    - livefs.sfs
    - initramfs.img
    - mhwdfs.sfs
    - rootfs.sfs
    - vmlinuz
    os: garuda
    flavor: cinnamon
    version: 250801
  elementaryos-7-default-squash:
    path: /ubuntu-squash/releases/download/7-3e6e05f6/
    files:
    - initrd
    - vmlinuz
    - filesystem.squashfs
    os: elementary-os
    version: '7'
    kernel: elementaryos-7-default-squash
  ubuntu-20.04-LXQT-squash:
    path: /ubuntu-squash/releases/download/20.04.5-95f04bf8/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: ubuntu
    version: '20.04'
    flavor: LXQT
    kernel: ubuntu-20.04-LXQT-squash
  debian-12-live-kernel:
    path: /debian-core-12/releases/download/12.11.0-7dc3f9f3/
    files:
    - initrd
    - vmlinuz
    os: debian
    version: '12'
  debian-12-default-squash:
    path: /debian-squash/releases/download/12.11.0-b545a82c/
    files:
    - filesystem.squashfs
    os: debian
    version: '12'
    flavor: core
    kernel: debian-12-live-kernel
  debian-12-gnome-squash:
    path: /debian-squash/releases/download/12.11.0-d2c07a8a/
    files:
    - filesystem.squashfs
    os: debian
    version: '12'
    flavor: gnome
    kernel: debian-12-live-kernel
  debian-12-cinnamon-squash:
    path: /debian-squash/releases/download/12.11.0-c84a8c03/
    files:
    - filesystem.squashfs
    os: debian
    version: '12'
    flavor: cinnamon
    kernel: debian-12-live-kernel
  debian-12-lxqt-squash:
    path: /debian-squash/releases/download/12.11.0-43f2cd09/
    files:
    - filesystem.squashfs
    os: debian
    version: '12'
    flavor: lxqt
    kernel: debian-12-live-kernel
  debian-12-mate-squash:
    path: /debian-squash/releases/download/12.11.0-1a8949e5/
    files:
    - filesystem.squashfs
    os: debian
    version: '12'
    flavor: mate
    kernel: debian-12-live-kernel
  debian-12-lxde-squash:
    path: /debian-squash/releases/download/12.11.0-b3449bd8/
    files:
    - filesystem.squashfs
    os: debian
    version: '12'
    flavor: lxde
    kernel: debian-12-live-kernel
  debian-12-xfce-squash:
    path: /debian-squash/releases/download/12.11.0-40a848cc/
    files:
    - filesystem.squashfs
    os: debian
    version: '12'
    flavor: xfce
    kernel: debian-12-live-kernel
  debian-12-kde-squash:
    path: /debian-squash/releases/download/12.11.0-90c96885/
    files:
    - filesystem.squashfs
    os: debian
    version: '12'
    flavor: kde
    kernel: debian-12-live-kernel
  ubuntu-22.04-LXQT-squash:
    path: /ubuntu-squash/releases/download/22.04.5-e60a4189/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: ubuntu
    version: '22.04'
    flavor: LXQT
    kernel: ubuntu-22.04-LXQT-squash
  backbox-default-squash:
    path: /ubuntu-squash/releases/download/8.1-c2287989/
    files:
    - initrd
    - vmlinuz
    - filesystem.squashfs
    os: BackBox
    version: '8.1'
    flavor: desktop
    kernel: backbox-default-squash
  bodhi-standard:
    path: /ubuntu-squash/releases/download/7.0.0-a4394ab0/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: bodhi
    version: 7.0.0
    flavor: standard
  bodhi-apppack:
    path: /ubuntu-squash/releases/download/7.0.0-c167c30e/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: bodhi
    version: 7.0.0
    flavor: apppack
  mfsbsd-14:
    path: /asset-mirror/releases/download/14.2-a5094acd/
    files:
    - default.img
    - special-edition.img
    os: freebsd
    version: '14'
  zorin-core-squash:
    path: /ubuntu-squash/releases/download/17.3-a87e018b/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: zorin
    version: '17.3'
    flavor: Core
    kernel: zorin-core-squash
  q4os-plasma-squash:
    path: /debian-squash/releases/download/6.2-3af797cd/
    files:
    - filesystem.squashfs
    os: Q4OS
    version: '6.2'
    flavor: plasma
    kernel: q4os-default-squash
  q4os-default-squash:
    path: /debian-squash/releases/download/6.2-d1a34866/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: Q4OS
    version: '6.2'
    flavor: trinity
    kernel: q4os-default-squash
  memtest86plus:
    path: /asset-mirror/releases/download/7.20-014832f7/
    files:
    - memtest32.bin
    - memtest32.efi
    - memtest64.bin
    - memtest64.efi
    os: memtest86-plus
    version: '7.20'
  ubuntu-netboot-24.04-arm64:
    path: /ubuntu-squash/releases/download/24.04.3-7b71a472/
    files:
    - initrd
    - vmlinuz
    os: ubuntu
    version: 24.04.3
    codename: noble
    flavor: netboot
    kernel: ubuntu-netboot-24.04-arm64
    arch: arm64
  ubuntu-netboot-24.04-amd64:
    path: /ubuntu-squash/releases/download/24.04.3-dac09526/
    files:
    - initrd
    - vmlinuz
    os: ubuntu
    version: 24.04.3
    codename: noble
    flavor: netboot
    kernel: ubuntu-netboot-24.04-amd64
    arch: amd64
  fedora-40-gnome:
    path: /fedora-assets/releases/download/1.14-aefc8f89/
    files:
    - vmlinuz
    - initrd
    - squashfs.img
    os: fedora
    version: 40
    flavor: GNOME
  ubuntu-24.04-default-squash:
    path: /ubuntu-squash/releases/download/24.04.3-8efa196d/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    - minimal.standard.live.squashfs
    - minimal.standard.squashfs
    - minimal.squashfs
    os: ubuntu
    version: '24.04'
    flavor: GNOME
    kernel: ubuntu-24.04-default-squash
  vanilla-os:
    path: /asset-mirror/releases/download/20240728-32e3ebb7/
    files:
    - initrd
    - filesystem.squashfs
    - vmlinuz
    os: vanilla-os
    version: 2-20240728
  zfsbootmenu:
    path: /asset-mirror/releases/download/3.0.1-bfc4188e/
    files:
    - zfsbootmenu-recovery-x86_64.efi
    os: zfsbootmenu
    version: 3.0.1
  supergrubdisk:
    path: /asset-mirror/releases/download/2.06s4-b7b838c6/
    files:
    - supergrub2-classic-x86_64.efi
    os: supergrubdisk
    version: 2.06s4
  mint-22-xfce-squash:
    path: /ubuntu-squash/releases/download/22-42f238bf/
    files:
    - initrd
    - vmlinuz
    - filesystem.squashfs
    os: mint
    version: '22'
    flavor: xfce
    kernel: mint-22-xfce-squash
  mint-22-cinnamon-squash:
    path: /ubuntu-squash/releases/download/22-1431f755/
    files:
    - initrd
    - vmlinuz
    - filesystem.squashfs
    os: mint
    version: '22'
    flavor: Cinnamon
    kernel: mint-22-cinnamon-squash
  mint-22-mate-squash:
    path: /ubuntu-squash/releases/download/22-979f0303/
    files:
    - initrd
    - vmlinuz
    - filesystem.squashfs
    os: mint
    version: '22'
    flavor: mate
    kernel: mint-22-mate-squash
  ubuntu-netboot-24.10-amd64:
    path: /ubuntu-squash/releases/download/24.10-fcf8807c/
    files:
    - initrd
    - vmlinuz
    os: ubuntu
    version: '24.10'
    codename: oracular
    flavor: netboot
    kernel: ubuntu-netboot-24.10-amd64
    arch: amd64
  ubuntu-netboot-24.10-arm64:
    path: /ubuntu-squash/releases/download/24.10-f22a7742/
    files:
    - initrd
    - vmlinuz
    os: ubuntu
    version: '24.10'
    codename: oracular
    flavor: netboot
    kernel: ubuntu-netboot-24.10-arm64
    arch: arm64
  grml-small-amd64:
    path: /debian-squash/releases/download/2025.08-abcbd950/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: grml
    version: '2025.08'
    flavor: small
    arch: amd64
  grml-full-amd64:
    path: /debian-squash/releases/download/2025.08-dae7342d/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: grml
    version: '2025.08'
    flavor: full
    arch: amd64
  grml-full-arm64:
    path: /debian-squash/releases/download/2025.08-22de2c47/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: grml
    version: '2025.08'
    flavor: full
    arch: arm64
  grml-small-arm64:
    path: /debian-squash/releases/download/2025.08-dd433d05/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: grml
    version: '2025.08'
    flavor: small
    arch: arm64
  uefishell:
    path: /asset-mirror/releases/download/edk2-stable202002-046915a7/
    files:
    - uefi-shell-x64.efi
    - uefi-shell-aarch64.efi
    - uefi-shell-arm.efi
    os: uefi-shell
    version: edk2-stable202002
  uefi-shell-x64:
    path: /asset-mirror/releases/download/edk2-stable202002-4c8abfeb/
    files:
    - uefi-shell-x64.efi
    os: uefi-shell-x64
    version: edk2-stable202002
  ubuntu-netboot-25.04-amd64:
    path: /ubuntu-squash/releases/download/25.04-8094159e/
    files:
    - initrd
    - vmlinuz
    os: ubuntu
    version: '25.04'
    codename: plucky
    flavor: netboot
    kernel: ubuntu-netboot-25.04-amd64
    arch: amd64
  ubuntu-netboot-25.04-arm64:
    path: /ubuntu-squash/releases/download/25.04-e56e947a/
    files:
    - initrd
    - vmlinuz
    os: ubuntu
    version: '25.04'
    codename: plucky
    flavor: netboot
    kernel: ubuntu-netboot-25.04-arm64
    arch: arm64
  mint-20-xfce-squash:
    path: /ubuntu-squash/releases/download/20.3-7abfea92/
    files:
    - initrd
    - vmlinuz
    - filesystem.squashfs
    os: mint
    version: '20.3'
    flavor: xfce
    kernel: mint-20-xfce-squash
  mint-20-cinnamon-squash:
    path: /ubuntu-squash/releases/download/20.3-85db6b9f/
    files:
    - initrd
    - vmlinuz
    - filesystem.squashfs
    os: mint
    version: '20.3'
    flavor: Cinnamon
    kernel: mint-20-cinnamon-squash
  mint-20-mate-squash:
    path: /ubuntu-squash/releases/download/20.3-de3a088b/
    files:
    - initrd
    - vmlinuz
    - filesystem.squashfs
    os: mint
    version: '20.3'
    flavor: mate
    kernel: mint-20-mate-squash
  mint-lmde-cinnamon-squash:
    path: /debian-squash/releases/download/6-1834227b/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: mint
    version: '6'
    flavor: Cinnamon
    kernel: mint-lmde-cinnamon-squash
  ubuntu-spins:
    path: /asset-mirror/releases/download/0.0.3-fb924c06/
    files:
    - vmlinuz
    - initrd
    os: ubuntu-spins
    version: 0.0.3
  cachyos:
    path: /asset-mirror/releases/download/250828-b0e9944d/
    files:
    - airootfs.sfs
    - initrd
    - vmlinuz
    - archiso_pxe_http
    os: cachyos
    version: '250828'
  deepin-20-squash:
    path: /debian-squash/releases/download/20.9-e3a3a399/
    files:
    - filesystem.squashfs
    - initrd
    - vmlinuz
    os: Deepin
    version: '20.9'
    kernel: deepin-20-squash
  debian-13-live-kernel:
    path: /debian-core-13/releases/download/13.1.0-0a426450/
    files:
    - initrd
    - vmlinuz
    os: debian
    version: '13'
  debian-13-default-squash:
    path: /debian-squash/releases/download/13.1.0-d074da9b/
    files:
    - filesystem.squashfs
    os: debian
    version: 13.1.0
    flavor: core
    kernel: debian-13-live-kernel
  debian-13-lxde-squash:
    path: /debian-squash/releases/download/13.1.0-79e9a15b/
    files:
    - filesystem.squashfs
    os: debian
    version: 13.1.0
    flavor: lxde
    kernel: debian-13-live-kernel
  debian-13-kde-squash:
    path: /debian-squash/releases/download/13.1.0-5ecf4c90/
    files:
    - filesystem.squashfs
    os: debian
    version: 13.1.0
    flavor: kde
    kernel: debian-13-live-kernel
  debian-13-gnome-squash:
    path: /debian-squash/releases/download/13.1.0-2eeea9f9/
    files:
    - filesystem.squashfs
    os: debian
    version: 13.1.0
    flavor: gnome
    kernel: debian-13-live-kernel
  debian-13-lxqt-squash:
    path: /debian-squash/releases/download/13.1.0-6088759b/
    files:
    - filesystem.squashfs
    os: debian
    version: 13.1.0
    flavor: lxqt
    kernel: debian-13-live-kernel
  debian-13-mate-squash:
    path: /debian-squash/releases/download/13.1.0-8a7bb188/
    files:
    - filesystem.squashfs
    os: debian
    version: 13.1.0
    flavor: mate
    kernel: debian-13-live-kernel
  ubuntu-netboot-25.10-amd64:
    path: /ubuntu-squash/releases/download/25.10-5a657310/
    files:
    - initrd
    - vmlinuz
    os: ubuntu
    version: '25.10'
    codename: questing
    flavor: netboot
    kernel: ubuntu-netboot-25.10-amd64
    arch: amd64
  ubuntu-netboot-25.10-arm64:
    path: /ubuntu-squash/releases/download/25.10-f8b4d29d/
    files:
    - initrd
    - vmlinuz
    os: ubuntu
    version: '25.10'
    codename: questing
    flavor: netboot
    kernel: ubuntu-netboot-25.10-arm64
    arch: arm64
  debian-13-cinnamon-squash:
    path: /debian-squash/releases/download/13.1.0-f213be8c/
    files:
    - filesystem.squashfs
    os: debian
    version: 13.1.0
    flavor: cinnamon
    kernel: debian-13-live-kernel
  debian-13-xfce-squash:
    path: /debian-squash/releases/download/13.1.0-6e8d6d0d/
    files:
    - filesystem.squashfs
    os: debian
    version: 13.1.0
    flavor: xfce
    kernel: debian-13-live-kernel




==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Data\PxeEvent.cs
==============================================================================
namespace ProPXEServer.API.Data;

public class PxeEvent {
    public int Id { get; set; }
    public required string EventType { get; set; }
    public required string MacAddress { get; set; }
    public required string IpAddress { get; set; }
    public string? Architecture { get; set; }
    public string? BootFileName { get; set; }
    public DateTime Timestamp { get; set; } = DateTime.UtcNow;
}






==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Filters\RequireSubscriptionAttribute.cs
==============================================================================
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.Filters;
using Microsoft.AspNetCore.Identity;
using ProPXEServer.API.Data;

namespace ProPXEServer.API.Filters;

public class RequireSubscriptionAttribute : TypeFilterAttribute {
    public RequireSubscriptionAttribute() : base(typeof(RequireSubscriptionFilter)) { }
}

public class RequireSubscriptionFilter(
    UserManager<ApplicationUser> userManager,
    ILogger<RequireSubscriptionFilter> logger) : IAsyncActionFilter {
    
    public async Task OnActionExecutionAsync(ActionExecutingContext context, ActionExecutionDelegate next) {
        var user = context.HttpContext.User;
        
        if (!user.Identity?.IsAuthenticated ?? true) {
            context.Result = new UnauthorizedResult();
            return;
        }

        var applicationUser = await userManager.GetUserAsync(user);
        if (applicationUser == null) {
            context.Result = new UnauthorizedResult();
            return;
        }

        if (!applicationUser.IsSubscribed || 
            applicationUser.SubscriptionStatus != "active" ||
            (applicationUser.SubscriptionExpiry.HasValue && 
             applicationUser.SubscriptionExpiry.Value < DateTime.UtcNow)) {
            
            logger.LogWarning("User {UserId} attempted to access subscription-required endpoint without valid subscription", 
                applicationUser.Id);
            
            context.Result = new ObjectResult(new { 
                message = "Active subscription required",
                subscriptionRequired = true
            }) {
                StatusCode = 403
            };
            return;
        }

        await next();
    }
}






==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Migrations\20251201013823_InitialCreate.cs
==============================================================================
using System;
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

namespace ProPXEServer.API.Migrations
{
    /// <inheritdoc />
    public partial class InitialCreate : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.CreateTable(
                name: "AspNetRoles",
                columns: table => new
                {
                    Id = table.Column<string>(type: "TEXT", nullable: false),
                    Name = table.Column<string>(type: "TEXT", maxLength: 256, nullable: true),
                    NormalizedName = table.Column<string>(type: "TEXT", maxLength: 256, nullable: true),
                    ConcurrencyStamp = table.Column<string>(type: "TEXT", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_AspNetRoles", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "AspNetUsers",
                columns: table => new
                {
                    Id = table.Column<string>(type: "TEXT", nullable: false),
                    StripeCustomerId = table.Column<string>(type: "TEXT", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "TEXT", nullable: false),
                    IsSubscribed = table.Column<bool>(type: "INTEGER", nullable: false),
                    SubscriptionExpiry = table.Column<DateTime>(type: "TEXT", nullable: true),
                    SubscriptionStatus = table.Column<string>(type: "TEXT", nullable: true),
                    UserName = table.Column<string>(type: "TEXT", maxLength: 256, nullable: true),
                    NormalizedUserName = table.Column<string>(type: "TEXT", maxLength: 256, nullable: true),
                    Email = table.Column<string>(type: "TEXT", maxLength: 256, nullable: true),
                    NormalizedEmail = table.Column<string>(type: "TEXT", maxLength: 256, nullable: true),
                    EmailConfirmed = table.Column<bool>(type: "INTEGER", nullable: false),
                    PasswordHash = table.Column<string>(type: "TEXT", nullable: true),
                    SecurityStamp = table.Column<string>(type: "TEXT", nullable: true),
                    ConcurrencyStamp = table.Column<string>(type: "TEXT", nullable: true),
                    PhoneNumber = table.Column<string>(type: "TEXT", nullable: true),
                    PhoneNumberConfirmed = table.Column<bool>(type: "INTEGER", nullable: false),
                    TwoFactorEnabled = table.Column<bool>(type: "INTEGER", nullable: false),
                    LockoutEnd = table.Column<DateTimeOffset>(type: "TEXT", nullable: true),
                    LockoutEnabled = table.Column<bool>(type: "INTEGER", nullable: false),
                    AccessFailedCount = table.Column<int>(type: "INTEGER", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_AspNetUsers", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "BootConfigurations",
                columns: table => new
                {
                    Id = table.Column<int>(type: "INTEGER", nullable: false)
                        .Annotation("Sqlite:Autoincrement", true),
                    MacAddress = table.Column<string>(type: "TEXT", maxLength: 17, nullable: false),
                    CustomBootFile = table.Column<string>(type: "TEXT", maxLength: 255, nullable: true),
                    Architecture = table.Column<string>(type: "TEXT", maxLength: 50, nullable: false),
                    Enabled = table.Column<bool>(type: "INTEGER", nullable: false),
                    Notes = table.Column<string>(type: "TEXT", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "TEXT", nullable: false),
                    LastBootedAt = table.Column<DateTime>(type: "TEXT", nullable: true),
                    BootCount = table.Column<int>(type: "INTEGER", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_BootConfigurations", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "PxeEvents",
                columns: table => new
                {
                    Id = table.Column<int>(type: "INTEGER", nullable: false)
                        .Annotation("Sqlite:Autoincrement", true),
                    EventType = table.Column<string>(type: "TEXT", nullable: false),
                    MacAddress = table.Column<string>(type: "TEXT", nullable: false),
                    IpAddress = table.Column<string>(type: "TEXT", nullable: false),
                    Architecture = table.Column<string>(type: "TEXT", nullable: true),
                    BootFileName = table.Column<string>(type: "TEXT", nullable: true),
                    Timestamp = table.Column<DateTime>(type: "TEXT", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_PxeEvents", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "AspNetRoleClaims",
                columns: table => new
                {
                    Id = table.Column<int>(type: "INTEGER", nullable: false)
                        .Annotation("Sqlite:Autoincrement", true),
                    RoleId = table.Column<string>(type: "TEXT", nullable: false),
                    ClaimType = table.Column<string>(type: "TEXT", nullable: true),
                    ClaimValue = table.Column<string>(type: "TEXT", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_AspNetRoleClaims", x => x.Id);
                    table.ForeignKey(
                        name: "FK_AspNetRoleClaims_AspNetRoles_RoleId",
                        column: x => x.RoleId,
                        principalTable: "AspNetRoles",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "AspNetUserClaims",
                columns: table => new
                {
                    Id = table.Column<int>(type: "INTEGER", nullable: false)
                        .Annotation("Sqlite:Autoincrement", true),
                    UserId = table.Column<string>(type: "TEXT", nullable: false),
                    ClaimType = table.Column<string>(type: "TEXT", nullable: true),
                    ClaimValue = table.Column<string>(type: "TEXT", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_AspNetUserClaims", x => x.Id);
                    table.ForeignKey(
                        name: "FK_AspNetUserClaims_AspNetUsers_UserId",
                        column: x => x.UserId,
                        principalTable: "AspNetUsers",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "AspNetUserLogins",
                columns: table => new
                {
                    LoginProvider = table.Column<string>(type: "TEXT", nullable: false),
                    ProviderKey = table.Column<string>(type: "TEXT", nullable: false),
                    ProviderDisplayName = table.Column<string>(type: "TEXT", nullable: true),
                    UserId = table.Column<string>(type: "TEXT", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_AspNetUserLogins", x => new { x.LoginProvider, x.ProviderKey });
                    table.ForeignKey(
                        name: "FK_AspNetUserLogins_AspNetUsers_UserId",
                        column: x => x.UserId,
                        principalTable: "AspNetUsers",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "AspNetUserRoles",
                columns: table => new
                {
                    UserId = table.Column<string>(type: "TEXT", nullable: false),
                    RoleId = table.Column<string>(type: "TEXT", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_AspNetUserRoles", x => new { x.UserId, x.RoleId });
                    table.ForeignKey(
                        name: "FK_AspNetUserRoles_AspNetRoles_RoleId",
                        column: x => x.RoleId,
                        principalTable: "AspNetRoles",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_AspNetUserRoles_AspNetUsers_UserId",
                        column: x => x.UserId,
                        principalTable: "AspNetUsers",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "AspNetUserTokens",
                columns: table => new
                {
                    UserId = table.Column<string>(type: "TEXT", nullable: false),
                    LoginProvider = table.Column<string>(type: "TEXT", nullable: false),
                    Name = table.Column<string>(type: "TEXT", nullable: false),
                    Value = table.Column<string>(type: "TEXT", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_AspNetUserTokens", x => new { x.UserId, x.LoginProvider, x.Name });
                    table.ForeignKey(
                        name: "FK_AspNetUserTokens_AspNetUsers_UserId",
                        column: x => x.UserId,
                        principalTable: "AspNetUsers",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "BootFiles",
                columns: table => new
                {
                    Id = table.Column<int>(type: "INTEGER", nullable: false)
                        .Annotation("Sqlite:Autoincrement", true),
                    FileName = table.Column<string>(type: "TEXT", nullable: false),
                    FilePath = table.Column<string>(type: "TEXT", nullable: false),
                    FileSizeBytes = table.Column<long>(type: "INTEGER", nullable: false),
                    Description = table.Column<string>(type: "TEXT", nullable: true),
                    UploadedAt = table.Column<DateTime>(type: "TEXT", nullable: false),
                    UserId = table.Column<string>(type: "TEXT", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_BootFiles", x => x.Id);
                    table.ForeignKey(
                        name: "FK_BootFiles_AspNetUsers_UserId",
                        column: x => x.UserId,
                        principalTable: "AspNetUsers",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateIndex(
                name: "IX_AspNetRoleClaims_RoleId",
                table: "AspNetRoleClaims",
                column: "RoleId");

            migrationBuilder.CreateIndex(
                name: "RoleNameIndex",
                table: "AspNetRoles",
                column: "NormalizedName",
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_AspNetUserClaims_UserId",
                table: "AspNetUserClaims",
                column: "UserId");

            migrationBuilder.CreateIndex(
                name: "IX_AspNetUserLogins_UserId",
                table: "AspNetUserLogins",
                column: "UserId");

            migrationBuilder.CreateIndex(
                name: "IX_AspNetUserRoles_RoleId",
                table: "AspNetUserRoles",
                column: "RoleId");

            migrationBuilder.CreateIndex(
                name: "EmailIndex",
                table: "AspNetUsers",
                column: "NormalizedEmail");

            migrationBuilder.CreateIndex(
                name: "UserNameIndex",
                table: "AspNetUsers",
                column: "NormalizedUserName",
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_BootConfigurations_MacAddress",
                table: "BootConfigurations",
                column: "MacAddress",
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_BootFiles_UserId",
                table: "BootFiles",
                column: "UserId");

            migrationBuilder.CreateIndex(
                name: "IX_PxeEvents_MacAddress",
                table: "PxeEvents",
                column: "MacAddress");

            migrationBuilder.CreateIndex(
                name: "IX_PxeEvents_Timestamp",
                table: "PxeEvents",
                column: "Timestamp");
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DropTable(
                name: "AspNetRoleClaims");

            migrationBuilder.DropTable(
                name: "AspNetUserClaims");

            migrationBuilder.DropTable(
                name: "AspNetUserLogins");

            migrationBuilder.DropTable(
                name: "AspNetUserRoles");

            migrationBuilder.DropTable(
                name: "AspNetUserTokens");

            migrationBuilder.DropTable(
                name: "BootConfigurations");

            migrationBuilder.DropTable(
                name: "BootFiles");

            migrationBuilder.DropTable(
                name: "PxeEvents");

            migrationBuilder.DropTable(
                name: "AspNetRoles");

            migrationBuilder.DropTable(
                name: "AspNetUsers");
        }
    }
}




==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Migrations\20251201013823_InitialCreate.Designer.cs
==============================================================================
// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using ProPXEServer.API.Data;

#nullable disable

namespace ProPXEServer.API.Migrations
{
    [DbContext(typeof(ApplicationDbContext))]
    [Migration("20251201013823_InitialCreate")]
    partial class InitialCreate
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder.HasAnnotation("ProductVersion", "10.0.0");

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityRole", b =>
                {
                    b.Property<string>("Id")
                        .HasColumnType("TEXT");

                    b.Property<string>("ConcurrencyStamp")
                        .IsConcurrencyToken()
                        .HasColumnType("TEXT");

                    b.Property<string>("Name")
                        .HasMaxLength(256)
                        .HasColumnType("TEXT");

                    b.Property<string>("NormalizedName")
                        .HasMaxLength(256)
                        .HasColumnType("TEXT");

                    b.HasKey("Id");

                    b.HasIndex("NormalizedName")
                        .IsUnique()
                        .HasDatabaseName("RoleNameIndex");

                    b.ToTable("AspNetRoles", (string)null);
                });

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityRoleClaim<string>", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("INTEGER");

                    b.Property<string>("ClaimType")
                        .HasColumnType("TEXT");

                    b.Property<string>("ClaimValue")
                        .HasColumnType("TEXT");

                    b.Property<string>("RoleId")
                        .IsRequired()
                        .HasColumnType("TEXT");

                    b.HasKey("Id");

                    b.HasIndex("RoleId");

                    b.ToTable("AspNetRoleClaims", (string)null);
                });

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityUserClaim<string>", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("INTEGER");

                    b.Property<string>("ClaimType")
                        .HasColumnType("TEXT");

                    b.Property<string>("ClaimValue")
                        .HasColumnType("TEXT");

                    b.Property<string>("UserId")
                        .IsRequired()
                        .HasColumnType("TEXT");

                    b.HasKey("Id");

                    b.HasIndex("UserId");

                    b.ToTable("AspNetUserClaims", (string)null);
                });

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityUserLogin<string>", b =>
                {
                    b.Property<string>("LoginProvider")
                        .HasColumnType("TEXT");

                    b.Property<string>("ProviderKey")
                        .HasColumnType("TEXT");

                    b.Property<string>("ProviderDisplayName")
                        .HasColumnType("TEXT");

                    b.Property<string>("UserId")
                        .IsRequired()
                        .HasColumnType("TEXT");

                    b.HasKey("LoginProvider", "ProviderKey");

                    b.HasIndex("UserId");

                    b.ToTable("AspNetUserLogins", (string)null);
                });

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityUserRole<string>", b =>
                {
                    b.Property<string>("UserId")
                        .HasColumnType("TEXT");

                    b.Property<string>("RoleId")
                        .HasColumnType("TEXT");

                    b.HasKey("UserId", "RoleId");

                    b.HasIndex("RoleId");

                    b.ToTable("AspNetUserRoles", (string)null);
                });

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityUserToken<string>", b =>
                {
                    b.Property<string>("UserId")
                        .HasColumnType("TEXT");

                    b.Property<string>("LoginProvider")
                        .HasColumnType("TEXT");

                    b.Property<string>("Name")
                        .HasColumnType("TEXT");

                    b.Property<string>("Value")
                        .HasColumnType("TEXT");

                    b.HasKey("UserId", "LoginProvider", "Name");

                    b.ToTable("AspNetUserTokens", (string)null);
                });

            modelBuilder.Entity("ProPXEServer.API.Data.ApplicationUser", b =>
                {
                    b.Property<string>("Id")
                        .HasColumnType("TEXT");

                    b.Property<int>("AccessFailedCount")
                        .HasColumnType("INTEGER");

                    b.Property<string>("ConcurrencyStamp")
                        .IsConcurrencyToken()
                        .HasColumnType("TEXT");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("TEXT");

                    b.Property<string>("Email")
                        .HasMaxLength(256)
                        .HasColumnType("TEXT");

                    b.Property<bool>("EmailConfirmed")
                        .HasColumnType("INTEGER");

                    b.Property<bool>("IsSubscribed")
                        .HasColumnType("INTEGER");

                    b.Property<bool>("LockoutEnabled")
                        .HasColumnType("INTEGER");

                    b.Property<DateTimeOffset?>("LockoutEnd")
                        .HasColumnType("TEXT");

                    b.Property<string>("NormalizedEmail")
                        .HasMaxLength(256)
                        .HasColumnType("TEXT");

                    b.Property<string>("NormalizedUserName")
                        .HasMaxLength(256)
                        .HasColumnType("TEXT");

                    b.Property<string>("PasswordHash")
                        .HasColumnType("TEXT");

                    b.Property<string>("PhoneNumber")
                        .HasColumnType("TEXT");

                    b.Property<bool>("PhoneNumberConfirmed")
                        .HasColumnType("INTEGER");

                    b.Property<string>("SecurityStamp")
                        .HasColumnType("TEXT");

                    b.Property<string>("StripeCustomerId")
                        .HasColumnType("TEXT");

                    b.Property<DateTime?>("SubscriptionExpiry")
                        .HasColumnType("TEXT");

                    b.Property<string>("SubscriptionStatus")
                        .HasColumnType("TEXT");

                    b.Property<bool>("TwoFactorEnabled")
                        .HasColumnType("INTEGER");

                    b.Property<string>("UserName")
                        .HasMaxLength(256)
                        .HasColumnType("TEXT");

                    b.HasKey("Id");

                    b.HasIndex("NormalizedEmail")
                        .HasDatabaseName("EmailIndex");

                    b.HasIndex("NormalizedUserName")
                        .IsUnique()
                        .HasDatabaseName("UserNameIndex");

                    b.ToTable("AspNetUsers", (string)null);
                });

            modelBuilder.Entity("ProPXEServer.API.Data.BootConfiguration", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("INTEGER");

                    b.Property<string>("Architecture")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("TEXT");

                    b.Property<int>("BootCount")
                        .HasColumnType("INTEGER");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("TEXT");

                    b.Property<string>("CustomBootFile")
                        .HasMaxLength(255)
                        .HasColumnType("TEXT");

                    b.Property<bool>("Enabled")
                        .HasColumnType("INTEGER");

                    b.Property<DateTime?>("LastBootedAt")
                        .HasColumnType("TEXT");

                    b.Property<string>("MacAddress")
                        .IsRequired()
                        .HasMaxLength(17)
                        .HasColumnType("TEXT");

                    b.Property<string>("Notes")
                        .HasColumnType("TEXT");

                    b.HasKey("Id");

                    b.HasIndex("MacAddress")
                        .IsUnique();

                    b.ToTable("BootConfigurations");
                });

            modelBuilder.Entity("ProPXEServer.API.Data.BootFile", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("INTEGER");

                    b.Property<string>("Description")
                        .HasColumnType("TEXT");

                    b.Property<string>("FileName")
                        .IsRequired()
                        .HasColumnType("TEXT");

                    b.Property<string>("FilePath")
                        .IsRequired()
                        .HasColumnType("TEXT");

                    b.Property<long>("FileSizeBytes")
                        .HasColumnType("INTEGER");

                    b.Property<DateTime>("UploadedAt")
                        .HasColumnType("TEXT");

                    b.Property<string>("UserId")
                        .IsRequired()
                        .HasColumnType("TEXT");

                    b.HasKey("Id");

                    b.HasIndex("UserId");

                    b.ToTable("BootFiles");
                });

            modelBuilder.Entity("ProPXEServer.API.Data.PxeEvent", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("INTEGER");

                    b.Property<string>("Architecture")
                        .HasColumnType("TEXT");

                    b.Property<string>("BootFileName")
                        .HasColumnType("TEXT");

                    b.Property<string>("EventType")
                        .IsRequired()
                        .HasColumnType("TEXT");

                    b.Property<string>("IpAddress")
                        .IsRequired()
                        .HasColumnType("TEXT");

                    b.Property<string>("MacAddress")
                        .IsRequired()
                        .HasColumnType("TEXT");

                    b.Property<DateTime>("Timestamp")
                        .HasColumnType("TEXT");

                    b.HasKey("Id");

                    b.HasIndex("MacAddress");

                    b.HasIndex("Timestamp");

                    b.ToTable("PxeEvents");
                });

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityRoleClaim<string>", b =>
                {
                    b.HasOne("Microsoft.AspNetCore.Identity.IdentityRole", null)
                        .WithMany()
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityUserClaim<string>", b =>
                {
                    b.HasOne("ProPXEServer.API.Data.ApplicationUser", null)
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityUserLogin<string>", b =>
                {
                    b.HasOne("ProPXEServer.API.Data.ApplicationUser", null)
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityUserRole<string>", b =>
                {
                    b.HasOne("Microsoft.AspNetCore.Identity.IdentityRole", null)
                        .WithMany()
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("ProPXEServer.API.Data.ApplicationUser", null)
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityUserToken<string>", b =>
                {
                    b.HasOne("ProPXEServer.API.Data.ApplicationUser", null)
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("ProPXEServer.API.Data.BootFile", b =>
                {
                    b.HasOne("ProPXEServer.API.Data.ApplicationUser", "User")
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("User");
                });
#pragma warning restore 612, 618
        }
    }
}




==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Migrations\ApplicationDbContextModelSnapshot.cs
==============================================================================
// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using ProPXEServer.API.Data;

#nullable disable

namespace ProPXEServer.API.Migrations
{
    [DbContext(typeof(ApplicationDbContext))]
    partial class ApplicationDbContextModelSnapshot : ModelSnapshot
    {
        protected override void BuildModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder.HasAnnotation("ProductVersion", "10.0.0");

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityRole", b =>
                {
                    b.Property<string>("Id")
                        .HasColumnType("TEXT");

                    b.Property<string>("ConcurrencyStamp")
                        .IsConcurrencyToken()
                        .HasColumnType("TEXT");

                    b.Property<string>("Name")
                        .HasMaxLength(256)
                        .HasColumnType("TEXT");

                    b.Property<string>("NormalizedName")
                        .HasMaxLength(256)
                        .HasColumnType("TEXT");

                    b.HasKey("Id");

                    b.HasIndex("NormalizedName")
                        .IsUnique()
                        .HasDatabaseName("RoleNameIndex");

                    b.ToTable("AspNetRoles", (string)null);
                });

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityRoleClaim<string>", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("INTEGER");

                    b.Property<string>("ClaimType")
                        .HasColumnType("TEXT");

                    b.Property<string>("ClaimValue")
                        .HasColumnType("TEXT");

                    b.Property<string>("RoleId")
                        .IsRequired()
                        .HasColumnType("TEXT");

                    b.HasKey("Id");

                    b.HasIndex("RoleId");

                    b.ToTable("AspNetRoleClaims", (string)null);
                });

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityUserClaim<string>", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("INTEGER");

                    b.Property<string>("ClaimType")
                        .HasColumnType("TEXT");

                    b.Property<string>("ClaimValue")
                        .HasColumnType("TEXT");

                    b.Property<string>("UserId")
                        .IsRequired()
                        .HasColumnType("TEXT");

                    b.HasKey("Id");

                    b.HasIndex("UserId");

                    b.ToTable("AspNetUserClaims", (string)null);
                });

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityUserLogin<string>", b =>
                {
                    b.Property<string>("LoginProvider")
                        .HasColumnType("TEXT");

                    b.Property<string>("ProviderKey")
                        .HasColumnType("TEXT");

                    b.Property<string>("ProviderDisplayName")
                        .HasColumnType("TEXT");

                    b.Property<string>("UserId")
                        .IsRequired()
                        .HasColumnType("TEXT");

                    b.HasKey("LoginProvider", "ProviderKey");

                    b.HasIndex("UserId");

                    b.ToTable("AspNetUserLogins", (string)null);
                });

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityUserRole<string>", b =>
                {
                    b.Property<string>("UserId")
                        .HasColumnType("TEXT");

                    b.Property<string>("RoleId")
                        .HasColumnType("TEXT");

                    b.HasKey("UserId", "RoleId");

                    b.HasIndex("RoleId");

                    b.ToTable("AspNetUserRoles", (string)null);
                });

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityUserToken<string>", b =>
                {
                    b.Property<string>("UserId")
                        .HasColumnType("TEXT");

                    b.Property<string>("LoginProvider")
                        .HasColumnType("TEXT");

                    b.Property<string>("Name")
                        .HasColumnType("TEXT");

                    b.Property<string>("Value")
                        .HasColumnType("TEXT");

                    b.HasKey("UserId", "LoginProvider", "Name");

                    b.ToTable("AspNetUserTokens", (string)null);
                });

            modelBuilder.Entity("ProPXEServer.API.Data.ApplicationUser", b =>
                {
                    b.Property<string>("Id")
                        .HasColumnType("TEXT");

                    b.Property<int>("AccessFailedCount")
                        .HasColumnType("INTEGER");

                    b.Property<string>("ConcurrencyStamp")
                        .IsConcurrencyToken()
                        .HasColumnType("TEXT");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("TEXT");

                    b.Property<string>("Email")
                        .HasMaxLength(256)
                        .HasColumnType("TEXT");

                    b.Property<bool>("EmailConfirmed")
                        .HasColumnType("INTEGER");

                    b.Property<bool>("IsSubscribed")
                        .HasColumnType("INTEGER");

                    b.Property<bool>("LockoutEnabled")
                        .HasColumnType("INTEGER");

                    b.Property<DateTimeOffset?>("LockoutEnd")
                        .HasColumnType("TEXT");

                    b.Property<string>("NormalizedEmail")
                        .HasMaxLength(256)
                        .HasColumnType("TEXT");

                    b.Property<string>("NormalizedUserName")
                        .HasMaxLength(256)
                        .HasColumnType("TEXT");

                    b.Property<string>("PasswordHash")
                        .HasColumnType("TEXT");

                    b.Property<string>("PhoneNumber")
                        .HasColumnType("TEXT");

                    b.Property<bool>("PhoneNumberConfirmed")
                        .HasColumnType("INTEGER");

                    b.Property<string>("SecurityStamp")
                        .HasColumnType("TEXT");

                    b.Property<string>("StripeCustomerId")
                        .HasColumnType("TEXT");

                    b.Property<DateTime?>("SubscriptionExpiry")
                        .HasColumnType("TEXT");

                    b.Property<string>("SubscriptionStatus")
                        .HasColumnType("TEXT");

                    b.Property<bool>("TwoFactorEnabled")
                        .HasColumnType("INTEGER");

                    b.Property<string>("UserName")
                        .HasMaxLength(256)
                        .HasColumnType("TEXT");

                    b.HasKey("Id");

                    b.HasIndex("NormalizedEmail")
                        .HasDatabaseName("EmailIndex");

                    b.HasIndex("NormalizedUserName")
                        .IsUnique()
                        .HasDatabaseName("UserNameIndex");

                    b.ToTable("AspNetUsers", (string)null);
                });

            modelBuilder.Entity("ProPXEServer.API.Data.BootConfiguration", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("INTEGER");

                    b.Property<string>("Architecture")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("TEXT");

                    b.Property<int>("BootCount")
                        .HasColumnType("INTEGER");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("TEXT");

                    b.Property<string>("CustomBootFile")
                        .HasMaxLength(255)
                        .HasColumnType("TEXT");

                    b.Property<bool>("Enabled")
                        .HasColumnType("INTEGER");

                    b.Property<DateTime?>("LastBootedAt")
                        .HasColumnType("TEXT");

                    b.Property<string>("MacAddress")
                        .IsRequired()
                        .HasMaxLength(17)
                        .HasColumnType("TEXT");

                    b.Property<string>("Notes")
                        .HasColumnType("TEXT");

                    b.HasKey("Id");

                    b.HasIndex("MacAddress")
                        .IsUnique();

                    b.ToTable("BootConfigurations");
                });

            modelBuilder.Entity("ProPXEServer.API.Data.BootFile", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("INTEGER");

                    b.Property<string>("Description")
                        .HasColumnType("TEXT");

                    b.Property<string>("FileName")
                        .IsRequired()
                        .HasColumnType("TEXT");

                    b.Property<string>("FilePath")
                        .IsRequired()
                        .HasColumnType("TEXT");

                    b.Property<long>("FileSizeBytes")
                        .HasColumnType("INTEGER");

                    b.Property<DateTime>("UploadedAt")
                        .HasColumnType("TEXT");

                    b.Property<string>("UserId")
                        .IsRequired()
                        .HasColumnType("TEXT");

                    b.HasKey("Id");

                    b.HasIndex("UserId");

                    b.ToTable("BootFiles");
                });

            modelBuilder.Entity("ProPXEServer.API.Data.PxeEvent", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("INTEGER");

                    b.Property<string>("Architecture")
                        .HasColumnType("TEXT");

                    b.Property<string>("BootFileName")
                        .HasColumnType("TEXT");

                    b.Property<string>("EventType")
                        .IsRequired()
                        .HasColumnType("TEXT");

                    b.Property<string>("IpAddress")
                        .IsRequired()
                        .HasColumnType("TEXT");

                    b.Property<string>("MacAddress")
                        .IsRequired()
                        .HasColumnType("TEXT");

                    b.Property<DateTime>("Timestamp")
                        .HasColumnType("TEXT");

                    b.HasKey("Id");

                    b.HasIndex("MacAddress");

                    b.HasIndex("Timestamp");

                    b.ToTable("PxeEvents");
                });

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityRoleClaim<string>", b =>
                {
                    b.HasOne("Microsoft.AspNetCore.Identity.IdentityRole", null)
                        .WithMany()
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityUserClaim<string>", b =>
                {
                    b.HasOne("ProPXEServer.API.Data.ApplicationUser", null)
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityUserLogin<string>", b =>
                {
                    b.HasOne("ProPXEServer.API.Data.ApplicationUser", null)
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityUserRole<string>", b =>
                {
                    b.HasOne("Microsoft.AspNetCore.Identity.IdentityRole", null)
                        .WithMany()
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("ProPXEServer.API.Data.ApplicationUser", null)
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("Microsoft.AspNetCore.Identity.IdentityUserToken<string>", b =>
                {
                    b.HasOne("ProPXEServer.API.Data.ApplicationUser", null)
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("ProPXEServer.API.Data.BootFile", b =>
                {
                    b.HasOne("ProPXEServer.API.Data.ApplicationUser", "User")
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("User");
                });
#pragma warning restore 612, 618
        }
    }
}




==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Properties\launchSettings.json
==============================================================================
{
  "$schema": "https://json.schemastore.org/launchsettings.json",
  "profiles": {
    "http": {
      "commandName": "Project",
      "dotnetRunMessages": true,
      "launchBrowser": false,
      "applicationUrl": "http://localhost:5054",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    },
    "https": {
      "commandName": "Project",
      "dotnetRunMessages": true,
      "launchBrowser": false,
      "applicationUrl": "https://localhost:7109;http://localhost:5054",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    }
  }
}




==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Security\SecurityConfiguration.cs
==============================================================================
using Microsoft.AspNetCore.RateLimiting;
using System.Net;
using System.Threading.RateLimiting;

namespace ProPXEServer.API.Security;

public static class SecurityConfiguration {
    public static IServiceCollection AddPxeSecurityPolicies(this IServiceCollection services, IConfiguration configuration) {
        
        
        services.AddRateLimiter(options => {
            options.GlobalLimiter = PartitionedRateLimiter.Create<HttpContext, string>(context => {
                var ipAddress = context.Connection.RemoteIpAddress?.ToString() ?? "unknown";
                
                return RateLimitPartition.GetFixedWindowLimiter(ipAddress, _ => new FixedWindowRateLimiterOptions {
                    PermitLimit = 100,              
                    Window = TimeSpan.FromMinutes(1), 
                    QueueProcessingOrder = QueueProcessingOrder.OldestFirst,
                    QueueLimit = 10
                });
            });

            options.OnRejected = async (context, token) => {
                context.HttpContext.Response.StatusCode = StatusCodes.Status429TooManyRequests;
                await context.HttpContext.Response.WriteAsync("Too many requests. Please try again later.", token);
            };
        });

        return services;
    }

    
    public static bool IsIpAllowed(string ipAddress, IConfiguration configuration) {
        var whitelist = configuration.GetSection("Security:IpWhitelist").Get<string[]>();
        var blacklist = configuration.GetSection("Security:IpBlacklist").Get<string[]>();

        if (blacklist != null && blacklist.Contains(ipAddress)) {
            return false;
        }

        if (whitelist != null && whitelist.Length > 0) {
            return whitelist.Contains(ipAddress);
        }

        return true;
    }

    
    public static bool IsValidMacAddress(string macAddress) {
        if (string.IsNullOrWhiteSpace(macAddress)) return false;
        
        var parts = macAddress.Split(':');
        if (parts.Length != 6) return false;

        foreach (var part in parts) {
            if (part.Length != 2) return false;
            if (!int.TryParse(part, System.Globalization.NumberStyles.HexNumber, null, out _)) {
                return false;
            }
        }

        return true;
    }

    
    public static void LogSecurityEvent(ILogger logger, string eventType, string? ipAddress, string? macAddress, string? details = null) {
        logger.LogWarning("SECURITY_EVENT: {EventType} | IP: {IP} | MAC: {MAC} | Details: {Details}", 
            eventType, ipAddress ?? "unknown", macAddress ?? "unknown", details ?? "none");
    }
}







==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Services\DhcpService.cs
==============================================================================
using System.Net;
using System.Net.Sockets;
using ProPXEServer.API.Data;
using ProPXEServer.API.Security;

namespace ProPXEServer.API.Services;

public class DhcpService(
    ILogger<DhcpService> logger,
    IConfiguration configuration,
    IServiceProvider serviceProvider) : BackgroundService {
    
    private readonly string _advertisedIp = configuration["ProPXEServer:AdvertisedIP"] ?? "192.168.1.100";
    private UdpClient? _dhcpSocket;
    private UdpClient? _proxyDhcpSocket;

    public override void Dispose() {
        _dhcpSocket?.Close();
        _proxyDhcpSocket?.Close();
        base.Dispose();
    }

    protected override async Task ExecuteAsync(CancellationToken stoppingToken) {
        logger.LogInformation("DHCP/ProxyDHCP service starting on ports 67 and 4011");
        
        try {
            _dhcpSocket = new UdpClient(new IPEndPoint(IPAddress.Any, 67)) {
                EnableBroadcast = true
            };
            
            _proxyDhcpSocket = new UdpClient(new IPEndPoint(IPAddress.Any, 4011));
            
            var dhcpTask = ListenDhcpAsync(stoppingToken);
            var proxyDhcpTask = ListenProxyDhcpAsync(stoppingToken);
            
            await Task.WhenAll(dhcpTask, proxyDhcpTask);
        }
        catch (Exception ex) {
            logger.LogError(ex, "DHCP service failed to start");
            throw;
        }
    }

    private async Task ListenDhcpAsync(CancellationToken ct) {
        logger.LogInformation("Listening for DHCP requests on port 67");
        
        while (!ct.IsCancellationRequested && _dhcpSocket != null) {
            try {
                var result = await _dhcpSocket.ReceiveAsync(ct);
                _ = Task.Run(() => HandleDhcpPacket(result.Buffer, result.RemoteEndPoint), ct);
            }
            catch (OperationCanceledException) {
                break;
            }
            catch (Exception ex) {
                logger.LogError(ex, "Error receiving DHCP packet");
            }
        }
    }

    private async Task ListenProxyDhcpAsync(CancellationToken ct) {
        logger.LogInformation("Listening for ProxyDHCP requests on port 4011");
        
        while (!ct.IsCancellationRequested && _proxyDhcpSocket != null) {
            try {
                var result = await _proxyDhcpSocket.ReceiveAsync(ct);
                _ = Task.Run(() => HandleProxyDhcpPacket(result.Buffer, result.RemoteEndPoint), ct);
            }
            catch (OperationCanceledException) {
                break;
            }
            catch (Exception ex) {
                logger.LogError(ex, "Error receiving ProxyDHCP packet");
            }
        }
    }

    private async Task HandleDhcpPacket(byte[] packet, IPEndPoint remoteEndPoint) {
        try {
            if (packet.Length < 236) return;
            
            var macAddress = BitConverter.ToString(packet[28..34]).Replace("-", ":");
            
            if (!SecurityConfiguration.IsValidMacAddress(macAddress)) {
                logger.LogWarning("Invalid MAC address received: {Mac}", macAddress);
                return;
            }

            if (!SecurityConfiguration.IsIpAllowed(remoteEndPoint.Address.ToString(), configuration)) {
                logger.LogWarning("Blocked request from unauthorized IP: {IP}", remoteEndPoint.Address);
                return;
            }

            var messageType = GetDhcpMessageType(packet);
            
            logger.LogInformation("DHCP {MessageType} from {Mac} at {IP}", 
                messageType, macAddress, remoteEndPoint.Address);
            
            await LogPxeEvent("DHCP_" + messageType, macAddress, remoteEndPoint.Address.ToString());
            
            if (messageType == "DISCOVER") {
                await SendDhcpOffer(packet, remoteEndPoint, macAddress);
            }
        }
        catch (Exception ex) {
            logger.LogError(ex, "Error handling DHCP packet");
        }
    }

    private async Task HandleProxyDhcpPacket(byte[] packet, IPEndPoint remoteEndPoint) {
        try {
            if (packet.Length < 236) return;
            
            var macAddress = BitConverter.ToString(packet[28..34]).Replace("-", ":");

            if (!SecurityConfiguration.IsValidMacAddress(macAddress)) {
                logger.LogWarning("Invalid MAC address received: {Mac}", macAddress);
                return;
            }

            if (!SecurityConfiguration.IsIpAllowed(remoteEndPoint.Address.ToString(), configuration)) {
                logger.LogWarning("Blocked ProxyDHCP request from unauthorized IP: {IP}", remoteEndPoint.Address);
                return;
            }

            var arch = GetClientArchitecture(packet);
            
            logger.LogInformation("ProxyDHCP request from {Mac}, arch: {Arch}", macAddress, arch);
            
            await LogPxeEvent("PROXY_DHCP", macAddress, remoteEndPoint.Address.ToString(), arch.ToString("X4"));
            await SendProxyDhcpOffer(packet, remoteEndPoint, macAddress, arch);
        }
        catch (Exception ex) {
            logger.LogError(ex, "Error handling ProxyDHCP packet");
        }
    }

    private async Task SendDhcpOffer(byte[] request, IPEndPoint remoteEndPoint, string macAddress) {
        var response = new byte[548];
        Array.Copy(request, 0, response, 0, 236);
        
        response[0] = 0x02;
        
        var serverIp = IPAddress.Parse(_advertisedIp).GetAddressBytes();
        Array.Copy(serverIp, 0, response, 20, 4);
        
        response[236] = 0x63;
        response[237] = 0x82;
        response[238] = 0x53;
        response[239] = 0x63;
        
        int offset = 240;
        offset = AddDhcpOption(response, offset, 53, [(byte)2]);
        offset = AddDhcpOption(response, offset, 54, serverIp);
        offset = AddDhcpOption(response, offset, 60, "PXEClient"u8.ToArray());
        response[offset++] = 0xFF;
        
        if (_dhcpSocket != null) {
            await _dhcpSocket.SendAsync(response.AsMemory(0, offset), 
                new IPEndPoint(IPAddress.Broadcast, 68));
        }
        
        logger.LogInformation("Sent DHCP OFFER to {Mac}", macAddress);
    }

    private async Task SendProxyDhcpOffer(byte[] request, IPEndPoint remoteEndPoint, string macAddress, int arch) {
        var response = new byte[548];
        Array.Copy(request, 0, response, 0, 236);
        
        response[0] = 0x02;
        
        var serverIp = IPAddress.Parse(_advertisedIp).GetAddressBytes();
        Array.Copy(serverIp, 0, response, 20, 4);
        
        response[236] = 0x63;
        response[237] = 0x82;
        response[238] = 0x53;
        response[239] = 0x63;
        
        var bootFile = GetBootFileForArchitecture(arch);
        Array.Copy(System.Text.Encoding.ASCII.GetBytes(bootFile), 0, response, 108, 
            Math.Min(bootFile.Length, 128));
        
        int offset = 240;
        offset = AddDhcpOption(response, offset, 53, [(byte)5]);
        offset = AddDhcpOption(response, offset, 54, serverIp);
        offset = AddDhcpOption(response, offset, 60, "PXEClient"u8.ToArray());
        
        // Option 66: TFTP Server Name
        offset = AddDhcpOption(response, offset, 66, System.Text.Encoding.ASCII.GetBytes(_advertisedIp));

        // Option 67: Bootfile Name
        offset = AddDhcpOption(response, offset, 67, System.Text.Encoding.ASCII.GetBytes(bootFile));

        byte[] pxeOptions = [0x08, 0x00, 0x00, 0x00];
        offset = AddDhcpOption(response, offset, 43, pxeOptions);
        response[offset++] = 0xFF;
        
        if (_proxyDhcpSocket != null) {
            await _proxyDhcpSocket.SendAsync(response.AsMemory(0, offset), remoteEndPoint);
        }
        
        logger.LogInformation("Sent ProxyDHCP offer to {Mac} with boot file: {BootFile}", 
            macAddress, bootFile);
    }

    private static int AddDhcpOption(byte[] buffer, int offset, byte option, byte[] data) {
        buffer[offset++] = option;
        buffer[offset++] = (byte)data.Length;
        Array.Copy(data, 0, buffer, offset, data.Length);
        return offset + data.Length;
    }

    private static string GetDhcpMessageType(byte[] packet) {
        for (int i = 240; i < packet.Length - 2; i++) {
            if (packet[i] == 53 && packet[i + 1] == 1) {
                return packet[i + 2] switch {
                    1 => "DISCOVER",
                    3 => "REQUEST",
                    _ => "UNKNOWN"
                };
            }
        }
        return "UNKNOWN";
    }

    private static int GetClientArchitecture(byte[] packet) {
        for (int i = 240; i < packet.Length - 4; i++) {
            if (packet[i] == 93 && packet[i + 1] == 2) {
                return (packet[i + 2] << 8) | packet[i + 3];
            }
        }
        return 0;
    }

    private static string GetBootFileForArchitecture(int arch) => arch switch {
        0x00 => "bios/mass.kpxe",       
        0x06 => "uefi/mass.efi",        
        0x07 => "uefi/mass.efi",        
        0x09 => "uefi/mass.efi",        
        0x0a => "arm64/mass-arm64.efi", 
        0x0b => "arm64/mass-arm64.efi", 
        _ => "bios/mass.kpxe"           
    };

    private async Task LogPxeEvent(string eventType, string macAddress, string ipAddress, string? arch = null) {
        try {
            using var scope = serviceProvider.CreateScope();
            var dbContext = scope.ServiceProvider.GetRequiredService<ApplicationDbContext>();
            
            dbContext.PxeEvents.Add(new PxeEvent {
                EventType = eventType,
                MacAddress = macAddress,
                IpAddress = ipAddress,
                Architecture = arch
            });
            
            await dbContext.SaveChangesAsync();
        }
        catch (Exception ex) {
            logger.LogError(ex, "Failed to log PXE event");
        }
    }
}





==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Services\HttpBootService.cs
==============================================================================
using Microsoft.AspNetCore.StaticFiles;
using ProPXEServer.API.Data;

namespace ProPXEServer.API.Services;

public class HttpBootService(
    ILogger<HttpBootService> logger,
    IConfiguration configuration,
    IServiceProvider serviceProvider) {
    
    private readonly string _bootFilesDirectory = configuration["ProPXEServer:BootFilesDirectory"] ?? "BootFiles";

    public async Task<IResult> ServeBootFile(string fileName, HttpContext context) {
        try {
            var filePath = Path.Combine(_bootFilesDirectory, fileName.TrimStart('/'));
            
            if (!File.Exists(filePath)) {
                logger.LogWarning("Boot file not found: {FilePath}", filePath);
                return Results.NotFound();
            }
            
            var ipAddress = context.Connection.RemoteIpAddress?.ToString() ?? "unknown";
            logger.LogInformation("HTTP boot request for {FileName} from {IP}", fileName, ipAddress);
            
            await LogPxeEvent("HTTP_BOOT", ipAddress, fileName);
            
            var provider = new FileExtensionContentTypeProvider();
            if (!provider.TryGetContentType(fileName, out var contentType)) {
                contentType = "application/octet-stream";
            }
            
            return Results.File(filePath, contentType, enableRangeProcessing: true);
        }
        catch (Exception ex) {
            logger.LogError(ex, "Error serving boot file: {FileName}", fileName);
            return Results.Problem("Error serving file");
        }
    }

    private async Task LogPxeEvent(string eventType, string ipAddress, string fileName) {
        try {
            using var scope = serviceProvider.CreateScope();
            var dbContext = scope.ServiceProvider.GetRequiredService<ApplicationDbContext>();
            
            dbContext.PxeEvents.Add(new PxeEvent {
                EventType = eventType,
                MacAddress = "unknown",
                IpAddress = ipAddress,
                BootFileName = fileName
            });
            
            await dbContext.SaveChangesAsync();
        }
        catch (Exception ex) {
            logger.LogError(ex, "Failed to log PXE event");
        }
    }
}






==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Services\TftpServerService.cs
==============================================================================
using ProPXEServer.API.Security;
using System.Net;
using System.Net.Sockets;

namespace ProPXEServer.API.Services;

public class TftpServerService : BackgroundService {
    private readonly ILogger<TftpServerService> _logger;
    private readonly IConfiguration _configuration;
    private readonly string _tftpRoot;
    private UdpClient? _server;
    private const int TftpPort = 69;

    public TftpServerService(ILogger<TftpServerService> logger, IConfiguration configuration) {
        _logger = logger;
        _configuration = configuration;
        _tftpRoot = configuration["TftpSettings:RootPath"] ?? Path.Combine(Directory.GetCurrentDirectory(), "wwwroot", "pxe");
        
        if (!Directory.Exists(_tftpRoot)) {
            Directory.CreateDirectory(_tftpRoot);
            _logger.LogInformation("Created TFTP root directory: {TftpRoot}", _tftpRoot);
        }
    }

    protected override async Task ExecuteAsync(CancellationToken stoppingToken) {
        _logger.LogInformation("TFTP Server starting on port {Port} with root: {Root}", TftpPort, _tftpRoot);

        try {
            _server = new UdpClient(TftpPort);
            _logger.LogInformation("TFTP Server started successfully");

            while (!stoppingToken.IsCancellationRequested) {
                try {
                    var result = await _server.ReceiveAsync(stoppingToken);
                    _ = Task.Run(() => HandleClient(result.RemoteEndPoint, result.Buffer), stoppingToken);
                }
                catch (OperationCanceledException) {
                    break;
                }
                catch (Exception ex) {
                    _logger.LogError(ex, "Error receiving TFTP request");
                }
            }
        }
        catch (Exception ex) {
            _logger.LogError(ex, "Failed to start TFTP server");
        }
        finally {
            _server?.Close();
            _logger.LogInformation("TFTP Server stopped");
        }
    }

    private async Task HandleClient(IPEndPoint clientEndpoint, byte[] requestData) {
        try {
            if (!SecurityConfiguration.IsIpAllowed(clientEndpoint.Address.ToString(), _configuration)) {
                _logger.LogWarning("Blocked TFTP request from unauthorized IP: {IP}", clientEndpoint.Address);
                await SendError(clientEndpoint, 2, "Access violation");
                return;
            }

            if (requestData.Length < 4) return;

            ushort opcode = (ushort)((requestData[0] << 8) | requestData[1]);

            if (opcode == 1) {
                await HandleReadRequest(clientEndpoint, requestData);
            }
            else if (opcode == 2) {
                _logger.LogWarning("Write request from {Client} - not supported", clientEndpoint);
            }
        }
        catch (Exception ex) {
            _logger.LogError(ex, "Error handling TFTP client {Client}", clientEndpoint);
        }
    }

    private async Task HandleReadRequest(IPEndPoint clientEndpoint, byte[] requestData) {
        string filename = "";
        try {
            int filenameStart = 2;
            int filenameEnd = Array.IndexOf(requestData, (byte)0, filenameStart);
            if (filenameEnd == -1) return;

            filename = System.Text.Encoding.ASCII.GetString(requestData, filenameStart, filenameEnd - filenameStart);
            filename = filename.Replace('/', Path.DirectorySeparatorChar);

            string fullPath = Path.Combine(_tftpRoot, filename);
            
            if (!File.Exists(fullPath)) {
                _logger.LogWarning("File not found: {Filename} (requested by {Client})", filename, clientEndpoint);
                await SendError(clientEndpoint, 1, "File not found");
                return;
            }

            _logger.LogInformation("Serving file: {Filename} to {Client}", filename, clientEndpoint);

            byte[] fileData = await File.ReadAllBytesAsync(fullPath);
            await SendFile(clientEndpoint, fileData);
        }
        catch (Exception ex) {
            _logger.LogError(ex, "Error handling read request for {Filename} from {Client}", filename, clientEndpoint);
            await SendError(clientEndpoint, 0, "Internal server error");
        }
    }

    private async Task SendFile(IPEndPoint clientEndpoint, byte[] fileData) {
        using var client = new UdpClient();
        const int blockSize = 512;
        ushort blockNumber = 1;
        int offset = 0;

        while (offset < fileData.Length) {
            int dataLength = Math.Min(blockSize, fileData.Length - offset);
            byte[] packet = new byte[4 + dataLength];
            
            packet[0] = 0;
            packet[1] = 3;
            packet[2] = (byte)(blockNumber >> 8);
            packet[3] = (byte)(blockNumber & 0xFF);
            
            Array.Copy(fileData, offset, packet, 4, dataLength);

            int retries = 0;
            bool ackReceived = false;

            while (!ackReceived && retries < 5) {
                await client.SendAsync(packet, packet.Length, clientEndpoint);

                try {
                    client.Client.ReceiveTimeout = 1000;
                    var ackTask = client.ReceiveAsync();
                    var timeoutTask = Task.Delay(1000);
                    var completedTask = await Task.WhenAny(ackTask, timeoutTask);

                    if (completedTask == ackTask) {
                        var ack = await ackTask;
                        if (ack.Buffer.Length >= 4 && ack.Buffer[1] == 4) {
                            ushort ackBlock = (ushort)((ack.Buffer[2] << 8) | ack.Buffer[3]);
                            if (ackBlock == blockNumber) {
                                ackReceived = true;
                            }
                        }
                    }
                    else {
                        retries++;
                    }
                }
                catch {
                    retries++;
                }
            }

            if (!ackReceived) {
                _logger.LogWarning("Failed to receive ACK for block {Block} to {Client}", blockNumber, clientEndpoint);
                return;
            }

            offset += dataLength;
            blockNumber++;

            if (dataLength < blockSize) break;
        }
    }

    private async Task SendError(IPEndPoint clientEndpoint, ushort errorCode, string errorMessage) {
        using var client = new UdpClient();
        byte[] message = System.Text.Encoding.ASCII.GetBytes(errorMessage);
        byte[] packet = new byte[5 + message.Length];
        
        packet[0] = 0;
        packet[1] = 5;
        packet[2] = (byte)(errorCode >> 8);
        packet[3] = (byte)(errorCode & 0xFF);
        Array.Copy(message, 0, packet, 4, message.Length);
        packet[packet.Length - 1] = 0;

        await client.SendAsync(packet, packet.Length, clientEndpoint);
    }

    public override void Dispose() {
        _server?.Close();
        base.Dispose();
    }
}






==============================================================================
File: \src\ProPXEServer\ProPXEServer.API\Services\TftpService.cs
==============================================================================
using System.Net;
using System.Net.Sockets;
using ProPXEServer.API.Data;

namespace ProPXEServer.API.Services;

public class TftpService(
    ILogger<TftpService> logger,
    IConfiguration configuration,
    IServiceProvider serviceProvider) : BackgroundService {
    
    private readonly string _bootFilesDirectory = configuration["ProPXEServer:BootFilesDirectory"] ?? "BootFiles";
    private UdpClient? _tftpSocket;

    protected override async Task ExecuteAsync(CancellationToken stoppingToken) {
        logger.LogInformation("TFTP service starting on port 69");
        
        Directory.CreateDirectory(_bootFilesDirectory);
        
        try {
            _tftpSocket = new UdpClient(new IPEndPoint(IPAddress.Any, 69));
            
            while (!stoppingToken.IsCancellationRequested) {
                var result = await _tftpSocket.ReceiveAsync(stoppingToken);
                _ = Task.Run(() => HandleTftpRequest(result.Buffer, result.RemoteEndPoint), stoppingToken);
            }
        }
        catch (OperationCanceledException) {
            logger.LogInformation("TFTP service stopping");
        }
        catch (Exception ex) {
            logger.LogError(ex, "TFTP service failed");
            throw;
        }
    }

    private async Task HandleTftpRequest(byte[] packet, IPEndPoint remoteEndPoint) {
        try {
            if (packet.Length < 4) return;
            
            ushort opcode = (ushort)((packet[0] << 8) | packet[1]);
            
            if (opcode == 1) {
                await HandleReadRequest(packet, remoteEndPoint);
            }
            else if (opcode == 2) {
                logger.LogWarning("TFTP write requests are not supported");
                await SendError(remoteEndPoint, 2, "Write requests not allowed");
            }
        }
        catch (Exception ex) {
            logger.LogError(ex, "Error handling TFTP request from {EndPoint}", remoteEndPoint);
            await SendError(remoteEndPoint, 0, "Server error");
        }
    }

    private async Task HandleReadRequest(byte[] packet, IPEndPoint remoteEndPoint) {
        var fileName = ExtractString(packet, 2);
        var mode = ExtractString(packet, 2 + fileName.Length + 1);
        
        logger.LogInformation("TFTP RRQ: {FileName} from {EndPoint}", fileName, remoteEndPoint);
        
        var filePath = Path.Combine(_bootFilesDirectory, fileName.TrimStart('/'));
        
        if (!File.Exists(filePath)) {
            logger.LogWarning("File not found: {FilePath}", filePath);
            await SendError(remoteEndPoint, 1, "File not found");
            return;
        }
        
        await LogPxeEvent("TFTP_READ", remoteEndPoint.Address.ToString(), fileName);
        
        await SendFile(filePath, remoteEndPoint);
    }

    private async Task SendFile(string filePath, IPEndPoint remoteEndPoint) {
        const int blockSize = 512;
        ushort blockNumber = 1;
        
        using var fileStream = File.OpenRead(filePath);
        using var transferSocket = new UdpClient();
        transferSocket.Client.ReceiveTimeout = 5000;
        
        var buffer = new byte[blockSize];
        int bytesRead;
        
        while ((bytesRead = await fileStream.ReadAsync(buffer)) > 0) {
            var dataPacket = new byte[4 + bytesRead];
            dataPacket[0] = 0;
            dataPacket[1] = 3;
            dataPacket[2] = (byte)(blockNumber >> 8);
            dataPacket[3] = (byte)(blockNumber & 0xFF);
            Array.Copy(buffer, 0, dataPacket, 4, bytesRead);
            
            bool ackReceived = false;
            int retries = 5;
            
            while (!ackReceived && retries > 0) {
                await transferSocket.SendAsync(dataPacket, remoteEndPoint);
                
                try {
                    var ackResult = await transferSocket.ReceiveAsync();
                    
                    if (ackResult.Buffer.Length >= 4 &&
                        ackResult.Buffer[0] == 0 && ackResult.Buffer[1] == 4) {
                        ushort ackBlock = (ushort)((ackResult.Buffer[2] << 8) | ackResult.Buffer[3]);
                        if (ackBlock == blockNumber) {
                            ackReceived = true;
                        }
                    }
                }
                catch (SocketException) {
                    retries--;
                    logger.LogWarning("TFTP timeout for block {Block}, retries left: {Retries}", 
                        blockNumber, retries);
                }
            }
            
            if (!ackReceived) {
                logger.LogError("TFTP transfer failed after retries for {File}", filePath);
                return;
            }
            
            blockNumber++;
            
            if (bytesRead < blockSize) {
                break;
            }
        }
        
        logger.LogInformation("TFTP transfer completed: {File}, {Blocks} blocks", 
            Path.GetFileName(filePath), blockNumber - 1);
    }

    private async Task SendError(IPEndPoint remoteEndPoint, ushort errorCode, string message) {
        var errorPacket = new byte[4 + message.Length + 1];
        errorPacket[0] = 0;
        errorPacket[1] = 5;
        errorPacket[2] = (byte)(errorCode >> 8);
        errorPacket[3] = (byte)(errorCode & 0xFF);
        System.Text.Encoding.ASCII.GetBytes(message, 0, message.Length, errorPacket, 4);
        errorPacket[^1] = 0;
        
        if (_tftpSocket != null) {
            await _tftpSocket.SendAsync(errorPacket, remoteEndPoint);
        }
    }

    private static string ExtractString(byte[] buffer, int startIndex) {
        int endIndex = Array.IndexOf<byte>(buffer, 0, startIndex);
        if (endIndex == -1) endIndex = buffer.Length;
        return System.Text.Encoding.ASCII.GetString(buffer, startIndex, endIndex - startIndex);
    }

    private async Task LogPxeEvent(string eventType, string ipAddress, string fileName) {
        try {
            using var scope = serviceProvider.CreateScope();
            var dbContext = scope.ServiceProvider.GetRequiredService<ApplicationDbContext>();
            
            dbContext.PxeEvents.Add(new PxeEvent {
                EventType = eventType,
                MacAddress = "unknown",
                IpAddress = ipAddress,
                BootFileName = fileName
            });
            
            await dbContext.SaveChangesAsync();
        }
        catch (Exception ex) {
            logger.LogError(ex, "Failed to log PXE event");
        }
    }

    public override void Dispose() {
        _tftpSocket?.Close();
        base.Dispose();
    }
}






==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\App.razor
==============================================================================
<CascadingAuthenticationState>
    <Router AppAssembly="@typeof(App).Assembly">
        <Found Context="routeData">
            <AuthorizeRouteView RouteData="@routeData" DefaultLayout="@typeof(MainLayout)">
                <NotAuthorized>
                    @if (context.User.Identity?.IsAuthenticated != true)
                    {
                        <RedirectToLogin />
                    }
                    else
                    {
                        <p role="alert">You are not authorized to access this resource.</p>
                    }
                </NotAuthorized>
            </AuthorizeRouteView>
            <FocusOnNavigate RouteData="@routeData" Selector="h1" />
        </Found>
        <NotFound>
            <PageTitle>Not found</PageTitle>
            <LayoutView Layout="@typeof(MainLayout)">
                <p role="alert">Sorry, there's nothing at this address.</p>
            </LayoutView>
        </NotFound>
    </Router>
</CascadingAuthenticationState>




==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\Program.cs
==============================================================================
using Microsoft.AspNetCore.Components.Web;
using Microsoft.AspNetCore.Components.WebAssembly.Hosting;
using Blazored.LocalStorage;
using Microsoft.AspNetCore.Components.Authorization;
using ProPXEServer.Client;
using ProPXEServer.Client.Services;

var builder = WebAssemblyHostBuilder.CreateDefault(args);
builder.RootComponents.Add<App>("#app");
builder.RootComponents.Add<HeadOutlet>("head::after");

builder.Services.AddBlazoredLocalStorage();

builder.Services.AddScoped<CustomAuthStateProvider>();
builder.Services.AddScoped<AuthenticationStateProvider>(sp => sp.GetRequiredService<CustomAuthStateProvider>());
builder.Services.AddScoped<AuthService>();
builder.Services.AddScoped<AuthenticationHeaderHandler>();
builder.Services.AddAuthorizationCore();

builder.Services.AddHttpClient("ProPXEServer.API", client => {
    client.BaseAddress = new Uri(builder.Configuration["ApiBaseUrl"] ?? "https://localhost:5001/");
})
.AddHttpMessageHandler<AuthenticationHeaderHandler>();

builder.Services.AddScoped(sp => sp.GetRequiredService<IHttpClientFactory>()
    .CreateClient("ProPXEServer.API"));

await builder.Build().RunAsync();






==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\ProPXEServer.Client.csproj
==============================================================================
<Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">

  <PropertyGroup>
    <TargetFramework>net10.0</TargetFramework>
    <LangVersion>14</LangVersion>
    <Nullable>enable</Nullable>
    <ImplicitUsings>enable</ImplicitUsings>
    <OverrideHtmlAssetPlaceholders>true</OverrideHtmlAssetPlaceholders>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Blazored.LocalStorage" Version="4.5.0" />
    <PackageReference Include="Microsoft.AspNetCore.Components.Authorization" Version="10.0.0" />
    <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly" Version="10.0.0" />
    <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly.Authentication" Version="10.0.0" />
    <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly.DevServer" Version="10.0.0" PrivateAssets="all" />
    <PackageReference Include="Microsoft.Extensions.Http" Version="10.0.0" />
  </ItemGroup>

</Project>




==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\_Imports.razor
==============================================================================
@using System.Net.Http
@using System.Net.Http.Json
@using Microsoft.AspNetCore.Components.Forms
@using Microsoft.AspNetCore.Components.Routing
@using Microsoft.AspNetCore.Components.Web
@using Microsoft.AspNetCore.Components.Web.Virtualization
@using Microsoft.AspNetCore.Components.WebAssembly.Http
@using Microsoft.JSInterop
@using ProPXEServer.Client
@using ProPXEServer.Client.Layout
@using Microsoft.AspNetCore.Components.Authorization
@using ProPXEServer.Client.Services
@using ProPXEServer.Client.Shared





==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\Layout\MainLayout.razor
==============================================================================
@inherits LayoutComponentBase

<div class="app-container">
    <aside class="app-sidebar">
        <NavMenu />
    </aside>

    <main class="app-main">
        <article class="app-content">
            @Body
        </article>
    </main>
</div>

<ThemeToggle />

<style>
    .app-container {
        display: grid;
        grid-template-columns: 250px 1fr;
        height: 100vh;
        overflow: hidden;
    }

    .app-sidebar {
        height: 100vh;
        overflow-y: auto;
    }

    .app-main {
        height: 100vh;
        overflow-y: auto;
        background: var(--bg-primary);
    }

    .app-content {
        min-height: 100%;
    }

    @@media (max-width: 768px) {
        .app-container {
            grid-template-columns: 60px 1fr;
        }
    }
</style>




==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\Layout\MainLayout.razor.css
==============================================================================
.page {
    position: relative;
    display: flex;
    flex-direction: column;
}

main {
    flex: 1;
}

.sidebar {
    background-image: linear-gradient(180deg, rgb(5, 39, 103) 0%, #3a0647 70%);
}

.top-row {
    background-color: #f7f7f7;
    border-bottom: 1px solid #d6d5d5;
    justify-content: flex-end;
    height: 3.5rem;
    display: flex;
    align-items: center;
}

    .top-row ::deep a, .top-row ::deep .btn-link {
        white-space: nowrap;
        margin-left: 1.5rem;
        text-decoration: none;
    }

    .top-row ::deep a:hover, .top-row ::deep .btn-link:hover {
        text-decoration: underline;
    }

    .top-row ::deep a:first-child {
        overflow: hidden;
        text-overflow: ellipsis;
    }

@@media (max-width: 640.98px) {
    .top-row {
        justify-content: space-between;
    }

    .top-row ::deep a, .top-row ::deep .btn-link {
        margin-left: 0;
    }
}

@@media (min-width: 641px) {
    .page {
        flex-direction: row;
    }

    .sidebar {
        width: 250px;
        height: 100vh;
        position: sticky;
        top: 0;
    }

    .top-row {
        position: sticky;
        top: 0;
        z-index: 1;
    }

    .top-row.auth ::deep a:first-child {
        flex: 1;
        text-align: right;
        width: 0;
    }

    .top-row, article {
        padding-left: 2rem !important;
        padding-right: 1.5rem !important;
    }
}




==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\Layout\NavMenu.razor
==============================================================================
<div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="">ProPXE Server</a>
        <button title="Navigation menu" class="navbar-toggler" @onclick="ToggleNavMenu">
            <span class="navbar-toggler-icon"></span>
        </button>
    </div>
</div>

<div class="@NavMenuCssClass" @onclick="ToggleNavMenu">
    <nav class="flex-column">
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                <span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> Home
            </NavLink>
        </div>
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="counter">
                <span class="bi bi-plus-square-fill-nav-menu" aria-hidden="true"></span> Counter
            </NavLink>
        </div>
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="weather">
                <span class="bi bi-list-nested-nav-menu" aria-hidden="true"></span> Weather
            </NavLink>
        </div>
    </nav>
</div>

@code {
    private bool collapseNavMenu = true;

    private string? NavMenuCssClass => collapseNavMenu ? "collapse" : null;

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }
}




==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\Layout\NavMenu.razor.css
==============================================================================
.navbar-toggler {
    background-color: rgba(255, 255, 255, 0.1);
}

.top-row {
    min-height: 3.5rem;
    background-color: rgba(0,0,0,0.4);
}

.navbar-brand {
    font-size: 1.1rem;
}

.bi {
    display: inline-block;
    position: relative;
    width: 1.25rem;
    height: 1.25rem;
    margin-right: 0.75rem;
    top: -1px;
    background-size: cover;
}

.bi-house-door-fill-nav-menu {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='white' class='bi bi-house-door-fill' viewBox='0 0 16 16'%3E%3Cpath d='M6.5 14.5v-3.505c0-.245.25-.495.5-.495h2c.25 0 .5.25.5.5v3.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5Z'/%3E%3C/svg%3E");
}

.bi-plus-square-fill-nav-menu {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='white' class='bi bi-plus-square-fill' viewBox='0 0 16 16'%3E%3Cpath d='M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm6.5 4.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3a.5.5 0 0 1 1 0z'/%3E%3C/svg%3E");
}

.bi-list-nested-nav-menu {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='white' class='bi bi-list-nested' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M4.5 11.5A.5.5 0 0 1 5 11h10a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5zm-2-4A.5.5 0 0 1 3 7h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm-2-4A.5.5 0 0 1 1 3h10a.5.5 0 0 1 0 1H1a.5.5 0 0 1-.5-.5z'/%3E%3C/svg%3E");
}

.nav-item {
    font-size: 0.9rem;
    padding-bottom: 0.5rem;
}

    .nav-item:first-of-type {
        padding-top: 1rem;
    }

    .nav-item:last-of-type {
        padding-bottom: 1rem;
    }

    .nav-item ::deep a {
        color: #d7d7d7;
        border-radius: 4px;
        height: 3rem;
        display: flex;
        align-items: center;
        line-height: 3rem;
    }

.nav-item ::deep a.active {
    background-color: rgba(255,255,255,0.37);
    color: white;
}

.nav-item ::deep a:hover {
    background-color: rgba(255,255,255,0.1);
    color: white;
}

@@media (min-width: 641px) {
    .navbar-toggler {
        display: none;
    }

    .collapse {
        /* Never collapse the sidebar for wide screens */
        display: block;
    }

    .nav-scrollable {
        /* Allow sidebar to scroll for tall menus */
        height: calc(100vh - 3.5rem);
        overflow-y: auto;
    }
}




==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\Pages\Analytics.razor
==============================================================================
@page "/analytics"
@inject HttpClient Http
@inject AuthService AuthService
@inject NavigationManager Navigation

<PageTitle>Analytics - ProPXEServer</PageTitle>

<div class="analytics-container fade-in">
    <header class="page-header">
        <div>
            <h1>ðŸ“Š Analytics & Insights</h1>
            <p class="text-muted">Boot history, usage statistics, and performance metrics</p>
        </div>
        <button @onclick="NavigateHome" class="btn">
            â† Dashboard
        </button>
    </header>

    @if (currentUser == null) {
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <p>Loading analytics...</p>
        </div>
    } else {
        <div class="analytics-grid">
            <div class="card overview-card">
                <h2>Overview</h2>
                <div class="overview-stats">
                    <div class="overview-stat">
                        <div class="stat-value">@totalBoots</div>
                        <div class="stat-label">Total Boots</div>
                    </div>
                    <div class="overview-stat">
                        <div class="stat-value">@uniqueClients</div>
                        <div class="stat-label">Unique Clients</div>
                    </div>
                    <div class="overview-stat">
                        <div class="stat-value">@successRate%</div>
                        <div class="stat-label">Success Rate</div>
                    </div>
                    <div class="overview-stat">
                        <div class="stat-value">@avgBootTime</div>
                        <div class="stat-label">Avg Boot Time</div>
                    </div>
                </div>
            </div>

            <div class="card chart-card">
                <h2>Boot Events Over Time</h2>
                <div class="chart-placeholder">
                    <div class="placeholder-icon">ðŸ“ˆ</div>
                    <p>Chart visualization will appear here</p>
                    <p class="text-muted">Showing boot events for the last 30 days</p>
                </div>
            </div>

            <div class="card architecture-card">
                <h2>Architecture Breakdown</h2>
                <div class="architecture-stats">
                    <div class="arch-item">
                        <div class="arch-bar">
                            <div class="arch-fill bios" style="width: 45%"></div>
                        </div>
                        <div class="arch-label">
                            <span class="badge badge-info">BIOS</span>
                            <span>45%</span>
                        </div>
                    </div>
                    <div class="arch-item">
                        <div class="arch-bar">
                            <div class="arch-fill uefi" style="width: 50%"></div>
                        </div>
                        <div class="arch-label">
                            <span class="badge badge-success">UEFI</span>
                            <span>50%</span>
                        </div>
                    </div>
                    <div class="arch-item">
                        <div class="arch-bar">
                            <div class="arch-fill arm" style="width: 5%"></div>
                        </div>
                        <div class="arch-label">
                            <span class="badge badge-warning">ARM64</span>
                            <span>5%</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card top-files-card">
                <h2>Most Booted Files</h2>
                <div class="top-files-list">
                    <div class="top-file-item">
                        <div class="file-rank">1</div>
                        <div class="file-details">
                            <div class="file-name">netboot.xyz.efi</div>
                            <div class="file-boots">1,234 boots</div>
                        </div>
                        <div class="file-bar">
                            <div class="file-fill" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="top-file-item">
                        <div class="file-rank">2</div>
                        <div class="file-details">
                            <div class="file-name">netboot.xyz.kpxe</div>
                            <div class="file-boots">856 boots</div>
                        </div>
                        <div class="file-bar">
                            <div class="file-fill" style="width: 69%"></div>
                        </div>
                    </div>
                    <div class="top-file-item">
                        <div class="file-rank">3</div>
                        <div class="file-details">
                            <div class="file-name">ubuntu-22.04.iso</div>
                            <div class="file-boots">342 boots</div>
                        </div>
                        <div class="file-bar">
                            <div class="file-fill" style="width: 28%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card peak-hours-card">
                <h2>Peak Usage Hours</h2>
                <div class="heatmap">
                    <p class="text-muted">Hour-by-hour boot activity heatmap</p>
                    <div class="heatmap-grid">
                        @for (int hour = 0; hour < 24; hour++) {
                            <div class="heatmap-cell @GetHeatmapClass(hour)" title="@hour:00">
                                @hour
                            </div>
                        }
                    </div>
                </div>
            </div>

            <div class="card client-list-card">
                <h2>Top Clients</h2>
                <div class="client-list">
                    @foreach (var client in topClients) {
                        <div class="client-item">
                            <div class="client-icon">ðŸ’»</div>
                            <div class="client-info">
                                <div class="client-mac">@client.MacAddress</div>
                                <div class="client-count">@client.BootCount boots</div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    }
</div>

<style>
    .analytics-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: var(--space-6);
    }

    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--space-8);
        padding-bottom: var(--space-6);
        border-bottom: 1px solid var(--border-color);
    }

    .page-header h1 {
        margin: 0 0 var(--space-2) 0;
        font-size: 2rem;
    }

    .analytics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: var(--space-6);
    }

    .overview-card {
        grid-column: 1 / -1;
    }

    .overview-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: var(--space-6);
        margin-top: var(--space-6);
    }

    .overview-stat {
        text-align: center;
    }

    .chart-card {
        grid-column: 1 / -1;
    }

    .chart-placeholder {
        text-align: center;
        padding: var(--space-8);
        background: var(--bg-secondary);
        border-radius: var(--radius-md);
        margin-top: var(--space-4);
    }

    .placeholder-icon {
        font-size: 4rem;
        opacity: 0.3;
        margin-bottom: var(--space-4);
    }

    .architecture-stats {
        display: flex;
        flex-direction: column;
        gap: var(--space-4);
        margin-top: var(--space-4);
    }

    .arch-item {
        display: flex;
        flex-direction: column;
        gap: var(--space-2);
    }

    .arch-bar {
        height: 24px;
        background: var(--bg-tertiary);
        border-radius: var(--radius-md);
        overflow: hidden;
    }

    .arch-fill {
        height: 100%;
        border-radius: var(--radius-md);
        transition: width var(--transition-base);
    }

    .arch-fill.bios {
        background: var(--info);
    }

    .arch-fill.uefi {
        background: var(--success);
    }

    .arch-fill.arm {
        background: var(--warning);
    }

    .arch-label {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.875rem;
    }

    .top-files-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-4);
        margin-top: var(--space-4);
    }

    .top-file-item {
        display: grid;
        grid-template-columns: auto 1fr auto;
        gap: var(--space-4);
        align-items: center;
    }

    .file-rank {
        width: 32px;
        height: 32px;
        border-radius: var(--radius-full);
        background: var(--accent);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
    }

    .file-details {
        display: flex;
        flex-direction: column;
        gap: var(--space-1);
    }

    .file-name {
        font-weight: 600;
        color: var(--text-primary);
    }

    .file-boots {
        font-size: 0.875rem;
        color: var(--text-secondary);
    }

    .file-bar {
        width: 150px;
        height: 8px;
        background: var(--bg-tertiary);
        border-radius: var(--radius-full);
        overflow: hidden;
    }

    .file-fill {
        height: 100%;
        background: var(--accent);
        border-radius: var(--radius-full);
    }

    .heatmap {
        margin-top: var(--space-4);
    }

    .heatmap-grid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: var(--space-2);
        margin-top: var(--space-4);
    }

    .heatmap-cell {
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: var(--radius-sm);
        font-size: 0.75rem;
        font-weight: 600;
        cursor: pointer;
        transition: all var(--transition-fast);
    }

    .heatmap-cell.low {
        background: var(--bg-tertiary);
        color: var(--text-tertiary);
    }

    .heatmap-cell.medium {
        background: rgba(88, 166, 255, 0.3);
        color: var(--text-primary);
    }

    .heatmap-cell.high {
        background: var(--accent);
        color: white;
    }

    .heatmap-cell:hover {
        transform: scale(1.1);
    }

    .client-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-3);
        margin-top: var(--space-4);
    }

    .client-item {
        display: flex;
        gap: var(--space-3);
        padding: var(--space-3);
        background: var(--bg-secondary);
        border-radius: var(--radius-md);
    }

    .client-icon {
        font-size: 1.5rem;
    }

    .client-info {
        flex: 1;
    }

    .client-mac {
        font-weight: 600;
        font-family: monospace;
        color: var(--text-primary);
    }

    .client-count {
        font-size: 0.875rem;
        color: var(--text-secondary);
    }

    @@media (max-width: 768px) {
        .analytics-grid {
            grid-template-columns: 1fr;
        }

        .overview-card,
        .chart-card {
            grid-column: 1;
        }

        .heatmap-grid {
            grid-template-columns: repeat(6, 1fr);
        }
    }
</style>

@code {
    private AuthService.UserInfo? currentUser;
    private int totalBoots = 2345;
    private int uniqueClients = 47;
    private int successRate = 98;
    private string avgBootTime = "3.2s";
    private List<TopClient> topClients = [];

    protected override async Task OnInitializedAsync() {
        currentUser = await AuthService.GetCurrentUserAsync();
        if (currentUser == null) {
            Navigation.NavigateTo("/login");
            return;
        }

        LoadAnalytics();
    }

    private void LoadAnalytics() {
        topClients = [
            new("AA:BB:CC:DD:EE:01", 234),
            new("AA:BB:CC:DD:EE:02", 187),
            new("AA:BB:CC:DD:EE:03", 156),
            new("AA:BB:CC:DD:EE:04", 142),
            new("AA:BB:CC:DD:EE:05", 98)
        ];
    }

    private string GetHeatmapClass(int hour) {
        if (hour >= 9 && hour <= 17) return "high";
        if (hour >= 7 && hour <= 20) return "medium";
        return "low";
    }

    private record TopClient(string MacAddress, int BootCount);

    private void NavigateHome() => Navigation.NavigateTo("/");
}




==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\Pages\Endpoints.razor
==============================================================================
@page "/endpoints"
@inject HttpClient Http
@inject AuthService AuthService
@inject NavigationManager Navigation

<PageTitle>OS Endpoints - ProPXEServer</PageTitle>

<div class="endpoints-container fade-in">
    <header class="page-header">
        <div>
            <h1>ðŸ“š OS Endpoints Catalog</h1>
            <p class="text-muted">100+ operating systems from netboot.xyz</p>
        </div>
        <button @onclick="NavigateHome" class="btn">
            â† Dashboard
        </button>
    </header>

    <div class="search-section card">
        <input type="text" 
               @bind="searchQuery" 
               @bind:event="oninput"
               placeholder="Search operating systems..." 
               class="search-input" />
        <div class="filter-tags">
            <button class="filter-tag @(selectedFilter == "All" ? "active" : "")" @onclick='() => selectedFilter = "All"'>
                All (@GetFilterCount("All"))
            </button>
            <button class="filter-tag @(selectedFilter == "Linux" ? "active" : "")" @onclick='() => selectedFilter = "Linux"'>
                ðŸ§ Linux (@GetFilterCount("Linux"))
            </button>
            <button class="filter-tag @(selectedFilter == "Windows" ? "active" : "")" @onclick='() => selectedFilter = "Windows"'>
                ðŸªŸ Windows (@GetFilterCount("Windows"))
            </button>
            <button class="filter-tag @(selectedFilter == "BSD" ? "active" : "")" @onclick='() => selectedFilter = "BSD"'>
                ðŸ‘¹ BSD (@GetFilterCount("BSD"))
            </button>
            <button class="filter-tag @(selectedFilter == "Other" ? "active" : "")" @onclick='() => selectedFilter = "Other"'>
                ðŸ”§ Other (@GetFilterCount("Other"))
            </button>
        </div>
    </div>

    <div class="endpoints-grid">
        @foreach (var os in GetFilteredEndpoints()) {
            <div class="endpoint-card card">
                <div class="endpoint-header">
                    <div class="endpoint-icon">@GetOsIcon(os.Category)</div>
                    <div class="endpoint-info">
                        <div class="endpoint-name">@os.Name</div>
                        <div class="endpoint-category">
                            <span class="badge @GetCategoryBadge(os.Category)">@os.Category</span>
                        </div>
                    </div>
                </div>
                <div class="endpoint-details">
                    @if (!string.IsNullOrEmpty(os.Version)) {
                        <div class="detail-item">
                            <span class="detail-label">Version:</span>
                            <span class="detail-value">@os.Version</span>
                        </div>
                    }
                    @if (!string.IsNullOrEmpty(os.Architecture)) {
                        <div class="detail-item">
                            <span class="detail-label">Architecture:</span>
                            <span class="detail-value">@os.Architecture</span>
                        </div>
                    }
                    @if (!string.IsNullOrEmpty(os.Url)) {
                        <div class="detail-item">
                            <button @onclick="() => CopyUrl(os.Url)" class="btn btn-sm copy-btn">
                                ðŸ“‹ Copy URL
                            </button>
                        </div>
                    }
                </div>
            </div>
        }
    </div>

    @if (GetFilteredEndpoints().Count == 0) {
        <div class="empty-state card">
            <div class="empty-icon">ðŸ”</div>
            <p>No operating systems found</p>
            <p class="text-muted">Try adjusting your search or filter</p>
        </div>
    }
</div>

<style>
    .endpoints-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: var(--space-6);
    }

    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--space-8);
        padding-bottom: var(--space-6);
        border-bottom: 1px solid var(--border-color);
    }

    .page-header h1 {
        margin: 0 0 var(--space-2) 0;
        font-size: 2rem;
    }

    .search-section {
        margin-bottom: var(--space-6);
    }

    .search-input {
        width: 100%;
        padding: var(--space-4);
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        color: var(--text-primary);
        font-size: 1rem;
        margin-bottom: var(--space-4);
        transition: all var(--transition-fast);
    }

    .search-input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
    }

    .filter-tags {
        display: flex;
        gap: var(--space-2);
        flex-wrap: wrap;
    }

    .filter-tag {
        padding: var(--space-2) var(--space-4);
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-full);
        color: var(--text-primary);
        cursor: pointer;
        transition: all var(--transition-fast);
        font-size: 0.875rem;
    }

    .filter-tag:hover {
        border-color: var(--accent);
        background: var(--bg-tertiary);
    }

    .filter-tag.active {
        background: var(--accent);
        border-color: var(--accent);
        color: white;
    }

    .endpoints-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: var(--space-4);
    }

    .endpoint-card {
        transition: all var(--transition-fast);
    }

    .endpoint-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
    }

    .endpoint-header {
        display: flex;
        gap: var(--space-3);
        margin-bottom: var(--space-4);
        padding-bottom: var(--space-3);
        border-bottom: 1px solid var(--border-color);
    }

    .endpoint-icon {
        font-size: 2.5rem;
    }

    .endpoint-info {
        flex: 1;
    }

    .endpoint-name {
        font-weight: 600;
        font-size: 1.125rem;
        color: var(--text-primary);
        margin-bottom: var(--space-2);
    }

    .endpoint-details {
        display: flex;
        flex-direction: column;
        gap: var(--space-2);
    }

    .detail-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.875rem;
    }

    .detail-label {
        color: var(--text-secondary);
        font-weight: 600;
    }

    .detail-value {
        color: var(--text-primary);
        font-family: monospace;
    }

    .copy-btn {
        width: 100%;
        margin-top: var(--space-2);
    }

    .badge-linux {
        background: var(--success);
        color: white;
    }

    .badge-windows {
        background: var(--info);
        color: white;
    }

    .badge-bsd {
        background: var(--warning);
        color: white;
    }

    .badge-other {
        background: var(--text-tertiary);
        color: white;
    }

    .empty-state {
        text-align: center;
        padding: var(--space-8);
    }

    .empty-icon {
        font-size: 4rem;
        opacity: 0.3;
        margin-bottom: var(--space-4);
    }

    @@media (max-width: 768px) {
        .endpoints-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

@code {
    private AuthService.UserInfo? currentUser;
    private string searchQuery = "";
    private string selectedFilter = "All";
    private List<OsEndpoint> endpoints = [];

    protected override async Task OnInitializedAsync() {
        currentUser = await AuthService.GetCurrentUserAsync();
        if (currentUser == null) {
            Navigation.NavigateTo("/login");
            return;
        }

        LoadEndpoints();
    }

    private void LoadEndpoints() {
        endpoints = [
            new("Ubuntu 22.04 LTS", "Linux", "22.04", "x86_64", "https://releases.ubuntu.com/22.04/"),
            new("Debian 12", "Linux", "12", "x86_64", "https://www.debian.org/"),
            new("Fedora 39", "Linux", "39", "x86_64", "https://fedoraproject.org/"),
            new("Arch Linux", "Linux", "latest", "x86_64", "https://archlinux.org/"),
            new("AlmaLinux 9", "Linux", "9", "x86_64", "https://almalinux.org/"),
            new("Rocky Linux 9", "Linux", "9", "x86_64", "https://rockylinux.org/"),
            new("CentOS Stream 9", "Linux", "9", "x86_64", "https://centos.org/"),
            new("openSUSE Tumbleweed", "Linux", "latest", "x86_64", "https://opensuse.org/"),
            new("Kali Linux", "Linux", "2024.1", "x86_64", "https://kali.org/"),
            new("Linux Mint", "Linux", "21.3", "x86_64", "https://linuxmint.com/"),
            new("Pop!_OS", "Linux", "22.04", "x86_64", "https://pop.system76.com/"),
            new("Manjaro", "Linux", "latest", "x86_64", "https://manjaro.org/"),
            new("Windows Server 2022", "Windows", "2022", "x86_64", ""),
            new("Windows 11", "Windows", "23H2", "x86_64", ""),
            new("Windows 10", "Windows", "22H2", "x86_64", ""),
            new("FreeBSD 14", "BSD", "14.0", "x86_64", "https://freebsd.org/"),
            new("OpenBSD 7.4", "BSD", "7.4", "x86_64", "https://openbsd.org/"),
            new("NetBSD 10", "BSD", "10.0", "x86_64", "https://netbsd.org/"),
            new("TrueNAS SCALE", "Other", "latest", "x86_64", "https://truenas.com/"),
            new("Proxmox VE", "Other", "8.1", "x86_64", "https://proxmox.com/"),
        ];
    }

    private List<OsEndpoint> GetFilteredEndpoints() {
        var filtered = endpoints.AsEnumerable();

        if (!string.IsNullOrWhiteSpace(searchQuery)) {
            filtered = filtered.Where(e => 
                e.Name.Contains(searchQuery, StringComparison.OrdinalIgnoreCase) ||
                e.Category.Contains(searchQuery, StringComparison.OrdinalIgnoreCase));
        }

        if (selectedFilter != "All") {
            filtered = filtered.Where(e => e.Category == selectedFilter);
        }

        return [.. filtered];
    }

    private int GetFilterCount(string filter) {
        if (filter == "All") return endpoints.Count;
        return endpoints.Count(e => e.Category == filter);
    }

    private string GetOsIcon(string category) => category switch {
        "Linux" => "ðŸ§",
        "Windows" => "ðŸªŸ",
        "BSD" => "ðŸ‘¹",
        _ => "ðŸ”§"
    };

    private string GetCategoryBadge(string category) => $"badge-{category.ToLowerInvariant()}";

    private async Task CopyUrl(string url) {
        // In a real app, this would use JSInterop to copy to clipboard
        await Task.CompletedTask;
    }

    private record OsEndpoint(string Name, string Category, string Version, string Architecture, string Url);

    private void NavigateHome() => Navigation.NavigateTo("/");
}




==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\Pages\Files.razor
==============================================================================
@page "/files"
@inject HttpClient Http
@inject AuthService AuthService
@inject NavigationManager Navigation

<PageTitle>Boot Files - ProPXEServer</PageTitle>

<div class="files-container fade-in">
    <header class="page-header">
        <div>
            <h1>ðŸ“ Boot Files Management</h1>
            <p class="text-muted">Upload and manage network boot files</p>
        </div>
        <button @onclick="NavigateHome" class="btn">
            â† Dashboard
        </button>
    </header>

    @if (!currentUser?.IsSubscribed ?? true) {
        <div class="subscription-card card">
            <div class="subscription-icon">ðŸ”’</div>
            <h2>Unlock Pro Features</h2>
            <p>Upload custom boot files and manage your PXE environment with a Pro subscription.</p>
            <ul class="features-list">
                <li>âœ“ Unlimited file uploads (100GB storage)</li>
                <li>âœ“ Custom boot configurations</li>
                <li>âœ“ Priority support</li>
                <li>âœ“ Advanced analytics</li>
            </ul>
            <button @onclick="NavigateToSubscription" class="btn btn-primary btn-large">
                Upgrade to Pro - $20/month
            </button>
        </div>
    } else {
        <div class="upload-section card">
            <h2>Upload Boot File</h2>
            <div class="drop-zone @(isDragging ? "dragging" : "")"
                 @ondragenter="HandleDragEnter"
                 @ondragleave="HandleDragLeave"
                 @ondragover:preventDefault
                 @ondrop="HandleDrop"
                 @ondrop:preventDefault>
                <InputFile OnChange="HandleFileSelected" class="file-input" id="fileInput" />
                <label for="fileInput" class="drop-zone-label">
                    <div class="drop-zone-icon">ðŸ“¤</div>
                    <div class="drop-zone-text">
                        <strong>Drop boot files here</strong> or click to browse
                    </div>
                    <div class="drop-zone-hint">Supports: .iso, .efi, .kpxe, .img (Max 10GB)</div>
                </label>
            </div>

            @if (selectedFile != null) {
                <div class="file-preview slide-in">
                    <div class="preview-icon">ðŸ“„</div>
                    <div class="preview-info">
                        <div class="preview-name">@selectedFile.Name</div>
                        <div class="preview-size">@FormatBytes(selectedFile.Size)</div>
                    </div>
                    <button @onclick="UploadFile" disabled="@isUploading" class="btn btn-primary">
                        @(isUploading ? "Uploading..." : "Upload")
                    </button>
                    <button @onclick="ClearSelection" class="btn">Clear</button>
                </div>
            }

            @if (uploadProgress > 0 && isUploading) {
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: @uploadProgress%"></div>
                    </div>
                    <div class="progress-text">@uploadProgress%</div>
                </div>
            }

            @if (!string.IsNullOrEmpty(uploadMessage)) {
                <div class="alert @(uploadSuccess ? "alert-success" : "alert-error")">
                    @uploadMessage
                </div>
            }
        </div>

        <div class="files-section card">
            <div class="section-header">
                <h2>Your Boot Files</h2>
                <div class="storage-meter">
                    <div class="storage-text">Storage: 2.4GB / 100GB</div>
                    <div class="storage-bar">
                        <div class="storage-fill" style="width: 2.4%"></div>
                    </div>
                </div>
            </div>

            @if (bootFiles.Count == 0) {
                <div class="empty-state">
                    <div class="empty-icon">ðŸ“¦</div>
                    <p>No boot files uploaded yet.</p>
                    <p class="text-muted">Upload your first boot file to get started!</p>
                </div>
            } else {
                <div class="files-grid">
                    @foreach (var file in bootFiles) {
                        <div class="file-card">
                            <div class="file-card-header">
                                <div class="file-icon">@GetFileIcon(file.FileName)</div>
                                <div class="file-actions">
                                    <button @onclick="() => DownloadFile(file.Id)" class="btn-icon" title="Download">
                                        â¬‡ï¸
                                    </button>
                                    <button @onclick="() => DeleteFile(file.Id)" class="btn-icon btn-danger" title="Delete">
                                        ðŸ—‘ï¸
                                    </button>
                                </div>
                            </div>
                            <div class="file-details">
                                <div class="file-name">@file.FileName</div>
                                <div class="file-meta">
                                    <span class="badge badge-info">@GetFileType(file.FileName)</span>
                                    <span class="text-muted">@FormatBytes(file.FileSizeBytes)</span>
                                    <span class="text-muted">@file.UploadedAt.ToString("MMM dd, yyyy")</span>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
        </div>
    }
</div>

<style>
    .files-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: var(--space-6);
    }

    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--space-8);
        padding-bottom: var(--space-6);
        border-bottom: 1px solid var(--border-color);
    }

    .page-header h1 {
        margin: 0 0 var(--space-2) 0;
        font-size: 2rem;
    }

    .subscription-card {
        text-align: center;
        padding: var(--space-8);
        max-width: 600px;
        margin: 0 auto;
    }

    .subscription-icon {
        font-size: 4rem;
        margin-bottom: var(--space-4);
    }

    .subscription-card h2 {
        margin-bottom: var(--space-4);
        color: var(--text-primary);
    }

    .subscription-card p {
        color: var(--text-secondary);
        margin-bottom: var(--space-6);
    }

    .features-list {
        list-style: none;
        text-align: left;
        max-width: 400px;
        margin: 0 auto var(--space-6) auto;
        padding: 0;
    }

    .features-list li {
        padding: var(--space-2) 0;
        color: var(--text-primary);
    }

    .btn-large {
        padding: var(--space-4) var(--space-8);
        font-size: 1.125rem;
    }

    .drop-zone {
        border: 2px dashed var(--border-color);
        border-radius: var(--radius-lg);
        padding: var(--space-8);
        text-align: center;
        transition: all var(--transition-base);
        cursor: pointer;
        position: relative;
        background: var(--bg-secondary);
    }

    .drop-zone:hover, .drop-zone.dragging {
        border-color: var(--accent);
        background: var(--bg-tertiary);
    }

    .file-input {
        position: absolute;
        width: 1px;
        height: 1px;
        opacity: 0;
        overflow: hidden;
    }

    .drop-zone-label {
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--space-3);
    }

    .drop-zone-icon {
        font-size: 4rem;
        opacity: 0.5;
    }

    .drop-zone-text {
        color: var(--text-primary);
        font-size: 1.125rem;
    }

    .drop-zone-hint {
        color: var(--text-tertiary);
        font-size: 0.875rem;
    }

    .file-preview {
        display: flex;
        align-items: center;
        gap: var(--space-4);
        padding: var(--space-4);
        background: var(--bg-secondary);
        border-radius: var(--radius-md);
        margin-top: var(--space-4);
    }

    .preview-icon {
        font-size: 2.5rem;
    }

    .preview-info {
        flex: 1;
    }

    .preview-name {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: var(--space-1);
    }

    .preview-size {
        color: var(--text-secondary);
        font-size: 0.875rem;
    }

    .progress-container {
        margin-top: var(--space-4);
    }

    .progress-bar {
        height: 8px;
        background: var(--bg-tertiary);
        border-radius: var(--radius-full);
        overflow: hidden;
        margin-bottom: var(--space-2);
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--accent), var(--info));
        transition: width var(--transition-base);
        border-radius: var(--radius-full);
    }

    .progress-text {
        text-align: center;
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--text-secondary);
    }

    .alert {
        padding: var(--space-4);
        border-radius: var(--radius-md);
        margin-top: var(--space-4);
    }

    .alert-success {
        background: rgba(63, 185, 80, 0.1);
        border: 1px solid var(--success);
        color: var(--success);
    }

    .alert-error {
        background: rgba(248, 81, 73, 0.1);
        border: 1px solid var(--danger);
        color: var(--danger);
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-6);
    }

    .section-header h2 {
        margin: 0;
    }

    .storage-meter {
        text-align: right;
    }

    .storage-text {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin-bottom: var(--space-2);
    }

    .storage-bar {
        width: 200px;
        height: 6px;
        background: var(--bg-tertiary);
        border-radius: var(--radius-full);
        overflow: hidden;
    }

    .storage-fill {
        height: 100%;
        background: var(--success);
        border-radius: var(--radius-full);
        transition: width var(--transition-base);
    }

    .empty-state {
        text-align: center;
        padding: var(--space-8);
    }

    .empty-icon {
        font-size: 4rem;
        opacity: 0.3;
        margin-bottom: var(--space-4);
    }

    .files-grid {
        display: grid;
        gap: var(--space-4);
    }

    .file-card {
        padding: var(--space-4);
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        transition: all var(--transition-fast);
    }

    .file-card:hover {
        border-color: var(--accent);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }

    .file-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-3);
    }

    .file-icon {
        font-size: 2rem;
    }

    .file-actions {
        display: flex;
        gap: var(--space-2);
    }

    .btn-icon {
        width: 40px;
        height: 40px;
        border: 1px solid var(--border-color);
        background: var(--bg-card);
        border-radius: var(--radius-md);
        cursor: pointer;
        font-size: 1.25rem;
        transition: all var(--transition-fast);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .btn-icon:hover {
        background: var(--bg-tertiary);
        border-color: var(--accent);
    }

    .btn-icon.btn-danger:hover {
        background: rgba(248, 81, 73, 0.1);
        border-color: var(--danger);
    }

    .file-details {
        display: flex;
        flex-direction: column;
        gap: var(--space-2);
    }

    .file-name {
        font-weight: 600;
        font-size: 1rem;
        color: var(--text-primary);
    }

    .file-meta {
        display: flex;
        gap: var(--space-3);
        align-items: center;
        font-size: 0.875rem;
    }

    @@media (max-width: 768px) {
        .page-header {
            flex-direction: column;
            gap: var(--space-4);
        }

        .storage-meter {
            text-align: left;
        }

        .storage-bar {
            width: 100%;
        }
    }
</style>

@code {
    private AuthService.UserInfo? currentUser;
    private List<BootFile> bootFiles = [];
    private IBrowserFile? selectedFile;
    private bool isUploading = false;
    private bool isDragging = false;
    private int uploadProgress = 0;
    private string uploadMessage = "";
    private bool uploadSuccess = false;

    protected override async Task OnInitializedAsync() {
        currentUser = await AuthService.GetCurrentUserAsync();
        if (currentUser == null) {
            Navigation.NavigateTo("/login");
            return;
        }

        await LoadFiles();
    }

    private async Task LoadFiles() {
        try {
            // bootFiles = await Http.GetFromJsonAsync<List<BootFile>>("/api/bootfiles") ?? [];
        }
        catch { }
    }

    private void HandleDragEnter() {
        isDragging = true;
    }

    private void HandleDragLeave() {
        isDragging = false;
    }

    private void HandleDrop() {
        isDragging = false;
    }

    private void HandleFileSelected(InputFileChangeEventArgs e) {
        selectedFile = e.File;
        uploadProgress = 0;
        uploadMessage = "";
    }

    private void ClearSelection() {
        selectedFile = null;
        uploadProgress = 0;
        uploadMessage = "";
    }

    private async Task UploadFile() {
        if (selectedFile == null) return;

        isUploading = true;
        uploadProgress = 0;
        uploadMessage = "";

        try {
            using var content = new MultipartFormDataContent();
            var fileContent = new StreamContent(selectedFile.OpenReadStream(maxAllowedSize: 10L * 1024 * 1024 * 1024));
            fileContent.Headers.ContentType = new System.Net.Http.Headers.MediaTypeHeaderValue("application/octet-stream");
            content.Add(fileContent, "file", selectedFile.Name);

            // Simulate progress
            for (int i = 0; i <= 100; i += 10) {
                uploadProgress = i;
                StateHasChanged();
                await Task.Delay(100);
            }

            var response = await Http.PostAsync("/api/bootfiles/upload", content);
            
            if (response.IsSuccessStatusCode) {
                uploadSuccess = true;
                uploadMessage = "âœ“ File uploaded successfully!";
                selectedFile = null;
                uploadProgress = 100;
                await LoadFiles();
            } else {
                uploadSuccess = false;
                uploadMessage = "âš  Upload failed. Please try again.";
            }
        }
        catch (Exception ex) {
            uploadSuccess = false;
            uploadMessage = $"âš  Error: {ex.Message}";
        }
        finally {
            isUploading = false;
        }
    }

    private async Task DownloadFile(int fileId) {
        Navigation.NavigateTo($"/api/bootfiles/{fileId}/download", true);
    }

    private async Task DeleteFile(int fileId) {
        await Http.DeleteAsync($"/api/bootfiles/{fileId}");
        await LoadFiles();
    }

    private static string FormatBytes(long bytes) {
        string[] sizes = ["B", "KB", "MB", "GB", "TB"];
        double len = bytes;
        int order = 0;
        while (len >= 1024 && order < sizes.Length - 1) {
            order++;
            len = len / 1024;
        }
        return $"{len:0.##} {sizes[order]}";
    }

    private static string GetFileIcon(string fileName) {
        var ext = Path.GetExtension(fileName).ToLowerInvariant();
        return ext switch {
            ".iso" => "ðŸ’¿",
            ".efi" => "âš™ï¸",
            ".kpxe" => "ðŸ”§",
            ".img" => "ðŸ’¾",
            _ => "ðŸ“„"
        };
    }

    private static string GetFileType(string fileName) {
        var ext = Path.GetExtension(fileName).ToLowerInvariant();
        if (fileName.Contains("arm64", StringComparison.OrdinalIgnoreCase)) return "ARM64";
        if (fileName.Contains("efi", StringComparison.OrdinalIgnoreCase)) return "UEFI";
        if (fileName.Contains("kpxe", StringComparison.OrdinalIgnoreCase)) return "BIOS";
        return ext.TrimStart('.').ToUpperInvariant();
    }

    public record BootFile(int Id, string FileName, long FileSizeBytes, DateTime UploadedAt);

    private void NavigateHome() => Navigation.NavigateTo("/");
    private void NavigateToSubscription() => Navigation.NavigateTo("/subscription");
}




==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\Pages\Home.razor
==============================================================================
@page "/"
@inject AuthService AuthService
@inject HttpClient Http
@inject NavigationManager Navigation

<PageTitle>PXE Dashboard - ProPXEServer</PageTitle>

<div class="dashboard fade-in">
    @if (currentUser == null) {
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <p>Loading dashboard...</p>
        </div>
    } else {
        <header class="dashboard-header">
            <div>
                <h1>ðŸ“¡ PXE Boot Dashboard</h1>
                <p class="text-muted">Network boot monitoring and management</p>
            </div>
            <div class="user-info">
                <span class="user-email">@currentUser.Email</span>
                @if (currentUser.IsSubscribed) {
                    <span class="badge badge-success">âœ“ Pro</span>
                } else {
                    <button @onclick="NavigateToSubscription" class="btn btn-success">
                        Upgrade to Pro $20/mo
                    </button>
                }
                <button @onclick="HandleLogout" class="btn">Logout</button>
            </div>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ðŸ“Š</div>
                <div class="stat-content">
                    <div class="stat-value">@bootEvents.Count</div>
                    <div class="stat-label">Total Boot Events</div>
                    <div class="stat-trend text-success">â†‘ @GetTodayEvents() today</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ðŸ–¥ï¸</div>
                <div class="stat-content">
                    <div class="stat-value">@activeClients</div>
                    <div class="stat-label">Active Clients (24h)</div>
                    <div class="stat-trend text-muted">@GetUniqueClients() unique MACs</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ðŸ“¦</div>
                <div class="stat-content">
                    <div class="stat-value">11</div>
                    <div class="stat-label">Boot Files Ready</div>
                    <div class="stat-trend text-info">netboot.xyz deployed</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">âš¡</div>
                <div class="stat-content">
                    <div class="stat-value">@GetSuccessRate()%</div>
                    <div class="stat-label">Success Rate</div>
                    <div class="stat-trend text-success">Excellent</div>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="events-section card">
                <div class="section-header">
                    <h2>ðŸ”Œ Recent Boot Events</h2>
                    <button @onclick="RefreshData" class="btn btn-sm">
                        <span class="refresh-icon">âŸ³</span> Refresh
                    </button>
                </div>
                <div class="events-list">
                    @if (bootEvents.Count == 0) {
                        <div class="empty-state">
                            <p>No boot events yet. Waiting for PXE clients...</p>
                        </div>
                    } else {
                        @foreach (var evt in bootEvents.Take(10)) {
                            <div class="event-item slide-in">
                                <div class="event-icon">@GetEventIcon(evt.EventType)</div>
                                <div class="event-details">
                                    <div class="event-type">@evt.EventType</div>
                                    <div class="event-info">
                                        <span class="badge badge-info">@evt.MacAddress</span>
                                        <span class="text-muted">â†’</span>
                                        <span>@evt.IpAddress</span>
                                    </div>
                                </div>
                                <div class="event-time">
                                    <span>@evt.Timestamp.ToString("HH:mm:ss")</span>
                                    <span class="text-muted">@GetTimeAgo(evt.Timestamp)</span>
                                </div>
                            </div>
                        }
                    }
                </div>
            </div>

            <div class="bootfiles-section card">
                <div class="section-header">
                    <h2>ðŸ“ netboot.xyz Boot Files</h2>
                    <span class="badge badge-success">Deployed</span>
                </div>
                <div class="bootfiles-grid">
                    <div class="bootfile-item">
                        <div class="bootfile-icon">ðŸ’¿</div>
                        <div class="bootfile-info">
                            <div class="bootfile-name">netboot.xyz.kpxe</div>
                            <span class="badge badge-info">BIOS</span>
                        </div>
                    </div>
                    <div class="bootfile-item">
                        <div class="bootfile-icon">ðŸ’¿</div>
                        <div class="bootfile-info">
                            <div class="bootfile-name">netboot.xyz.efi</div>
                            <span class="badge badge-success">UEFI x64</span>
                        </div>
                    </div>
                    <div class="bootfile-item">
                        <div class="bootfile-icon">ðŸ’¿</div>
                        <div class="bootfile-info">
                            <div class="bootfile-name">netboot.xyz-arm64.efi</div>
                            <span class="badge badge-warning">ARM64</span>
                        </div>
                    </div>
                    <div class="bootfile-item">
                        <div class="bootfile-icon">ðŸ“š</div>
                        <div class="bootfile-info">
                            <div class="bootfile-name">100+ OS Options</div>
                            <span class="badge badge-info">Ready</span>
                        </div>
                    </div>
                </div>
                <button @onclick="NavigateToFiles" class="btn btn-primary btn-block">
                    Manage Boot Files â†’
                </button>
            </div>
        </div>

        <div class="quick-actions">
            <button @onclick="NavigateToFiles" class="action-card">
                <span class="action-icon">ðŸ“</span>
                <span class="action-label">Boot Files</span>
                <span class="action-desc">Upload & manage</span>
            </button>
            <button @onclick="RefreshData" class="action-card">
                <span class="action-icon">ðŸ”„</span>
                <span class="action-label">Refresh</span>
                <span class="action-desc">Update stats</span>
            </button>
            <button @onclick="NavigateToSubscription" class="action-card">
                <span class="action-icon">â­</span>
                <span class="action-label">Upgrade</span>
                <span class="action-desc">Go Pro $20/mo</span>
            </button>
        </div>
    }
</div>

<style>
    .dashboard {
        max-width: 1400px;
        margin: 0 auto;
        padding: var(--space-6);
    }

    .loading-container {
        text-align: center;
        padding: 4rem;
    }

    .loading-container p {
        margin-top: var(--space-4);
        color: var(--text-secondary);
    }

    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--space-8);
        padding-bottom: var(--space-6);
        border-bottom: 1px solid var(--border-color);
    }

    .dashboard-header h1 {
        margin: 0;
        font-size: 2rem;
    }

    .user-info {
        display: flex;
        gap: var(--space-3);
        align-items: center;
    }

    .user-email {
        color: var(--text-secondary);
        font-size: 0.875rem;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: var(--space-4);
        margin-bottom: var(--space-8);
    }

    .stat-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        padding: var(--space-6);
        display: flex;
        gap: var(--space-4);
        transition: all var(--transition-base);
    }

    .stat-card:hover {
        border-color: var(--accent);
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
    }

    .stat-icon {
        font-size: 2.5rem;
        opacity: 0.8;
    }

    .stat-content {
        flex: 1;
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: var(--space-1);
        color: var(--text-primary);
    }

    .stat-label {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin-bottom: var(--space-2);
    }

    .stat-trend {
        font-size: 0.75rem;
        font-weight: 600;
    }

    .dashboard-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--space-6);
        margin-bottom: var(--space-6);
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-6);
    }

    .section-header h2 {
        margin: 0;
        font-size: 1.25rem;
    }

    .btn-sm {
        padding: var(--space-1) var(--space-3);
        font-size: 0.875rem;
    }

    .refresh-icon {
        display: inline-block;
        transition: transform var(--transition-base);
    }

    .btn-sm:hover .refresh-icon {
        transform: rotate(180deg);
    }

    .events-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-3);
    }

    .event-item {
        display: flex;
        align-items: center;
        gap: var(--space-4);
        padding: var(--space-4);
        background: var(--bg-secondary);
        border-radius: var(--radius-md);
        border-left: 3px solid var(--accent);
        transition: all var(--transition-fast);
    }

    .event-item:hover {
        background: var(--bg-tertiary);
        transform: translateX(4px);
    }

    .event-icon {
        font-size: 1.5rem;
    }

    .event-details {
        flex: 1;
    }

    .event-type {
        font-weight: 600;
        margin-bottom: var(--space-1);
        color: var(--text-primary);
    }

    .event-info {
        font-size: 0.875rem;
        display: flex;
        gap: var(--space-2);
        align-items: center;
    }

    .event-time {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        font-size: 0.875rem;
    }

    .bootfiles-grid {
        display: grid;
        gap: var(--space-3);
        margin-bottom: var(--space-4);
    }

    .bootfile-item {
        display: flex;
        align-items: center;
        gap: var(--space-3);
        padding: var(--space-3);
        background: var(--bg-secondary);
        border-radius: var(--radius-md);
        transition: all var(--transition-fast);
    }

    .bootfile-item:hover {
        background: var(--bg-tertiary);
    }

    .bootfile-icon {
        font-size: 1.5rem;
    }

    .bootfile-info {
        flex: 1;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .bootfile-name {
        font-weight: 600;
        font-size: 0.875rem;
    }

    .btn-block {
        width: 100%;
        margin-top: var(--space-4);
    }

    .quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: var(--space-4);
    }

    .action-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--space-2);
        padding: var(--space-6);
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        cursor: pointer;
        transition: all var(--transition-base);
        text-align: center;
    }

    .action-card:hover {
        border-color: var(--accent);
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
    }

    .action-icon {
        font-size: 3rem;
    }

    .action-label {
        font-weight: 600;
        font-size: 1.125rem;
        color: var(--text-primary);
    }

    .action-desc {
        font-size: 0.875rem;
        color: var(--text-secondary);
    }

    .empty-state {
        text-align: center;
        padding: var(--space-8);
        color: var(--text-secondary);
    }

    @@media (max-width: 968px) {
        .dashboard-grid {
            grid-template-columns: 1fr;
        }

        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @@media (max-width: 640px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }

        .dashboard-header {
            flex-direction: column;
            gap: var(--space-4);
        }

        .user-info {
            flex-wrap: wrap;
        }
    }
</style>

@code {
    private AuthService.UserInfo? currentUser;
    private List<PxeEvent> bootEvents = [];
    private int activeClients = 0;
    private System.Threading.Timer? _timer;

    protected override async Task OnInitializedAsync() {
        await LoadData();
        
        _timer = new System.Threading.Timer(async _ => {
            await InvokeAsync(async () => {
                await RefreshData();
                StateHasChanged();
            });
        }, null, TimeSpan.FromSeconds(5), TimeSpan.FromSeconds(5));
    }

    private async Task LoadData() {
        currentUser = await AuthService.GetCurrentUserAsync();
        
        if (currentUser == null) {
            Navigation.NavigateTo("/login");
            return;
        }

        await RefreshData();
    }

    private async Task RefreshData() {
        try {
            bootEvents = await Http.GetFromJsonAsync<List<PxeEvent>>("/api/pxe/events") ?? [];
            activeClients = bootEvents
                .Where(e => e.Timestamp > DateTime.UtcNow.AddHours(-24))
                .Select(e => e.MacAddress)
                .Distinct()
                .Count();
        }
        catch { }
    }

    private async Task HandleLogout() {
        await AuthService.LogoutAsync();
        Navigation.NavigateTo("/login");
    }

    private void NavigateToSubscription() {
        Navigation.NavigateTo("/subscription");
    }

    private void NavigateToFiles() {
        Navigation.NavigateTo("/files");
    }

    private int GetTodayEvents() =>
        bootEvents.Count(e => e.Timestamp.Date == DateTime.UtcNow.Date);

    private int GetUniqueClients() =>
        bootEvents.Select(e => e.MacAddress).Distinct().Count();

    private int GetSuccessRate() {
        if (bootEvents.Count == 0) return 100;
        var successful = bootEvents.Count(e => !e.EventType.Contains("Error") && !e.EventType.Contains("Failed"));
        return (int)((double)successful / bootEvents.Count * 100);
    }

    private string GetEventIcon(string eventType) => eventType switch {
        var t when t.Contains("DHCP") => "ðŸŒ",
        var t when t.Contains("TFTP") => "ðŸ“¦",
        var t when t.Contains("HTTP") => "ðŸ”—",
        var t when t.Contains("Boot") => "ðŸš€",
        _ => "ðŸ”Œ"
    };

    private string GetTimeAgo(DateTime timestamp) {
        var diff = DateTime.UtcNow - timestamp;
        if (diff.TotalMinutes < 1) return "just now";
        if (diff.TotalMinutes < 60) return $"{(int)diff.TotalMinutes}m ago";
        if (diff.TotalHours < 24) return $"{(int)diff.TotalHours}h ago";
        return $"{(int)diff.TotalDays}d ago";
    }

    private record PxeEvent(int Id, string EventType, string MacAddress, string IpAddress, DateTime Timestamp);

    public void Dispose() {
        _timer?.Dispose();
    }
}




==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\Pages\Login.razor
==============================================================================
@page "/login"
@inject AuthService AuthService
@inject NavigationManager Navigation

<div class="login-container">
    <div class="login-card">
        <h1>ðŸš€ ProPXE Server</h1>
        <p class="subtitle">Network Boot Made Simple</p>

        @if (!string.IsNullOrEmpty(errorMessage)) {
            <div class="alert alert-error">@errorMessage</div>
        }

        <div class="form-container">
            <input type="email" 
                   @bind="email" 
                   placeholder="Email" 
                   class="input" />
            
            <input type="password" 
                   @bind="password" 
                   placeholder="Password" 
                   class="input" />

            <button @onclick="HandleLogin" 
                    disabled="@isLoading" 
                    class="btn btn-primary">
                @if (isLoading) {
                    <span>Loading...</span>
                } else {
                    <span>Sign In</span>
                }
            </button>

            <button @onclick="() => showRegister = !showRegister" 
                    class="btn btn-secondary">
                @(showRegister ? "Back to Login" : "Create Account")
            </button>

            @if (showRegister) {
                <button @onclick="HandleRegister" 
                        disabled="@isLoading" 
                        class="btn btn-accent">
                    Register
                </button>
            }
        </div>
    </div>
</div>

<style>
    .login-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .login-card {
        background: white;
        padding: 2rem;
        border-radius: 1rem;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        width: 100%;
        max-width: 400px;
    }

    .login-card h1 {
        text-align: center;
        margin: 0 0 0.5rem 0;
        color: #667eea;
    }

    .subtitle {
        text-align: center;
        color: #666;
        margin-bottom: 2rem;
    }

    .form-container {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .input {
        padding: 0.75rem;
        border: 2px solid #e0e0e0;
        border-radius: 0.5rem;
        font-size: 1rem;
        transition: border-color 0.3s;
    }

    .input:focus {
        outline: none;
        border-color: #667eea;
    }

    .btn {
        padding: 0.75rem;
        border: none;
        border-radius: 0.5rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }

    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(102,126,234,0.3);
    }

    .btn-secondary {
        background: #f0f0f0;
        color: #333;
    }

    .btn-accent {
        background: #10b981;
        color: white;
    }

    .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .alert-error {
        background: #fee;
        color: #c00;
        padding: 0.75rem;
        border-radius: 0.5rem;
        margin-bottom: 1rem;
    }
</style>

@code {
    private string email = "";
    private string password = "";
    private bool isLoading = false;
    private bool showRegister = false;
    private string? errorMessage;

    private async Task HandleLogin() {
        isLoading = true;
        errorMessage = null;

        var success = await AuthService.LoginAsync(email, password);
        
        if (success) {
            Navigation.NavigateTo("/");
        } else {
            errorMessage = "Invalid email or password";
        }

        isLoading = false;
    }

    private async Task HandleRegister() {
        isLoading = true;
        errorMessage = null;

        var success = await AuthService.RegisterAsync(email, password);
        
        if (success) {
            Navigation.NavigateTo("/");
        } else {
            errorMessage = "Registration failed. Email may already be in use.";
        }

        isLoading = false;
    }
}




==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\Pages\NotFound.razor
==============================================================================
@page "/not-found"
@layout MainLayout

<h3>Not Found</h3>
<p>Sorry, the content you are looking for does not exist.</p>



==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\Pages\Subscription.razor
==============================================================================
@page "/subscription"
@inject HttpClient Http
@inject AuthService AuthService
@inject NavigationManager Navigation
@inject IJSRuntime JS

<div class="subscription-container">
    <header class="page-header">
        <h1>ðŸ’³ Subscription</h1>
        <button @onclick="NavigateHome" class="btn btn-back">
            â† Back
        </button>
    </header>

    @if (currentUser == null) {
        <div class="loading">Loading...</div>
    } else if (currentUser.IsSubscribed) {
        <div class="subscription-active">
            <div class="status-card">
                <div class="status-icon">âœ“</div>
                <h2>Active Subscription</h2>
                <p class="status-label">Status: <span class="status-active">@currentUser.SubscriptionStatus</span></p>
                @if (currentUser.SubscriptionExpiry.HasValue) {
                    <p class="expiry-date">Renews: @currentUser.SubscriptionExpiry.Value.ToString("MMMM dd, yyyy")</p>
                }
                <div class="actions">
                    <button @onclick="ManageBilling" class="btn btn-primary">
                        Manage Billing
                    </button>
                </div>
            </div>

            <div class="features-list">
                <h3>Your Benefits</h3>
                <div class="feature">âœ“ Unlimited boot files</div>
                <div class="feature">âœ“ Real-time monitoring</div>
                <div class="feature">âœ“ WebDAV access</div>
                <div class="feature">âœ“ API access</div>
                <div class="feature">âœ“ Priority support</div>
            </div>
        </div>
    } else {
        <div class="subscription-offer">
            <div class="pricing-card">
                <div class="pricing-badge">Pro Plan</div>
                <div class="pricing-amount">
                    <span class="currency">$</span>
                    <span class="price">20</span>
                    <span class="period">/month</span>
                </div>
                
                <div class="features">
                    <div class="feature">âœ“ Unlimited boot files & configurations</div>
                    <div class="feature">âœ“ Real-time PXE monitoring & analytics</div>
                    <div class="feature">âœ“ WebDAV file management</div>
                    <div class="feature">âœ“ REST API access</div>
                    <div class="feature">âœ“ Priority email support</div>
                    <div class="feature">âœ“ 30-day money-back guarantee</div>
                </div>

                <button @onclick="StartCheckout" 
                        disabled="@isProcessing" 
                        class="btn btn-subscribe">
                    @if (isProcessing) {
                        <span>Processing...</span>
                    } else {
                        <span>Subscribe Now â†’</span>
                    }
                </button>

                <p class="secure-note">ðŸ”’ Secure payment via Stripe</p>
            </div>

            <div class="faq-section">
                <h3>Frequently Asked Questions</h3>
                <div class="faq-item">
                    <strong>Can I cancel anytime?</strong>
                    <p>Yes! Cancel your subscription at any time from the billing portal.</p>
                </div>
                <div class="faq-item">
                    <strong>What payment methods do you accept?</strong>
                    <p>We accept all major credit cards via Stripe.</p>
                </div>
                <div class="faq-item">
                    <strong>Is there a free trial?</strong>
                    <p>We offer a 30-day money-back guarantee on all subscriptions.</p>
                </div>
            </div>
        </div>
    }
</div>

<style>
    .subscription-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
    }

    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .btn-back {
        background: #f3f4f6;
        color: #374151;
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 0.5rem;
        cursor: pointer;
        font-weight: 600;
    }

    .subscription-active {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    .status-card {
        background: white;
        padding: 3rem;
        border-radius: 1rem;
        box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        text-align: center;
    }

    .status-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 1rem;
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
    }

    .status-active {
        color: #10b981;
        font-weight: 600;
        text-transform: capitalize;
    }

    .expiry-date {
        color: #666;
        margin-bottom: 2rem;
    }

    .pricing-card {
        background: white;
        padding: 3rem;
        border-radius: 1rem;
        box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        text-align: center;
    }

    .pricing-badge {
        display: inline-block;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 0.5rem 1.5rem;
        border-radius: 2rem;
        font-weight: 600;
        margin-bottom: 2rem;
    }

    .pricing-amount {
        margin-bottom: 2rem;
    }

    .currency {
        font-size: 2rem;
        vertical-align: top;
        color: #666;
    }

    .price {
        font-size: 4rem;
        font-weight: 700;
        color: #333;
    }

    .period {
        font-size: 1.5rem;
        color: #666;
    }

    .features {
        text-align: left;
        margin: 2rem 0;
        padding: 2rem 0;
        border-top: 1px solid #e5e7eb;
        border-bottom: 1px solid #e5e7eb;
    }

    .feature {
        padding: 0.75rem 0;
        color: #333;
        font-size: 1.125rem;
    }

    .features-list {
        background: white;
        padding: 2rem;
        border-radius: 1rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .features-list h3 {
        margin-top: 0;
        color: #333;
    }

    .features-list .feature {
        padding: 0.5rem 0;
        color: #10b981;
        font-weight: 500;
    }

    .btn {
        padding: 1rem 2rem;
        border: none;
        border-radius: 0.5rem;
        font-size: 1.125rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }

    .btn-primary {
        background: #667eea;
        color: white;
    }

    .btn-subscribe {
        width: 100%;
        padding: 1.25rem 2rem;
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        border: none;
        border-radius: 0.5rem;
        font-size: 1.25rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s;
    }

    .btn-subscribe:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(16,185,129,0.3);
    }

    .btn-subscribe:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .secure-note {
        margin-top: 1rem;
        color: #666;
        font-size: 0.875rem;
    }

    .faq-section {
        margin-top: 3rem;
    }

    .faq-section h3 {
        color: #333;
        margin-bottom: 1.5rem;
    }

    .faq-item {
        margin-bottom: 1.5rem;
        padding: 1.5rem;
        background: white;
       border-radius: 0.5rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .faq-item strong {
        display: block;
        color: #333;
        margin-bottom: 0.5rem;
    }

    .faq-item p {
        margin: 0;
        color: #666;
    }

    .loading {
        text-align: center;
        padding: 4rem;
        font-size: 1.5rem;
        color: #666;
    }
</style>

@code {
    private AuthService.UserInfo? currentUser;
    private bool isProcessing = false;

    protected override async Task OnInitializedAsync() {
        currentUser = await AuthService.GetCurrentUserAsync();
        if (currentUser == null) {
            Navigation.NavigateTo("/login");
        }
    }

    private async Task StartCheckout() {
        isProcessing = true;

        try {
            var response = await Http.PostAsync("/api/subscription/create-checkout", null);
            if (response.IsSuccessStatusCode) {
                var result = await response.Content.ReadFromJsonAsync<CheckoutResponse>();
                if (result?.Url != null) {
                    await JS.InvokeVoidAsync("open", result.Url, "_self");
                }
            }
        }
        catch { }
        finally {
            isProcessing = false;
        }
    }

    private async Task ManageBilling() {
        try {
            var response = await Http.PostAsync("/api/subscription/portal", null);
            if (response.IsSuccessStatusCode) {
                var result = await response.Content.ReadFromJsonAsync<PortalResponse>();
                if (result?.Url != null) {
                    await JS.InvokeVoidAsync("open", result.Url, "_blank");
                }
            }
        }
        catch { }
    }

    private record CheckoutResponse(string Url);
    private record PortalResponse(string Url);

    private void NavigateHome() => Navigation.NavigateTo("/");
}




==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\Properties\launchSettings.json
==============================================================================
{
  "$schema": "https://json.schemastore.org/launchsettings.json",
  "profiles": {
    "http": {
      "commandName": "Project",
      "dotnetRunMessages": true,
      "launchBrowser": true,
      "inspectUri": "{wsProtocol}://{url.hostname}:{url.port}/_framework/debug/ws-proxy?browser={browserInspectUri}",
      "applicationUrl": "http://localhost:5263",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    },
    "https": {
      "commandName": "Project",
      "dotnetRunMessages": true,
      "launchBrowser": true,
      "inspectUri": "{wsProtocol}://{url.hostname}:{url.port}/_framework/debug/ws-proxy?browser={browserInspectUri}",
      "applicationUrl": "https://localhost:7061;http://localhost:5263",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    }
  }
}




==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\Services\AuthenticationHeaderHandler.cs
==============================================================================
using System.Net.Http.Headers;
using Blazored.LocalStorage;

namespace ProPXEServer.Client.Services;

public class AuthenticationHeaderHandler(ILocalStorageService localStorage) : DelegatingHandler {
    protected override async Task<HttpResponseMessage> SendAsync(
        HttpRequestMessage request,
        CancellationToken cancellationToken) {
        
        var token = await localStorage.GetItemAsStringAsync("authToken");
        if (!string.IsNullOrEmpty(token)) {
            request.Headers.Authorization = new AuthenticationHeaderValue("Bearer", token);
        }

        return await base.SendAsync(request, cancellationToken);
    }
}





==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\Services\AuthService.cs
==============================================================================
using System.Net.Http.Headers;
using System.Net.Http.Json;
using System.Text.Json;
using Blazored.LocalStorage;
using Microsoft.AspNetCore.Components.Authorization;

namespace ProPXEServer.Client.Services;

public class AuthService(HttpClient httpClient, ILocalStorageService localStorage, AuthenticationStateProvider authStateProvider) {
    private const string TokenKey = "authToken";
    private UserInfo? _currentUser;

    public record LoginResponse(string Token, UserInfo User);
    public record UserInfo(string Id, string Email, bool IsSubscribed, string? SubscriptionStatus, DateTime? SubscriptionExpiry);

    public async Task<bool> LoginAsync(string email, string password) {
        try {
            var response = await httpClient.PostAsJsonAsync("/api/auth/login", new {
                email,
                password
            });

            if (!response.IsSuccessStatusCode) {
                return false;
            }

            var result = await response.Content.ReadFromJsonAsync<LoginResponse>();
            if (result?.Token != null) {
                await localStorage.SetItemAsStringAsync(TokenKey, result.Token);
                ((CustomAuthStateProvider)authStateProvider).NotifyUserAuthentication(result.Token);
                _currentUser = result.User;
                return true;
            }

            return false;
        }
        catch {
            return false;
        }
    }

    public async Task<bool> RegisterAsync(string email, string password) {
        try {
            var response = await httpClient.PostAsJsonAsync("/api/auth/register", new {
                email,
                password
            });

            if (!response.IsSuccessStatusCode) {
                return false;
            }

            var result = await response.Content.ReadFromJsonAsync<LoginResponse>();
            if (result?.Token != null) {
                await localStorage.SetItemAsStringAsync(TokenKey, result.Token);
                ((CustomAuthStateProvider)authStateProvider).NotifyUserAuthentication(result.Token);
                _currentUser = result.User;

                return true;
            }

            return false;
        }
        catch {
            return false;
        }
    }

    public async Task LogoutAsync() {
        await localStorage.RemoveItemAsync(TokenKey);
        ((CustomAuthStateProvider)authStateProvider).NotifyUserLogout();
        _currentUser = null;
    }

    public async Task<string?> GetTokenAsync() {
        return await localStorage.GetItemAsStringAsync(TokenKey);
    }

    public async Task<bool> IsAuthenticatedAsync() {
        var token = await GetTokenAsync();
        return !string.IsNullOrEmpty(token);
    }

    public async Task<UserInfo?> GetCurrentUserAsync() {
        if (_currentUser != null) {
            return _currentUser;
        }

        try {
            var response = await httpClient.GetAsync("/api/auth/me");
            if (response.IsSuccessStatusCode) {
                _currentUser = await response.Content.ReadFromJsonAsync<UserInfo>();
                return _currentUser;
            }
        }
        catch { }

        return null;
    }
}






==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\Services\CustomAuthStateProvider.cs
==============================================================================
using System.Security.Claims;
using Microsoft.AspNetCore.Components.Authorization;
using Blazored.LocalStorage;
using System.Text.Json;

namespace ProPXEServer.Client.Services;

public class CustomAuthStateProvider(ILocalStorageService localStorage) : AuthenticationStateProvider {
    public override async Task<AuthenticationState> GetAuthenticationStateAsync() {
        var token = await localStorage.GetItemAsStringAsync("authToken");
        var identity = new ClaimsIdentity();

        if (!string.IsNullOrEmpty(token)) {
            try {
                identity = new ClaimsIdentity(ParseClaimsFromJwt(token), "jwt");
            }
            catch {
                await localStorage.RemoveItemAsync("authToken");
            }
        }

        var user = new ClaimsPrincipal(identity);
        return new AuthenticationState(user);
    }

    public void NotifyUserAuthentication(string token) {
        var authenticatedUser = new ClaimsPrincipal(new ClaimsIdentity(ParseClaimsFromJwt(token), "jwt"));
        var authState = Task.FromResult(new AuthenticationState(authenticatedUser));
        NotifyAuthenticationStateChanged(authState);
    }

    public void NotifyUserLogout() {
        var anonymousUser = new ClaimsPrincipal(new ClaimsIdentity());
        var authState = Task.FromResult(new AuthenticationState(anonymousUser));
        NotifyAuthenticationStateChanged(authState);
    }

    private static IEnumerable<Claim> ParseClaimsFromJwt(string jwt) {
        var payload = jwt.Split('.')[1];
        var jsonBytes = ParseBase64WithoutPadding(payload);
        var keyValuePairs = JsonSerializer.Deserialize<Dictionary<string, object>>(jsonBytes);
        return keyValuePairs!.Select(kvp => new Claim(kvp.Key, kvp.Value.ToString()!));
    }

    private static byte[] ParseBase64WithoutPadding(string base64) {
        switch (base64.Length % 4) {
            case 2: base64 += "=="; break;
            case 3: base64 += "="; break;
        }
        return Convert.FromBase64String(base64);
    }
}






==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\Shared\RedirectToLogin.razor
==============================================================================
@inject NavigationManager Navigation

@code {
    protected override void OnInitialized()
    {
        Navigation.NavigateTo($"login?returnUrl={Uri.EscapeDataString(Navigation.Uri)}");
    }
}




==============================================================================
File: \src\ProPXEServer\ProPXEServer.Client\Shared\ThemeToggle.razor
==============================================================================
@inject IJSRuntime JS

<button class="theme-toggle" @onclick="ToggleTheme" title="Toggle Dark/Light Mode">
    @(isDarkMode ? "ðŸŒ™" : "â˜€ï¸")
</button>

@code {
    private bool isDarkMode = true;

    protected override async Task OnAfterRenderAsync(bool firstRender) {
        if (firstRender) {
            try {
                var theme = await JS.InvokeAsync<string>("localStorage.getItem", "theme");
                isDarkMode = theme != "light";
                await ApplyTheme();
            } catch {
                isDarkMode = true;
            }
        }
    }

    private async Task ToggleTheme() {
        isDarkMode = !isDarkMode;
        await ApplyTheme();
        await JS.InvokeVoidAsync("localStorage.setItem", "theme", isDarkMode ? "dark" : "light");
    }

    private async Task ApplyTheme() {
        var theme = isDarkMode ? "dark" : "light";
        await JS.InvokeVoidAsync("eval", $"document.documentElement.setAttribute('data-theme', '{theme}')");
    }
}




==============================================================================
File: \src\ProPXEServer\ProPXEServer.Plugin\Class1.cs
==============================================================================
namespace ProPXEServer.Plugin;

public class Class1
{

}





==============================================================================
File: \src\ProPXEServer\ProPXEServer.Plugin\plugin.json
==============================================================================
{
    "id": "propxeserver",
    "name": "ProPXEServer",
    "version": "1.0.0",
    "description": "PXE network boot server",
    "author": "Mass Suite Team",
    "icon": "ðŸ–¥ï¸",
    "entryAssembly": "ProPXEServer.Plugin.dll",
    "entryType": "ProPXEServer.Plugin.ProPXEServerPlugin",
    "dependencies": [],
    "permissions": [
        "network",
        "filesystem"
    ],
    "enabled": true
}



==============================================================================
File: \src\ProPXEServer\ProPXEServer.Plugin\ProPXEServer.Plugin.csproj
==============================================================================
<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>net10.0</TargetFramework>
    <LangVersion>14</LangVersion>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
  </PropertyGroup>

  <ItemGroup>
    <ProjectReference Include="..\..\Mass.Core\Mass.Core.csproj" />
    <ProjectReference Include="..\ProPXEServer.API\ProPXEServer.API.csproj">
      <ReferenceOutputAssembly>false</ReferenceOutputAssembly>
    </ProjectReference>
    <PackageReference Include="Microsoft.Extensions.Hosting" Version="10.0.0" />
  </ItemGroup>

  <ItemGroup>
    <None Update="plugin.json">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
  </ItemGroup>

</Project>




==============================================================================
File: \src\ProPXEServer\ProPXEServer.Plugin\ProPXEServerPlugin.cs
==============================================================================
using Mass.Core.Abstractions;
using Mass.Core.Plugins;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;

namespace ProPXEServer.Plugin;

public class ProPXEServerPlugin : IModule
{
    private System.Diagnostics.Process? _serverProcess;

    public PluginManifest Manifest => new()
    {
        Id = "ProPXEServer",
        Name = "ProPXEServer",
        Version = "1.0.0",
        Description = "PXE network boot server",
        Author = "Mass Suite Team",
        Icon = "ðŸ–¥ï¸",
        EntryAssembly = "ProPXEServer.Plugin.dll",
        EntryType = "ProPXEServer.Plugin.ProPXEServerPlugin",
        Enabled = true,
        Permissions = new List<string> { "network", "filesystem" }
    };

    public void RegisterServices(IServiceCollection services)
    {
        // Register ProPXEServer services here if needed to be shared
        // For now, the web host manages its own services
    }

    public Task InitializeAsync(IServiceProvider services, CancellationToken cancellationToken = default)
    {
        return Task.CompletedTask;
    }

    public async Task ActivateAsync(CancellationToken cancellationToken = default)
    {
        if (_serverProcess == null)
        {
            // Locate the executable
            // Assuming standard build output structure relative to the plugin dll
            var pluginDir = Path.GetDirectoryName(typeof(ProPXEServerPlugin).Assembly.Location);
            // We need to find ProPXEServer.API.exe. 
            // In dev, it might be in a different path, but for now let's try to find it relative to the plugin or known path.
            
            // For development environment, we know the path relative to the solution
            var apiPath = Path.GetFullPath(Path.Combine(pluginDir, "..", "..", "..", "..", "ProPXEServer", "ProPXEServer.API", "bin", "Debug", "net10.0", "ProPXEServer.API.exe"));
            
            if (!File.Exists(apiPath))
            {
                // Try production/published path (usually in the same folder or a subfolder)
                apiPath = Path.Combine(pluginDir, "ProPXEServer.API.exe");
            }

            if (File.Exists(apiPath))
            {
                var startInfo = new System.Diagnostics.ProcessStartInfo
                {
                    FileName = apiPath,
                    UseShellExecute = false,
                    CreateNoWindow = true,
                    WorkingDirectory = Path.GetDirectoryName(apiPath)
                };

                _serverProcess = System.Diagnostics.Process.Start(startInfo);
            }
        }
        
        await Task.CompletedTask;
    }

    public async Task DeactivateAsync(CancellationToken cancellationToken = default)
    {
        if (_serverProcess != null && !_serverProcess.HasExited)
        {
            try 
            {
                _serverProcess.Kill();
                await _serverProcess.WaitForExitAsync(cancellationToken);
            }
            catch { /* Ignore errors during shutdown */ }
            finally
            {
                _serverProcess.Dispose();
                _serverProcess = null;
            }
        }
    }

    public Task UnloadAsync(CancellationToken cancellationToken = default)
    {
        return Task.CompletedTask;
    }
}





